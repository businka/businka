[Copyright Open Connectivity Foundation, Inc. © 2016-2018. All rights Reserved](https://openconnectivity.org/)

# 5 Операционные сценарии

Общие цели:
1. сделать Bridged Servers видимыми для клиентов OCF, как если бы они были собственными серверами OCF, и

2. Сделайте так, чтобы серверы OCF показывались Bridged Clients, как если бы они были родными серверами не OCF.

  ## 5.1 «Глубокий перевод» против «на лету»

  При переводе службы между протоколами мостового протокола (например, AllJoyn) и протоколами OCF существует два возможных типа перевода. Ожидается, что переводчики посвятят большую часть своей логики типам связи «глубокого перевода», в которых модели данных, используемые с мостовым протоколом, сопоставляются с эквивалентными типами ресурсов OCF и наоборот таким образом, чтобы совместимый клиент OCF или Клиент Bridged сможет взаимодействовать со службой, не осознавая, что был сделан перевод.
  «Глубокий перевод» выходит за рамки этого документа, так как процедура намного превышает сопоставление типов. Например, клиенты на одной стороне транслятора могут решить представить интенсивность в виде 8-битного значения между 0 и 255, тогда как устройства на другой стороне, возможно, решили представить ее как число с плавающей запятой между 0,0 и 1,0. Также возможно, что процедура может потребовать сохранения состояния в переводчике. В любом случае, программирование такого перевода потребует особых усилий и изучения механизмов с обеих сторон.
  Перевод другого типа, перевод «на лету» или «один на один», не требует предварительного знания соответствующей схемы устройства со стороны переводчика. Вместо этого бремя ложится на одного из других участников общения, обычно на клиентское приложение. Это связано с тем фактом, что трансляция «на лету» всегда создает мостовые типы ресурсов и типы ресурсов OCF в качестве расширений поставщиков.
  Для AllJoyn глубокий перевод указан в OCF ASA Mapping, а перевод на лету описан в разделе 7.2 этого документа.

  ## 5.2 Использование самоанализа

  Когда это возможно, код перевода должен использовать доступные метаданные, указывающие, что ожидают отправитель и получатель рассматриваемого сообщения. Например, устройства, сертифицированные AllJoyn, должны нести данные самоанализа для каждого объекта и интерфейса, которые они предоставляют. Базовая спецификация OIC 1.1 не предъявляет таких требований, но Базовая спецификация OCF 1.0 делает это. Когда метаданные доступны, переводчики должны преобразовывать входящую полезную нагрузку в формат, ожидаемый получателем, и использовать информацию при переводе ответов, чтобы сформировать более полезное сообщение.
  Например, для переводчика AllJoyn ожидаемый список взаимодействия представлен в списке ниже:

| **Message Type** | **Sender**           | **Receiver**         | **Metadata**  |
| ---------------- | -------------------- | -------------------- | ------------- |
| Request          | AllJoyn 16.10        | OIC 1.1              | Not available |
| Request          | AllJoyn 16.10        | OCF 1.0              | Available     |
| Request          | OIC 1.1 or OCF   1.0 | AllJoyn 16.10        | Available     |
| Response         | AllJoyn 16.10        | OIC 1.1 or OCF   1.0 | Available     |
| Response         | OIC 1.1              | AllJoyn 16.10        | Not available |
| Response         | OCF 1.0              | AllJoyn 16.10        | Available     |

## 5.3 Стабильность и потеря данных

Предполагается, что циклическое повторение процесса перевода, указанного в этом документе, не приведет к воспроизведению того же самого исходного сообщения. Этот процесс, однако, предназначен для того, чтобы не терять данные или точность в сообщениях, хотя следует отметить, что форматы полезной нагрузки OCF и AllJoyn допускают будущие расширения, не рассматриваемые в этом документе.


Однако в третьем раунде перевода должно получиться то же самое сообщение, которое было подготовлено ранее, при условии наличия той же информации. То есть в приведенной выше цепочке полезные нагрузки 2 и 4, а также 3 и 5 должны быть идентичны.

# 6 OCF Bridge Device

В этом разделе описываются функциональные возможности мостового устройства OCF; такое устройство показано на рисунке 2.
Мостовое устройство OCF - это устройство, которое представляет одно или несколько мостовых устройств в качестве виртуальных устройств OCF в сети и / или представляет одно или несколько устройств OCF в качестве виртуальных устройств, используя другой протокол в сети. Сами мостовые устройства выходят за рамки этого документа. Единственная разница между собственным устройством OCF и виртуальным мостовым устройством заключается в том, как устройство инкапсулируется в мостовое устройство OCF.
Мостовое устройство OCF должно быть указано в сети OCF с типом устройства «oic.d.bridge». Это предоставляет Клиенту OCF явное указание на то, что обнаруженное Устройство выполняет функцию моста. Это полезно по нескольким причинам; 1) при установлении домашней сети Клиент может определить, что мост доступен и функционирует, когда нет мостовых устройств, 2) позволяет выполнять конкретные действия на мосту с учетом известных функций, поддерживаемых мостом, 3) позволяет явно обнаружение всех устройств, которые выполняют функцию моста, которая помогает устранять неполадки и выполнять действия по обслуживанию от имени пользователя.
Когда такое устройство обнаружено, открытые ресурсы на мостовом устройстве OCF описывают другие устройства. Например, как показано на рисунке 2.

![Рисунок 2: Схематический обзор мостового устройства OCF, соединяющего устройства без OCF](figure\bs02.png)

Рисунок 2: Схематический обзор мостового устройства OCF, соединяющего устройства без OCF

Ожидается, что мостовое устройство OCF создает набор устройств во время запуска мостового устройства OCF. Открытый набор виртуальных устройств OCF может изменяться при добавлении или удалении мостовых устройств из моста. Добавление и удаление Bridged Devices зависит от реализации. Когда устройство моста OCF изменяет набор открытых виртуальных устройств OCF, оно должно уведомить всех клиентов OCF, подписавшихся на его «/ oic / res».

## 6.1 Обнаружение ресурсов

Мостовое устройство OCF должно обнаруживать устройства, которые прибывают и покидают сеть с мостовым соединением или сеть OCF. Там, где не существует ранее существовавшего механизма для надежного обнаружения прихода и отбытия устройств в сети, мостовое устройство OCF должно периодически опрашивать сеть, чтобы обнаруживать приход и отправление устройств, например, с использованием обнаружения многоадресной рассылки COAP (многоадресная передача ПОЛУЧИТ « / oic / res ») в случае сети OCF. При реализации мостового устройства OCF рекомендуется использовать интервал опроса 30 секунд плюс или минус случайная задержка в несколько секунд.
Мостовое устройство OCF должно отвечать на команды обнаружения сети от имени открытых мостовых устройств. Все мостовые устройства со всеми их ресурсами должны быть перечислены в «/oic/res» моста. Ответ на RETRIEVE в «/oic/res» должен включать только те устройства, которые соответствуют запросу RETRIEVE.
Ссылка на ресурс, определенная по каждой ссылке, представленной «/oic/res» на мосту, должна быть уникальной. Мост должен соответствовать требованиям, определенным в Основной спецификации OCF 1.0 для заполнения параметров Properties и Link в «/oic/res».
Например, если устройство моста OCF предоставляет виртуальные серверы OCF для вентилятора и индикаторов, показанных на рисунке 2, мост может вернуть следующую информацию, соответствующую JSON ниже, устаревшему клиенту OIC 1.1, выполняющему команду RETRIEVE для «/ oic / res» , (Обратите внимание, что возвращается не в формате JSON, а в подходящей кодировке, определенной в основной спецификации OCF 1.0.)

```json
[
  {
    "di": "e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "links": [
      {
        "href": "coap://[2001:db8:a::b1d4]:55555/oic/res",
        "rel": "self",
        "rt": ["oic.wk.res"],
        "if": ["oic.if.ll", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/d",
        "rt": ["oic.wk.d", "oic.d.bridge"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/p",
        "rt": ["oic.wk.p"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 11111}
      },
      {
        "href": "/mySecureMode",
        "rt": ["oic.r.securemode"],
        "if": ["oic.if.rw", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/sec/doxm",
        "rt": ["oic.r.doxm"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/sec/pstat",
        "rt": ["oic.r.pstat"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/sec/cred",
        "rt": ["oic.r.cred"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 11111}
      },
      {
        "href": "/oic/sec/acl2",
        "rt": ["oic.r.acl2"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 11111}
      },
      {
        "href": "/myIntrospection",
        "rt": ["oic.wk.introspection"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 11111}
      }
    ]
  },
  {
    "di": "88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "links": [
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/res",
        "rt": ["oic.wk.res"],
        "if": ["oic.if.ll", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/d",
        "rt": ["oic.wk.d", "oic.d.fan", "oic.d.virtual"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/p",
        "rt": ["oic.wk.p"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/myFan",
        "rt": ["oic.r.switch.binary"],
        "if": ["oic.if.a", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/sec/doxm",
        "rt": ["oic.r.doxm"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/sec/pstat",
        "rt": ["oic.r.pstat"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/sec/cred",
        "rt": ["oic.r.cred"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/oic/sec/acl2",
        "rt": ["oic.r.acl2"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 22222}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:22222/myFanIntrospection",
        "rt": ["oic.wk.introspection"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 22222}
      }
    ]
  },
  {
    "di": "dc70373c-1e8d-4fb3-962e-017eaa863989",
    "links": [
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/res",
        "rt": ["oic.wk.res"],
        "if": ["oic.if.ll", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/d",
        "rt": ["oic.wk.d", "oic.d.light", "oic.d.virtual"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/p",
        "rt": ["oic.wk.p"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/myLight",
        "rt": ["oic.r.switch.binary"],
        "if": ["oic.if.a", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/sec/doxm",
        "rt": ["oic.r.doxm"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/sec/pstat",
        "rt": ["oic.r.pstat"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/sec/cred",
        "rt": ["oic.r.cred"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/oic/sec/acl2",
        "rt": ["oic.r.acl2"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 33333}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:33333/myLightIntrospection",
        "rt": ["oic.wk.introspection"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 33333}
      }
    ]
  },
  {
    "di": "8202138e-aa22-452c-b512-9ebad02bef7c",
    "links": [
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/res",
        "rt": ["oic.wk.res"],
        "if": ["oic.if.ll", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/d",
        "rt": ["oic.wk.d", "oic.d.light", "oic.d.virtual"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/p",
        "rt": ["oic.wk.p"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/myLight",
        "rt": ["oic.r.switch.binary"],
        "if": ["oic.if.a", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/sec/doxm",
        "rt": ["oic.r.doxm"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/sec/pstat",
        "rt": ["oic.r.pstat"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/sec/cred",
        "rt": ["oic.r.cred"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/oic/sec/acl2", 
        "rt": ["oic.r.acl2"],
        "if": ["oic.if.baseline"],
        "p": {"bm": 1, "sec": true, "port": 44444}
      },
      {
        "href": "coaps://[2001:db8:a::b1d4]:44444/myLightIntrospection", 
        "rt": ["oic.wk.introspection"],
        "if": ["oic.if.r", "oic.if.baseline"],
        "p": {"bm": 3, "sec": true, "port": 44444}
      }
    ]
  }
]
```

Приведенный выше пример иллюстрирует, что каждый Виртуальный сервер OCF имеет свои собственные «di» и конечную точку, предоставляемые мостом, и что «/ oic / p» и «/ oic / d» доступны для каждого Виртуального сервера OCF.

Когда клиент OCF запрашивает формат содержимого «application / vnd.ocf + cbor», тот же мост возвращает информацию, соответствующую приведенному ниже JSON. (Обратите внимание, что возвращается не в формате JSON, а в подходящей кодировке, определенной в основной спецификации OCF 1.0.)

```json
[   
  {    
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/res",
    "rel": "self",
    "rt": ["oic.wk.res"],
    "if": ["oic.if.ll", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [
       {"ep": "coap://[2001:db8:a::b1d4]:55555"},
       {"ep": "coaps://[2001:db8:a::b1d4]:11111"}
    ]
  },   
  {    
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/d",
    "rt": ["oic.wk.d", "oic.d.bridge"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },   
  {    
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/p",
    "rt": ["oic.wk.p"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },   
  {    
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/mySecureMode",
    "rt": ["oic.r.securemode"],
    "if": ["oic.if.rw", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },   
  {    
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/sec/doxm",
    "rt": ["oic.r.doxm"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },
  {
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/sec/pstat",
    "rt": ["oic.r.pstat"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },
  {
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/sec/cred",
    "rt": ["oic.r.cred"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },
  {
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/oic/sec/acl2",
    "rt": ["oic.r.acl2"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },
  {
    "anchor": "ocf://e61c3e6b-9c54-4b81-8ce5-f9039c1d04d9",
    "href": "/myIntrospection",
    "rt": ["oic.wk.introspection"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:11111"}]
  },
    
    
  {
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/res",
    "rt": ["oic.wk.res"],
    "if": ["oic.if.ll", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },
  {
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/d",
    "rt": ["oic.wk.d", "oic.d.fan", "oic.d.virtual"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },
  {
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/p",
    "rt": ["oic.wk.p"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },
      
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/myFan",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/sec/doxm",
    "rt": ["oic.r.doxm"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/sec/pstat",
    "rt": ["oic.r.pstat"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/sec/cred",
    "rt": ["oic.r.cred"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/oic/sec/acl2",
    "rt": ["oic.r.acl2"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://88b7c7f0-4b51-4e0a-9faa-cfb439fd7f49",
    "href": "/myFanIntrospection",
    "rt": ["oic.wk.introspection"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:22222"}]
  },   
  {    
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/res",
    "rt": ["oic.wk.res"],
    "if": ["oic.if.ll", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },   
  {    
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/d",
    "rt": ["oic.wk.d", "oic.d.light", "oic.d.virtual"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/p",
    "rt": ["oic.wk.p"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/myLight",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/sec/doxm",
    "rt": ["oic.r.doxm"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/sec/pstat",
    "rt": ["oic.r.pstat"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/sec/cred",
    "rt": ["oic.r.cred"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/oic/sec/acl2",
    "rt": ["oic.r.acl2"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
  {
    "anchor": "ocf://dc70373c-1e8d-4fb3-962e-017eaa863989",
    "href": "/myLightIntrospection",
    "rt": ["oic.wk.introspection"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:33333"}]
  },
    
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/res",
    "rt": ["oic.wk.res"],
    "if": ["oic.if.ll", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/d",
    "rt": ["oic.wk.d", "oic.d.light", "oic.d.virtual"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/p",
    "rt": ["oic.wk.p"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/myLight",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/sec/doxm",
    "rt": ["oic.r.doxm"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/sec/pstat",
    "rt": ["oic.r.pstat"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/sec/cred",
    "rt": ["oic.r.cred"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/oic/sec/acl2",
    "rt": ["oic.r.acl2"],
    "if": ["oic.if.baseline"],
    "p": {"bm": 1},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  },
  {
    "anchor": "ocf://8202138e-aa22-452c-b512-9ebad02bef7c",
    "href": "/myLightIntrospection",
    "rt": ["oic.wk.introspection"],
    "if": ["oic.if.r", "oic.if.baseline"],
    "p": {"bm": 3},
    "eps": [{"ep": "coaps://[2001:db8:a::b1d4]:44444"}]
  }    
]  
```

## 6.2 Общие требования

 Переводчик должен проверять независимый от протокола UUID («piid» в OCF) каждого устройства и не должен рекламировать обратно в Bridged Protocol устройство, первоначально видимое через этот Bridged Protocol. Переводчик должен прекратить перевод любого устройства Bridged Protocol, выставленного в OCF, через другого переводчика, если переводчик видит устройство через Bridged Protocol. Аналогично, переводчик не должен рекламировать устройство OCF обратно в OCF, и переводчик должен прекратить перевод любого устройства OCF, представленного в Bridged Protocol, через другого переводчика, если переводчик видит устройство через OCF. Для этого требуется, чтобы переводчик мог определить, когда устройство уже переводится. Виртуальное устройство OCF должно быть указано в сети OCF с типом устройства «oic.d.virtual». Это позволяет переводчикам определять, переводится ли устройство уже при наличии нескольких переводчиков. Как переводчик определяет, переводится ли уже устройство в сети, отличной от OCF, описано в разделах, посвященных конкретному протоколу, ниже.

 Транслятор должен обнаруживать дубликаты виртуальных устройств (с одинаковым UUID, не зависящим от протокола), присутствующих в сети, и не должен создавать более одного соответствующего виртуального устройства, поскольку он переводит эти дубликаты в другую сеть.

 Каждый мостовой сервер должен быть представлен как отдельный виртуальный сервер OCF с собственной конечной точкой и собственными «/ oic / d» и «/ oic / p». Ресурс «/ oic / res» виртуального сервера OCF будет таким же, как и для любого обычного сервера OCF, использующего каталог ресурсов. То есть он не отвечает на запросы многоадресного обнаружения (поскольку устройство-мост OCF отвечает от его имени), но одноадресный запрос вызывает ответ, в котором перечислены его собственные ресурсы с отношением «rel» = «hosts» и соответствующим «якорем». ”, Чтобы указать, что это не само Мостовое устройство OCF. Это позволяет сохранять поля для платформы, устройства и ресурса для всего перевода.

 Данные самоанализа, предоставляемые транслятором, должны включать информацию обо всех виртуальных устройствах (и их ресурсах), предоставляемых транслятором в тот момент времени. Это означает, что данные самоанализа, предоставляемые транслятором до и после того, как новое виртуальное устройство открыто, будут другими.

##  6.3 Безопасность

 Мостовое устройство OCF должно пройти передачу права собственности OCF, как и любой другой бортовой оператор. Отдельно он будет проходить через механизм передачи права собственности через Bridged Protocol (например, на заявлении AllJoyn) обычно, как и любой другой onboardee.

 Мостовое устройство OCF должно быть обновляемым на месте. (Это требование не нуждается в проверке, но может быть сертифицировано с помощью декларации поставщика.)

 Если администратор не разрешит это (см. Раздел 9.2), переводчик не должен предоставлять возможность подключения устройствам, к которым он не может получить безопасное соединение.
 Каждое виртуальное устройство OCF должно быть обеспечено для обеспечения безопасности с помощью инструмента OCF Onboarding. Каждое виртуальное мостовое устройство должно быть соответствующим образом подготовлено в экосистеме мостового соединения. Другими словами, виртуальные устройства обрабатываются так же, как физические устройства. Это объекты, которые должны быть предоставлены в их сети.

 Переводчик должен предоставить значение «piid», которое можно использовать для корреляции устройства без OCF с его соответствующим виртуальным устройством OCF, как указано в разделе 6.2. Onboarding Tool может использовать это соотношение для улучшения взаимодействия с пользователем, исключая или уменьшая потребность в вводе данных пользователем, автоматически создавая параметры безопасности для виртуальных устройств OCF, которые эквивалентны настройкам безопасности их соответствующих устройств, отличных от OCF. См. Спецификацию безопасности OCF для получения подробной информации о подключении.
Каждое виртуальное устройство должно реализовывать требования безопасности экосистемы, к которой оно подключено. Например, каждое Виртуальное устройство OCF должно реализовывать поведение, требуемое Спецификацией ядра OCF 1.0 и Спецификацией безопасности OCF. Каждое Виртуальное устройство OCF должно выполнять аутентификацию, контроль доступа и шифрование в соответствии с настройками безопасности, полученными от Onboarding Tool.

В зависимости от архитектуры Переводчика аутентификация и контроль доступа могут осуществляться только внутри каждой экосистемы, но не внутри Переводчика. Например, когда клиент OCF отправляет запрос на виртуальный сервер OCF:

- Аутентификация и контроль доступа могут выполняться виртуальным сервером OCF при получении запроса от клиента OCF.
- Переводчик может не выполнять аутентификацию или управление доступом, когда запрос передается через Переводчик соответствующему клиенту с виртуальными мостами.
- Аутентификация и контроль доступа могут выполняться целевым Bridged Server, когда он получает запрос от Virtual Bridged Client, в соответствии с моделью безопасности экосистемы Bridged.
  Переводчик может получать незашифрованные данные, поступающие от подключенного клиента через виртуальное мостовое устройство. Переведенное сообщение должно быть зашифровано