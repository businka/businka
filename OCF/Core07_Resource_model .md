[Copyright Open Connectivity Foundation, Inc. © 2016-2018. All rights Reserved](https://openconnectivity.org/)

# 7 Модель ресурсов

## 7.1     Вступление

Модель ресурсов определяет концепции и механизмы, обеспечивающие согласованность и базовую функциональную совместимость между устройствами в экосистемах OCF. Концепции и механизмы модели ресурсов затем сопоставляются с транспортными протоколами для обеспечения связи между устройствами - каждый транспорт обеспечивает совместимость протокола связи. Таким образом, модель ресурсов позволяет определять функциональную совместимость независимо от транспортов.

Кроме того, концепции в модели ресурсов поддерживают моделирование первичных артефактов и их взаимосвязей между собой и захватывают семантическую информацию, необходимую для взаимодействия в контексте. Таким образом, OCF выходит за рамки простой совместимости протоколов, чтобы захватить богатую семантику, необходимую для подлинной интероперабельности в экосистемах Wearable и Internet of Things.

Основными понятиями в модели ресурсов являются: Entity, Resources, Uniform Resource Identifiers (URI), типы ресурсов, свойства, представления, интерфейсы, коллекции и ссылки. Кроме того, основными механизмами являются CREATE, RETRIEVE, UPDATE, DELETE и NOTIFY. Эти концепции и механизмы могут быть составлены различными способами для определения богатой семантики и интероперабельности, необходимой для разнообразного набора вариантов использования, к которым применяется среда OCF.

В рамках модели ресурсов OCF сущность должна быть видимой, взаимодействовать с ней или манипулировать ею, она представлена абстракцией, называемой ресурсом. Ресурс инкапсулирует и представляет состояние объекта. Ресурс идентифицируется, адресуется и называется с использованием URI.

Свойства представляют собой пары "ключ = значение" и представляют состояние ресурса. Снимок этих свойств представляет собой представление ресурса. Конкретный вид представления и механизмы, применимые в этой точке зрения, определяются как интерфейсы. Взаимодействие с ресурсом выполняется в виде запросов и ответов, содержащих представления.

Экземпляр ресурса выводится из типа ресурса. Однонаправленная связь между одним ресурсом и другим ресурсом определяется как ссылка. Ресурс, содержащий свойства и ссылки, представляет собой коллекцию.

Набор свойств можно использовать для определения состояния ресурса. Это состояние может быть восстановлено или обновлено с использованием соответствующих представлений соответственно в ответе и запросе на этот ресурс.

Ресурс (и тип ресурса) может представлять и использоваться для раскрытия возможности. Взаимодействие с этим ресурсом может использоваться для осуществления или использования этой возможности. Такие возможности могут использоваться для определения процессов, таких как обнаружение, управление, реклама и т. Д. Например: "обнаружение ресурсов на устройстве" может быть определено как извлечение представления определенного ресурса, в котором свойство или свойства имеют значения, которые описывают или укажите ресурсы на устройстве.

Информация для запроса или ответа с изображением может передаваться "по проводам" путем сериализации с использованием протокола передачи или инкапсулированной в полезной нагрузке транспортного протокола - конкретный метод определяется нормативным отображением запроса или ответа на транспорт протокол. См. Раздел 11.8 для поддерживаемых транспортных протоколов.

Определения RAML, используемые в этом документе, являются нормативными. Это также включает в себя, что все определенные JSON-файлы должны соответствовать указанной схеме JSON. См. Приложение D для типов ресурсов, определенных в этой спецификации.

## 7. 2 Ресурс

Ресурс определяется одним или несколькими типами ресурсов - см. Приложение D для типа ресурсов.

В запросе CREATE Resource указывается один или несколько типов ресурсов, которые определяют этот ресурс.

 Ресурс размещен на устройстве. Ресурс должен иметь URI, как определено в разделе 6. URI может быть назначен Органом при создании Ресурса или может быть предварительно определен спецификацией Тип ресурса.

 ![](C:/Manual/OCF/figure/_7_2.png)

 Основными ресурсами являются Ресурсы, определенные в этой спецификации, чтобы обеспечить функциональные взаимодействия, как определено в разделе 10 (например, Обнаружение, Управление устройствами и т. Д.). Среди основных ресурсов "/oic/res", "/oic/p" и "/oic/d" должны поддерживаться на всех Устройств. Устройства могут поддерживать другие основные ресурсы в зависимости от функциональных взаимодействий, которые они поддерживают.

## 7. 3 Свойства

### 7.3.1 Введение

Свойство описывает аспект, который отображается через Ресурс, включая метаинформацию, связанную с этим Ресурсом.

Свойство должно иметь имя, то есть Property Name, и значение, т.е. Property Value. Свойство выражается в виде пары ключ-значение, где ключ - это Property Name и значение - это Property Value, как <Property Name> = <Property Value>. Например, если свойство "температура" имеет имя свойства "temp" и значение свойства "30F", то свойство выражается как "temp = 30F". Конкретный формат свойства зависит от схемы кодирования. Например, в JSON свойство представляется как "ключ": значение (например, "temp": 30).

Кроме того, определение Свойства должно содержать

- **Value Type** - определяет значения, которые может принимать значение свойства. Тип значения может быть простым типом данных (например, string, Boolean), как определено в разделе 3.4, или может быть сложным типом данных, определенным с помощью схемы. Тип значения может определять
  - **Value Rules** определяют правила для набора значений, которые может принимать значение свойства. Такие правила могут определять диапазон значений, формула min-max, набор перечислимых значений, шаблоны, условные значения и даже зависимости от значений других свойств. Правила могут использоваться для проверки конкретных значений в значении свойства и ошибки флага.
- **Mandatory** - указывает, является ли свойство обязательным или нет для данного типа ресурсов.
  - **Access modes** - указывает, может ли Свойство быть прочитано, изменено или и то, и другое. Обновления эквивалентны записи. "r" используется для чтения, а "w" используется для записи - оба могут быть указаны. Запись автоматически не подразумевает чтение.

Определение свойства может включать следующую дополнительную информацию - эти элементы являются информативными:

• **Property Title** - удобное для человека имя для обозначения свойства; обычно не отправляется по соединению

• **Description** - описательный текст, определяющий цель и ожидаемое использование этого свойства.

В общем, свойство имеет смысл только в пределах Ресурса, к которому он связан. Однако базовый набор свойств, который может поддерживаться всеми Ресурсами, известный как Общие свойства, сохраняет свою семантику без изменений в Ресурсах, т.е. их пара "ключ = значение" означает то же самое в любом ресурсе. Подробные таблицы с указанными выше полями для всех общих свойств определены в разделе

### 7.3.2. Общие свойства

#### 7.3.2.1 Введение

Общие свойства, определенные в этом разделе, могут быть указаны для всех ресурсов. Следующие Свойства определяются как Общие свойства: "Тип ресурса", "Интерфейс ресурсов", "Имя" и "Идентификатор ресурса".

Имя общего свойства должно быть уникальным и не должно использоваться другими свойствами. При определении нового типа ресурса его не общие свойства не должны использовать имя существующих общих свойств (например, "rt", "if", "n", "id"). При определении нового "общего свойства" следует убедиться, что его имя не использовалось никакими другими свойствами. Уникальность нового имени общего свойства можно проверить, проверив все свойства всех существующих типов ресурсов OCF. Однако это может стать громоздким по мере роста количества типов ресурсов. Чтобы предотвратить такие конфликты имен в будущем, OCF может зарезервировать определенное пространство имен для общего свойства. Потенциальными подходами являются (1) конкретный префикс (например, "oic") и имя, которому предшествует префикс (например, "oic.psize"), используется только для общего свойства; (2) имена, состоящие из одной или двух букв, зарезервированы для общего свойства, а все остальные свойства должны иметь имя длиной более двух букв; (3) Общие свойства могут быть вложены под определенным объектом, чтобы различать себя.

Возможность обновления общего свойства (которая поддерживает запись как режим доступа) ограничивается интерфейсом "oic.if.rw" (чтение-запись); таким образом, общее свойство должно обновляться с использованием интерфейса чтения и записи тогда и только тогда, когда свойство поддерживает доступ на запись, как определено определением Property и связанной с ним схемой для интерфейса read -write.

Следующие общие свойства для всех ресурсов указаны в разделе 7.3.2.2 через раздел 7.3. 2.6 и суммированы следующим образом:

- Тип ресурса ("rt") - это свойство используется для объявления типа ресурса этого ресурса. Поскольку ресурс может определяться более чем одним типом ресурсов, значение свойства свойства ресурса может быть использовано для объявления более одного типа ресурсов. Например: "rt": ["oic.wk.d", "oic.d.airconditionerer"] объявляет, что ресурс, содержащий это свойство, определяется либо типом ресурсов "oic.wk.d", либо "oic.d.airconditioneringer" Msgstr "Тип ресурса. Подробности см. В разделе 7.3.2.3.
- Интерфейс ("if") - это свойство объявляет интерфейсы, поддерживаемые ресурсом. Значение свойства свойства интерфейса может быть многозначным и отображать все поддерживаемые интерфейсы. Подробности см. В разделе 7.3.2.4.
- Имя ("n") - свойство объявляет "удобочитаемое" имя, присвоенное ресурсу. См. Раздел 7.3.2.5.
- Идентификатор ресурса ("id"): его значение свойства является уникальным (в пределах объема хост-сервера) идентификатором экземпляра для конкретного экземпляра ресурса. Кодирование этого идентификатора зависит от устройства и реализации. Подробности см. В разделе 7.3.2.6.

#### 7.3.2.2 Имена свойств и значений свойств

Имя свойства и значение свойства, используемые в этой спецификации:

- Имя свойства - ключ в паре "ключ = значение". Имя свойства чувствительно к регистру, а его тип данных - "строка". Имена свойств должны содержать только буквы от A до Z, от a до z, цифры от 0 до 9, дефис и точка и не должна начинаться с цифры.
- Значение свойства - значение в паре "ключ = значение". Значение свойства чувствительно к регистру, когда его тип данных "строка".

#### 7.3.2.3 Тип ресурса

Тип свойства ресурса указан в разделе 7.4.

#### 7.3.2.4 Интерфейс

Свойство интерфейса указано в разделе 7.6.

#### 7.3.2.5 Название

Человеческое дружественное имя для ресурса, то есть конкретное имя экземпляра ресурса(например, MyLivingRoomLight), свойство Name определено в таблице 2

Таблица 2. Определение свойства имени

| Property title | Property name | Value type | Value rule | Unit | Access mode | Mandatory | Description                           |
| -------------- | ------------- | ---------- | --------- | ---- | ---------- | --------- | ------------------------------------- |
| Name           | n             | string     |           |      | R, W       | no        | Понятное для человека имя для ресурса |

Свойством "Имя" является чтение-запись, если иное не ограничено типом ресурса (т. Е. Тип запроса не поддерживает UPDATE или не поддерживает UPDATE, используя чтение-запись).

#### 7.3.2.6 Идентификация ресурса

 Идентификатор ресурса должен быть уникальным (в пределах объема хост-сервера) идентификатором экземпляра для конкретного экземпляра ресурса. Кодирование этого идентификатора зависит от устройства и реализации, пока выполняется ограничение уникальности, отмечая, что реализация может использовать uuid, как определено в разделе 3.4. Идентификатор ресурса соответствует определению, указанному в таблице 3.

Таблица 3. Определение свойства имени

| Property title | Property name | Value type | Value rule | Unit | Access mode | Mandatory | Description                           |
| -------------- | ------------- | ---------- | --------- | ---- | ---------- | --------- | ------------------------------------- |
| Идентификатор ресурса | id          | string or uuid |           |      | R       | no        |  |


##  7.4. Тип ресурса

### 7.4.1. Вступление

Тип ресурсов - это класс или категория ресурсов, а ресурс - это экземпляр одного или нескольких типов ресурсов.

Типы ресурсов ресурса объявляются с использованием общего свойства типа ресурса, как описано в разделе 7.3.2.3, или в ссылке с использованием параметра типа ресурса.

 Тип ресурса может быть предварительно определен OCF или в пользовательских определениях производителями, конечными пользователями или разработчиками Устройства (типы ресурсов, определенные поставщиком). Типы ресурсов и их данные определения могут быть переданы вне диапазона (например, в документации) или явно определены с использованием метаязыков, которые могут быть загружены и использованы API или приложениями. OCF использует RAML и JSON Schema как метод спецификации для интерфейсов RESTful OCF и определения ресурсов.

 Каждый тип ресурса должен быть идентифицирован с идентификатором типа ресурса, который должен быть представлен с использованием требований и ABNF, определяющих атрибут типа ресурса в IETF RFC 6690 (раздел 2 для ABNF и раздел 3.1 для требований) с оговоркой, что сегменты разделены символом " ". (Период). Вся строка представляет идентификатор типа ресурса. При определении идентификатора каждый сегмент может представлять любую семантику, соответствующую типу ресурса. Например, каждый сегмент может представлять пространство имен. После определения идентификатора идентификатор следует использовать непрозрачно, и реализации не должны выводить информацию из отдельных сегментов.

Строка "oic", используемая в качестве первого сегмента в определении идентификатора типа ресурса, зарезервирована для типов ресурсов, определенных в OCF. Все определяемые OCF типы ресурсов должны быть зарегистрированы в реестре основных параметров IANA, как описано в документе IETF RFC 6690.

### 7.4.2  Resource Type Property

 Ресурс при создании или создании должен иметь один или несколько типов ресурсов, которые являются шаблоном для этого ресурса. Типы ресурсов, которые соответствует ресурс, должны быть объявлены с использованием общего свойства "rt" для ресурса. Значение свойства для общего свойства "rt" должно быть списком идентификаторов типов ресурсов для типов ресурсов, используемых в качестве шаблонов (т. Е. "rt" = <список идентификаторов типов ресурсов>).

Таблица 4. Тип ресурса Общее определение свойства

| Property title | Property name | Value type | Value rule                                             | Unit | Access mode | Mandatory | Description                                            |
| -------------- | ------------- | ---------- | ------------------------------------------------------ | ---- | ----------- | --------- | ------------------------------------------------------ |
| Resource type  | rt            | array      | Массив строк, содержащий идентификаторы типов ресурсов |      | R           | yes       | Имя свойства rt соответствует описанию в IETF RFC 6690 |

Типы ресурсов могут быть явно обнаружены или неявно распределены между пользователем (то есть клиентом) и хостом (то есть сервером) Ресурса.

### 7.4.3 Определение типа ресурса

Тип ресурса указывается следующим образом:

- **Pre-defined URI** (необязательно) - для определенного типа ресурса в спецификации OCF может быть указан предопределенный URI. Когда тип ресурса имеет предопределенный URI, все экземпляры этого типа ресурсов должны использовать только предопределенный URI. Экземпляр другого типа ресурса не должен использовать предопределенный URI.
- **Resource Type Title** (необязательно) - дружественное человеку имя для обозначения типа ресурса.
- **Resource Type ID** - значение свойства "rt", которое идентифицирует тип ресурса (например, "oic .wk.p").
- **Resource Interfaces** - список интерфейсов, которые могут поддерживаться типом Resource.
- **Properties** - определение всех свойств, которые относятся к типу ресурсов. Определение типа ресурса должно определять, является ли свойство обязательным, условным обязательным или необязательным.
- **Related Resource Types** (необязательно) - спецификация других типов ресурсов, которые могут быть указаны как часть типа ресурсов, применимые к коллекциям.
- **Mime Types** (необязательно) - типы mime, поддерживаемые ресурсом, включая сериализации (например, application/cbor, application/json, application/xml).

В таблице 5 и таблице 6 приведено описание иллюстративного типа ресурсов foobar и связанных с ним свойств.

Таблица 5. Пример типа ресурса foobar

| Pre-defined URI | Resource Type Title | Resource Type ID (“rt” value) | interfaces | Description | Related Functional Interaction | M/CR/O                     |
| -------------- | ------------- | ---------- | --------- | ---- | ---------- | ------------------------------------- |
| Resource type | foobar    | oic.r.foobar | “oic.if.a” | Example "foobar" resource | Actuation | O |

Таблица 6. Пример свойств foobar

| Property title | Property name | Value type | Value rule | Unit | Access mode | Mandatory | Description  |
| -------------- | ------------- | ---------- | ---------- | ---- | ----------- | --------- | ------------ |
| Resource type  | rt            | array      |            |      | R           | yes       | Тип ресурса  |
| Interface      | if            | array      |            |      | R           | yes       | Интерфейс    |
| Foo value      | value         | string     |            |      | R           | yes       | значение foo |

Экземпляр типа ресурса foobar показан ниже

```json
{
	"rt": ["oic.r.foobar"],
	"if": ["oic.if.a"],
	"value": "foo value"
} 
```

Пример схемы для типа ресурса foobar показан ниже

```json
{
	"$schema": "http://json-schema.org/draft-04/schema",
	"type": "object",
	"properties": {
        "rt": {
            "type": "array",
            "items" : {
                "type" : "string",
                "maxLength": 64
            },
            "minItems" : 1,
            "readOnly": true,
            "description": "Resource Type of the Resource"
        },
        "if": {
            "type": "array",
            "items": {
            "type" : "string",
            "enum" : ["oic.if.baseline", "oic.if.ll",
            "oic.if.b", "oic.if.lb", "oic.if.rw", "oic.if.r",
            "oic.if.a", "oic.if.s"]
        },
        "value": {"type": "string"}
	},
	"required": ["rt", "if", "value"]
}
```

### 7.4.4 Многозначный ресурс "rt"

Многозначный ресурс "rt" означает ресурс с несколькими типами ресурсов, где ни один из включенных типов ресурсов не обозначает известный тип ресурсов (т.e. "oic.wk. <thing>). Такой ресурс связан с несколькими типами ресурсов и поэтому имеет значение свойства "rt" для нескольких идентификаторов типа ресурса (например, "rt": ["oic.r.switch.binary", "oic.r.light.brightness"] ). Порядок идентификаторов типов ресурсов в значении свойства "rt" не имеет смысла. Например, "rt": ["oic.r.switch.binary", "oic.r.light.brightness"] и "rt": ["oic.r.light.brightness", "oic.r.switch .binary "] имеют одинаковое значение.

Типы ресурсов для многозначных ресурсов "rt" должны удовлетворять следующим условиям.

- **Property Name** - Имена свойств для каждого типа ресурсов должны быть уникальными (в рамках многозначного "rt" ресурса), за исключением общих свойств, иначе будет конфликтная семантика свойств. Если два типа ресурсов имеют свойство с тем же именем свойства, многозначный ресурс "rt" не должен состоять из этих типов ресурсов.

Многозначный ресурс "rt" удовлетворяет всем требованиям для каждого типа ресурсов и соответствует определениям RAML / JSON для каждого типа ресурса компонента. Таким образом, обязательные свойства многозначного ресурса "rt" должны быть объединением всех обязательных свойств каждого типа ресурсов. Например, обязательные свойства ресурса с "rt": ["oic.r.switch.binary", "oic.r.light.brightness"] - это "значение" и "яркость", где первая является обязательной для " oic.r.switch.binary ", а последний для" oic.r.light.brightness ".

Многозначный набор интерфейсов ресурсов "rt" должен быть объединением наборов интерфейсов из типов ресурсов компонента. Представление ресурсов в ответ на действие CRUDN на интерфейсе должно быть объединением схем, определенных для этого интерфейса. Интерфейс по умолчанию для многозначного ресурса "rt" должен быть базовым интерфейсом ("oic.if.baseline"), поскольку это единственный гарантированный общий интерфейс между типами ресурсов.

Для ясности, если каждый тип ресурса поддерживает один и тот же набор интерфейсов, тогда результирующий многозначный ресурс "rt" имеет тот же набор интерфейсов с интерфейсом по умолчанию baseline ("oic .if.baseline").

См. Раздел 7.10.3 для обработки параметров запроса применительно к многозначному ресурсу "rt".

## 7. 5 Тип устройства

Тип устройства - это класс устройства. Каждый определенный тип устройства будет содержать список минимальных типов ресурсов, которые устройство должно реализовать для этого типа устройства. Устройство может отображать дополнительные стандартные и определенные поставщиком типы ресурсов за пределами минимального списка. Тип устройства используется при обнаружении ресурсов, как указано в разделе 11.3.4.

Как и тип ресурса, тип устройства может использоваться в общем типе типа ресурса или в ссылке с использованием параметра типа ресурса.

Тип устройства может быть предварительно определен (в спецификации устройства OCF) или в пользовательских определениях производителями, конечными пользователями или разработчиками Устройства (типы устройств, определенные поставщиком). Типы устройств и их данные определения могут быть переданы вне диапазона (например, в документации).

Каждый тип устройства должен быть идентифицирован идентификатором типа ресурса с использованием тех же синтаксических ограничений, что и тип ресурса.

## 7.6. Интерфейс

### 7.6.1. Вступление

Интерфейс обеспечивает сначала представление в Ресурсе, а затем определяет запросы и ответы, допустимые для этого представления ресурса. Таким образом, это представление, предоставляемое интерфейсом, определяет контекст запросов и ответов на ресурс. Таким образом, тот же запрос к ресурсу, когда он нацелен на разные интерфейсы, может привести к различным ответам.

Интерфейс может быть определен либо этой спецификацией (Core Interface), либо спецификацией OCF Device ("вертикальный интерфейс"), либо производителями, конечными пользователями или разработчиками устройств ("интерфейс, определенный поставщиком").

Свойство Interface перечисляет все интерфейсы, поддерживаемые ресурсами. Все ресурсы должны иметь как минимум один интерфейс. Интерфейс по умолчанию должен быть определен спецификацией OCF и унаследован от определения типа ресурса. Интерфейс по умолчанию, связанный со всеми типами ресурсов, определенными в этой спецификации, должен быть поддерживаемым интерфейсом, указанным первыми в пределах применимого перечисления в определении типа ресурса (см. Приложение D). Все интерфейсы по умолчанию, указанные в спецификации OCF, должны быть обязательными.

В дополнение к любому определенному интерфейсу спецификации OCF все ресурсы должны поддерживать базовый интерфейс ("oic.if.baseline"), как определено в разделе 7.6.3.2.

 См. Раздел 7.10.4 для использования запросов, чтобы включить выбор конкретного интерфейса в запросе.

Интерфейс может принимать более одного типа носителя. Интерфейс может отвечать более чем одним типом носителя. Принятые типы носителей могут отличаться от типов медиаданных ответа. Типы носителей указываются с соответствующими параметрами заголовка в протоколе передачи. (ПРИМЕЧАНИЕ. Эта функция должна использоваться разумно и разрешена для оптимизации представлений на проводе). Каждый интерфейс должен иметь как минимум один тип носителя.

### 7.6.2 Свойства интерфейса

Таблица 7. Определение свойства ресурсного интерфейса

| Property title | Property name | Value type | Value rule                          | Unit | Access mode | Mandatory | Description                                                  |
| -------------- | ------------- | ---------- | ----------------------------------- | ---- | ----------- | --------- | ------------------------------------------------------------ |
| Interface      | if            | array      | Массив строк, содержащий интерфейсы |      | R           | yes       | Свойство для объявления интерфейсов, поддерживаемых ресурсом |

Интерфейсы, поддерживаемые ресурсом, должны быть объявлены с использованием Common Property Interface (Таблица 7) как "if = <array of Interfaces>". Значение свойства свойства интерфейса должно быть строчной строкой с сегментами, разделенными символом ".". (Точка). Строка "oic", используемая в качестве первого сегмента в значении свойства интерфейса, зарезервирована для OCF-определенных интерфейсов. Значение свойства интерфейса также может быть ссылкой на авторитет, аналогичный IANA, который может использоваться для определения определения интерфейса. Тип ресурса должен поддерживать один или несколько интерфейсов, определенных в разделе 7.6.3.

### 7.6.3  Методы интерфейса

#### 7.6.3.1 Обзор

Обозначенные OCF интерфейсы перечислены в таблице ниже

Таблица 8. Стандартные интерфейсы OCF

| Interface  | Name              | Applicable                   | Description                                                  |
| ---------- | ----------------- | ---------------------------- | ------------------------------------------------------------ |
| baseline   | “oic.if.baseline” | RETRIEVE, NOTIFY, UPDATE     | Интерфейс базовой линии определяет представление во всех   свойствах ресурса, включая мета-свойства. Этот интерфейс используется для полного представления ресурса. |
| links list | “oic.if.ll”       | RETRIEVE, NOTIFY             | Интерфейс "список ссылок" обеспечивает просмотр ссылок в   коллекции   (Ресурс). Поскольку ссылки представляют отношения с   другими ресурсами, интерфейсы списка ссылок могут использоваться для   обнаружения Ресурсов в контексте. Открытие выполняется путем извлечения   ссылок на эти ресурсы. Например: "Основной ресурс" /oic/res "использует   этот интерфейс, чтобы разрешить обнаружение" хоста "ресурсов на устройстве. |
| Batch      | “oic.if.b”        | RETRIEVE, NOTIFY,   UPDATE   | Пакетный интерфейс используется для одновременного   взаимодействия с коллекцией ресурсов. Это также устраняет необходимость того,   чтобы Клиент сначала обнаружил Ресурсы, которыми он манипулирует - Сервер   пересылает запросы и агрегирует ответы |
| read-only  | “oic.if.r”        | RETRIEVE   NOTIFY            | Интерфейс только для чтения предоставляет свойства   ресурса, который может быть "прочитан". Этот интерфейс не предоставляет   методы для обновления свойств или ресурса и поэтому может использоваться   только для чтения значений свойств. |
| read-write | “oic.if.rw”       | RETRIEVE,   NOTIFY,   UPDATE | Интерфейс чтения и записи предоставляет только те   свойства, которые могут быть "прочитаны" и "записаны", а также предоставляют   методы для чтения и записи свойств ресурса. |
| actuator   | “oic.if.a”        | RETRIEVE,   NOTIFY,   UPDATE | Интерфейс исполнительного механизма используется для   чтения или записи свойств ресурса привода. |
| sensor     | “oic.if.s”        | RETRIEVE,   NOTIFY           | Интерфейс датчика используется для считывания свойств   ресурса датчика. |

#### 7.6.3.2 Baseline Interface

##### 7.6.3.2.1 Обзор

Представление, видимое с использованием "базового" интерфейса, включает все свойства Ресурса, включая общие свойства. Интерфейс "базовый" должен быть определен для всех типов ресурсов. Все ресурсы должны поддерживать "базовый" интерфейс.

##### 7.6.3.2.2 Use of RETRIEVE

Интерфейс "базовый" используется, когда Клиент хочет получить все свойства ресурса; то есть сервер должен ответить представлением ресурсов, которое включает все реализованные Свойства Ресурса. Когда сервер не сможет отправить все представление ресурса, он должен ответить сообщением об ошибке. Сервер не должен возвращать частичное представление ресурсов.

Пример ответа на запрос RETRIEVE с использованием интерфейса базовой линии показан ниже:

```json
{
  "rt": ["oic.r.temperature"],
  "if": [ "oic.if.a", "oic.if.baseline"],
  "temperature": 20,
  "units": "C",
  "range": [0, 100 ]
}
```

##### 7.6.3.2.3 Use of UPDATE

Используя базовый интерфейс, все свойства ресурса, за исключением общих свойств, могут быть изменены с помощью запроса UPDATE со списком свойств и их желаемых значений, если для типа ресурса связана связанная схема для UPDATE с использованием базовой линии. Если интерфейсы, открытые Ресурсом в дополнение к базовому интерфейсу, не поддерживают семантику UPDATE, то UPDATE с использованием базового интерфейса также не поддерживается.

#### 7.6.3.3 Link List Interface

##### 7.6.3.3.1 Overview

Интерфейс списка ссылок предоставляет представление в списке ссылок в коллекции (ресурс). Представительство, видимое через этот интерфейс, имеет только ссылки, представленные как свойство (а), которое является (являются) массивом (или массивами) ссылок по ресурсу - поэтому этот интерфейс используется для управления или взаимодействия со списком ссылок в Коллекции. Список ссылок может быть RETRIEVEd с использованием этого интерфейса.

Определение и семантика интерфейса даны следующим образом:

- Имя интерфейса списка ссылок должно быть "oic.if.ll".
- В ответ на запрос RETRIEVE в интерфейсе "Список ссылок" URI ссылочных

Ресурсы должны быть возвращены в качестве ссылки URI.

- Если в ресурсе нет ссылок, то возвращается пустой список.
- Представительство, определяемое этим интерфейсом, зависит от запрашивающего Клиента. Для Клиента, который включает опцию OCF-Accept-Content-Format-Version, как определено в разделе 12.2.5 в запросе, ответ включает только значения (-и) свойства Property (-ies), которые являются массивами ссылок, следовательно ответ коллекции или /oic/res с oic.if.ll - это массив ссылок. Для клиента, который не включает опцию OCF-Accept-Content-Format-Version, ответ такой, как определено в E.5.

##### 7.6.3.3.2 Example: “links list” Interface

Пример: 

Запрос, чтобы получить ссылки ресурсов комнаты (ссылки могут ссылаться на свет, вентиляторы, электрические розетки и т. д.)

```
GET ocf://<devID>/a/room/1?if=oic.if.ll
```

Ответом будет массив ссылок OCF

```json
[
  {
    "href": "/the/light/1",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "eps":[
      {"ep": "coaps://[2001:db8:a::b1d4]:55555"}]
  },
  {
    "href": "/the/light/2",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "eps":  [
      {"ep": "coaps://[2001:db8:a::b1d4]:55555"}
    ]
  },
  {
    "href": "/my/fan/1",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "eps":[
      {"ep": "coaps://[2001:db8:a::b1d4]:55555"}
    ],
  {
    "href": "/his/fan/2",
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "eps":[
      {"ep": "coaps://[2001:db8:a::b1d4]:55555"}
    ]
  }
]
```

#### 7.6.3.4 Batch Interface

##### 7.6.3.4.1 Overview

Пакетный интерфейс используется для взаимодействия с коллекцией ресурсов с использованием одного / того же запроса.

Пакетный интерфейс может использоваться для RETRIEVE или UPDATE для свойств связанных ресурсов с помощью одного запроса.

Интерфейс партии определяется следующим образом:

- Имя интерфейса партии - "oic.if.b"
- Ресурс Collection связал ресурсы, которые представлены как URI. В свойстве "href" пакетной полезной нагрузки URI должен быть полностью квалифицирован для удаленных ресурсов и относительной ссылки для локальных ресурсов.
- Исходный запрос изменен для создания новых запросов, предназначенных для каждого из связанных ресурсов в коллекции, путем подстановки URI в исходном запросе с помощью URI связанного ресурса. Полезная нагрузка в исходном запросе реплицируется в полезной нагрузке новых запросов.
- Запросы должны быть перенаправлены при использовании интерфейса по умолчанию связанных ресурсов.
- Запросы должны быть отправлены только связанным ресурсам, которые идентифицируются типами отношений "item" или "host" ("host" - это значение типа отношения по умолчанию, если параметр "rel" не присутствует). Запросы не пересылаются связанным ресурсам, которые не содержат значений типа отношения "item" или "host".
- Свойства самого ресурса коллекции могут быть включены в полезные нагрузки с использованием интерфейса "oic.if.b", разоблачая одну ссылку со ссылкой "self" вместе с "элементом" в коллекции и гарантируя, что разрешение ссылки не может стать бесконечный цикл из-за рекурсивных ссылок. Например, если интерфейс по умолчанию для коллекции "oic.if.b", то сервер может рекурсивно включать его пакетное представление в своем пакетном представлении в бесконечном цикле. См. 7.6.3.4.2 на примере использования ссылки, содержащей "rel": ["self", "item"], чтобы включить в ресурс "oic.if.b" свойства ресурса коллекции вместе со связанными ресурсами. ,
- Если интерфейс по умолчанию для ресурса коллекции раскрывается с использованием отношения "Я", а интерфейс по умолчанию содержит "Свойства", которые раскрывают любые ссылки, эти свойства не должны включаться в пакетное представление, которое включает в себя "собственную" ссылку.
- Любой запрос, перенаправленный на связанный ресурс, который представляет собой сборник (включая ссылку "ссылка на себя"), должен иметь интерфейс по умолчанию связанного ресурса коллекции.
- Все ответы от связанных ресурсов должны быть объединены в один ответ Клиенту. Сервер может отсрочить ответ на временное окно, Сервер может выбрать любое соответствующее окно на основе условий.
- Если связанный ресурс не может обработать запрос, пустой ответ, то есть объект JSON без содержимого ("{}") в качестве представления свойства "rep" или ответ об ошибке, если связанный тип ресурса предоставляет схему ошибок или диагностическая полезная нагрузка, возвращается связанным ресурсом. Эти пустые или ошибочные ответы для всех связанных ресурсов, которые показывают ошибку, должны быть включены в агрегированный ответ на исходный запрос клиента. См. Пример в разделе 7.6.3.4.2.
- Если какой-либо из связанных ресурсов возвращает ответ об ошибке, агрегированный ответ, отправленный Клиенту, также должен указывать на ошибку (например, 4.xx в CoAP). Если все связанные ресурсы возвращают успешные ответы, агрегированный ответ должен включать код ответа на успех.
- Агрегированный ответ должен представлять собой массив объектов, представляющих ответы от каждого связанного ресурса. Каждый объект в ответе должен содержать как минимум два элемента: (1) URI связанного ресурса (полностью для удаленных ресурсов или относительной ссылки для локальных ресурсов) как "href": <URI> и (2) индивидуальный объект ответа или массив объектов, если связанный ресурс сам представляет собой коллекцию с использованием "rep" в качестве ключа, например "rep": {<представление индивидуального ответа>}.
- Если ресурс коллекции отмечен как Наблюдаемый, связанные ресурсы, указанные в Сборнике, могут наблюдаться с использованием пакетного интерфейса. Если ресурс коллекции не отмечен как Наблюдаемый, коллекция не может быть соблюдена, и Наблюдение запросов к Коллекции будет отклонено. Механизм наблюдения должен работать, как определено в 11.4.2, с запросом наблюдения, направленным каждому связанному ресурсу. Все ответы на запрос должны быть объединены в один ответ Клиенту с использованием тех же представлений и кодов состояния, что и для операций RETRIEVE с использованием пакетного интерфейса.
- Если какой-либо из наблюдаемых связанных ресурсов не соблюдает запрос наблюдения, ответ на запрос наблюдения за партиями также указывает, что весь запрос не был соблюден с использованием механизма, описанного в разделе 11.4.2.3.
- Если какой-либо из наблюдаемых ресурсов в запросе коллекции с использованием пакетного интерфейса отвечает с ошибкой или соблюдает отмену, Наблюдения за всеми другими связанными Ресурсами должны быть отменены, и Отслеживающий Клиент должен вернуть статус ошибки или Отменить отмену.
- Примечание. Поведение может отличаться для ссылок, которые выполняют network requests против локальных запросов Reso
- Все уведомления Клиенту, которые инициировали запрос наблюдения с использованием пакетного интерфейса, должны использовать пакетное представление для коллекции. Это агрегирование любых отдельных уведомлений о наблюдении, полученных устройством, на котором размещается Сборник, от отдельных запросов на наблюдение, которые были отправлены связанным ресурсам.
- Связанные ресурсы, которые не отмечены как наблюдаемые в ссылках коллекции, не должны вызывать уведомления, но могут быть включены в ответ и последующие уведомления, полученные в результате запроса Наблюдать за пакетным интерфейсом коллекции.
- Каждое уведомление должно содержать самые последние значения для всех связанных ресурсов, которые будут включены, если исходный запрос Observe был обработан повторно. Сервер, на котором размещена коллекция, может выбрать RETRIEVE все связанные ресурсы каждый раз, или может выбрать использование кэширования, чтобы избежать извлечения связанных ресурсов на каждое уведомление.
- Если связанный ресурс является наблюдаемым и ответил успешным ответом Observe, последнее сообщенное значение этого ресурса считается самым последним значением и может быть сообщено во всех последующих уведомлениях.
- Ссылки в коллекции должны соблюдаться с помощью интерфейса "oic.if.ll". Уведомление должно быть отправлено в любое время, когда содержимое представления интерфейса "oic.if.ll" будет изменено; то есть, если добавлена ссылка, если ссылка удалена или обновлена ссылка. Уведомления в интерфейсе "oic.if.ll" должны содержать все ссылки в представлении интерфейса "oic.if.ll".
- Другие свойства ресурса коллекции, если они есть, могут наблюдаться с использованием интерфейсов, определенных в определении для типа ресурса, включая использование интерфейса "oic.if.baseline".
- Если связанный ресурс не может обработать запрос, пустой ответ, то есть объект JSON без содержимого ("{}") в качестве представления для свойства "rep" или ответ об ошибке, должен связанный тип ресурса предоставить схему ошибок или диагностику полезная нагрузка, возвращается связанным ресурсом. Эти пустые или ошибочные ответы для всех связанных ресурсов, которые показывают ошибку, должны быть включены в агрегированный ответ на исходный запрос клиента. См. Пример в разделе 7.6.3.4.2.
- Если какой-либо из связанных ресурсов возвращает ответ об ошибке, агрегированный ответ, отправленный Клиенту, также должен указывать на ошибку (например, 4.xx в CoAP). Если все связанные ресурсы возвращают успешные ответы, агрегированный ответ должен включать код ответа на успех.
- Агрегированный ответ должен представлять собой массив объектов, представляющих ответы от каждого связанного ресурса. Каждый объект в ответе должен содержать как минимум два элемента: (1) URI связанного ресурса (полностью для удаленных ресурсов или относительной ссылки для локальных ресурсов) как "href": <URI> и (2) индивидуальный объект ответа или массив объектов, если связанный ресурс сам представляет собой коллекцию с использованием "rep" в качестве ключа, например "rep": {<представление индивидуального ответа>}.
- Если ресурс коллекции отмечен как Наблюдаемый, связанные ресурсы, указанные в Сборнике, могут наблюдаться с использованием пакетного интерфейса. Если ресурс коллекции не отмечен как Наблюдаемый, коллекция не может быть соблюдена, и Наблюдение запросов к Коллекции будет отклонено. Механизм наблюдения должен работать, как определено в 11.4.2, с запросом наблюдения, направленным каждому связанному ресурсу. Все ответы на запрос должны быть объединены в один ответ Клиенту с использованием тех же представлений и кодов состояния, что и для операций RETRIEVE с использованием пакетного интерфейса.
- Если какой-либо из наблюдаемых связанных ресурсов не соблюдает запрос наблюдения, ответ на запрос наблюдения за партиями также указывает, что весь запрос не был соблюден с использованием механизма, описанного в разделе 11.4.2.3.
- Если какой-либо из наблюдаемых ресурсов в запросе коллекции с использованием пакетного интерфейса отвечает с ошибкой или соблюдает отмену, Наблюдения за всеми другими связанными Ресурсами должны быть отменены, и Отслеживающий Клиент должен вернуть статус ошибки или Отменить отмену.
- Нет te: поведение может быть разным для ссылок, которые выполняют netwo rk re quests против локальных запросов Reso
- Все уведомления Клиенту, которые инициировали запрос наблюдения с использованием пакетного интерфейса, должны использовать пакетное представление для коллекции. Это агрегирование любых отдельных уведомлений о наблюдении, полученных устройством, на котором размещается Сборник, от отдельных запросов на наблюдение, которые были отправлены связанным ресурсам.
- Связанные ресурсы, которые не отмечены как наблюдаемые в ссылках коллекции, не должны вызывать уведомления, но могут быть включены в ответ и последующие уведомления, полученные в результате запроса Наблюдать за пакетным интерфейсом коллекции.
- Каждое уведомление должно содержать самые последние значения для всех связанных ресурсов, которые будут включены, если исходный запрос Observe был обработан повторно. Сервер, на котором размещена коллекция, может выбрать RETRIEVE все связанные ресурсы каждый раз, или может выбрать использование кэширования, чтобы избежать извлечения связанных ресурсов на каждое уведомление.
- Если связанный ресурс является наблюдаемым и ответил успешным ответом Observe, последнее сообщенное значение этого ресурса считается самым последним значением и может быть сообщено во всех последующих уведомлениях.
- Ссылки в коллекции должны соблюдаться с помощью интерфейса "oic.if.ll". Уведомление должно быть отправлено в любое время, когда содержимое представления интерфейса "oic.if.ll" будет изменено; то есть, если добавлена ссылка, если ссылка удалена или обновлена ссылка. Уведомления в интерфейсе "oic.if.ll" должны содержать все ссылки в представлении интерфейса "oic.if.ll".
- Другие свойства ресурса коллекции, если они есть, могут наблюдаться с использованием интерфейсов, определенных в определении для типа ресурса, включая использование интерфейса "oic.if.baseline".
- Клиент может выбрать ограничение связанных ресурсов, на которые перенаправляется запрос, включая дополнительные параметры запроса в запросе. Сервер должен обрабатывать любые дополнительные параметры запроса в запросе, который включает "oic.if.b" в качестве селекторов для связанных ресурсов, которые должны обрабатываться запросом.
- Клиент должен выполнять операции UPDATE с использованием пакетного интерфейса, создавая полезную нагрузку, которая похожа на полезную нагрузку ответа RETRIEVE из запроса пакетного интерфейса. Сервер отправляет отдельный запрос UPDATE каждому связанному ресурсу в соответствии с каждым свойством "href" и соответствующим значением свойства "rep".
- Если значение "href" пустое, обозначенное строкой нулевой длины или "" в JSON, свойство "rep"
- Если значение "href" пустое, обозначенное строкой нулевой длины или "" в JSON, свойство "rep" должно применяться к связанным ресурсам в коллекции.
- Элементы с пустым "href" и специфичным для ссылки "href" не должны смешиваться в одном и том же запросе UPDATE.
- Все свойства в запросе UPDATE могут не поддерживаться связанным ресурсом. В таких случаях редактируемые свойства в запросе UPDATE, которые поддерживаются связанным ресурсом, должны быть изменены, а свойства, которые не поддерживаются, должны игнорироваться молча.
- Ответ UPDATE должен содержать обновленные значения с использованием той же схемы полезной нагрузки, что и операции RETRIEVE, если она предоставлена связанным ресурсом, а также соответствующий код состояния. Совокупная полезная нагрузка отклика должна отражать известное состояние обновленных свойств после завершения пакетного обновления. Если никакой полезной нагрузки не предоставляется обновленным ресурсом, для этого ресурса должен быть предоставлен пустой ответ (т. Е. "Rep": {}).
- Коллекция не должна поддерживать использование операции UPDATE для добавления, изменения или удаления ссылок в существующей коллекции с использованием интерфейсов "oic.if.baseline" или "oic.if.rw" или "oic.if.a".

##### 7.6.3.4.2 Examples: Batch Interface

Обратите внимание, что приведенные примеры являются иллюстративными и не включают все обязательные элементы схемы во всех случаях. Предполагается, что интерфейс по умолчанию для типа ресурса "x.org.example.rt.room" указан в файле определения типа ресурса как "oic.if.rw", который предоставляет свойства "x.org.example.color" и " x.org.example.size ".

 Ресурсы

/a/room/1

```json
/a/room/1
{
	"rt": "x.org.example.rt.room"],
  	"if": ["oic.if.rw","oic.if.baseline","oic.if.b","oic.if.ll"],
    "x.org.example.colour": "blue",
    "x.org.example.dimension": "15bx15wx10h",
    "links": [
	    {
            "href": "/a/room/1",
            "rel": ["self", "item"],
            "rt": ["x.org.example.rt.room"],
            "if": ["oic.if.rw","oic.if.baseline","oic.if.b","oic.if.ll"],
            "p": {"bm": 2}
	    },
    	{
            "href": "/the/light/1",
            "rel": ["item"],
            "rt":  ["oic.r.switch.binary"], 
            "if": ["oic.if.a","oic.if.baseline"],
            "ins": "11111", 
            "p": {"bm": 2} 
	    },
    	{
            "href": "/the/light/2", 
            "rel": ["item"], 
            "rt": ["oic.r.switch.binary"], 
            "if": ["oic.if.a" ,"oic.if.baseline"],
            "ins": "22222", 
            "p": {"bm": 2} 
	    },
    	{
            "href": "/my/fan/1", 
            "rel": ["item"], 
            "rt": ["oic.r.switch.binary"], 
            "if": ["oic.if.a", "oic.if.baseline"],
            "ins": "33333", 
            "p": {"bm": 2} 
    	},
    	{
            "href": "/his/fan/2", 
            "rel": ["item"], 
            "rt": ["oic.r.switch.binary"], 
            "if": ["oic.if.a", "oic.if.baseline"],
            "ins": "44444", 
            "p": {"bm": 2} 
    	},
    	{
            "href": "/the/switches/1", 
            "rel": ["item"], 
            "rt": ["oic.wk.col"], 
            "if":["oic.if.ll", "oic.if.b", "oic.if.baseline"], 
            "ins": "55555", 
            "p": {"bm": 2} 
    	}
  	]
}
/the/light/1
{
	"rt": ["oic.r.switch.binary"],
	"if": ["oic.if.a", "oic.if.baseline"],
	"value": false
}
/the/light/2
{
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "value": true
}
/my/fan/1
{
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "value": true
}
/his/fan/2
{
    "rt": ["oic.r.switch.binary"],
    "if": ["oic.if.a", "oic.if.baseline"],
    "value": false
}
/the/switches/1
{
    "rt": ["oic.wk.col"],
    "if":["oic.if.ll", "oic.if.b", "oic.if.baseline"],
    "links": [
        {
            "href": "/switch-1a",
            "rt": ["oic.r.switch.binary"],
            "if": ["oic.if.a","oic.if.baseline"],
            "p": {"bm": 2}
        },
        {
            "href": "/switch-1b",
            "rt": ["oic.r.switch.binary"],
            "if": ["oic.if.a","oic.if.baseline"],
            "p": {"bm": 2 }
        }
	]
}
```

Использование пакетного запроса

```
GET /a/room/1?if=oic.if.b
```

Получает следующие индивидуальные запросы, выданные устройством в роли клиента.

```
GET /a/room/1 (ПРИМЕЧАНИЕ: использует интерфейс по умолчанию, как указано для ресурса коллекции, в этом примере oic.if.rw)
GET /the/light/1 (ПРИМЕЧАНИЕ. Использует интерфейс по умолчанию, как указано для этого ресурса)
GET /the/light/2 (ПРИМЕЧАНИЕ. Использует интерфейс по умолчанию, указанный для этого ресурса)
GET /my/fan/1 (ПРИМЕЧАНИЕ. Использует интерфейс по умолчанию, указанный для этого ресурса)
GET /his/fan/2 (ПРИМЕЧАНИЕ. Использует интерфейс по умолчанию, как указано для этого ресурса)
GET /the/switches/1?rt=oic.if.b (ПРИМЕЧАНИЕ. Использует пакетный интерфейс для коллекции, входящей в коллекцию)
```

пример успешного ответа

```json
[
    {
        "href": "/a/room/1",
        "rep":  {"x.org.example.colour":
        "blue","x.org.example.dimension": "15bx15wx10h"}
    },
    {
	    "href": "/the/light/1",
    	"rep": {"value": false}
    },
    {
    	"href": "/the/light/2",
    	"rep": {"value": true}
    },
    {
    	"href": "/my/fan/1",
    	"rep": {"value": true}
    },
    {
    	"href": "/his/fan/2",
    	"rep": {"value": false}
    },
    {
        "href": "/the/switches/1",
        "rep": [
            {"href": "/switch-1a", "rep": {"value": "true"}},
            {"href": "/switch-1b", "rep": {"value": "false"}}
        ]
    }
]
```

Если какой-либо из запросов RETRIEVE в предыдущем примере завершится неудачей, тогда ответ включает в себя пустую полезную нагрузку для этого экземпляра ресурса и отправляется код ошибки. В приведенном ниже примере предполагается, что ошибки «/my/fan/1» и «/the/switches/1»
Пример ответа с ошибкой:

```json
[
    {
        "href": "/a/room/1",
        "rep":  {"x.org.example.colour":
        "blue","x.org.example.dimension": "15bx15wx10h"}
    },
    {
        "href": "/the/light/1",
        "rep": {"value": false}
    },
    {
        "href": "/the/light/2",
        "rep": {"value": true}
    },
    {
        "href": "/my/fan/1",
        "rep": {}
    },
    {
        "href": "/his/fan/2",
        "rep": {"value": false}
    },
    {
        "href": "/the/switches/1",
        "rep": {}
    }
]
```

Пакетное обновление (UPDATE имеет семантику POST)  

Запрос:

```json
UPDATE /a/room/1?if=oic.if.b
[{
    "href": "",
    "rep": { "value": false }
}]
```

Поскольку значение «href» в запросе UPDATE пуст, запрос пересылается всем ресурсам в коллекции и становится:

```
UPDATE /a/room/1 { "value": false }
UPDATE /the/light/1 { "value": false }
UPDATE /the/light/2 { "value": false }
UPDATE /my/fan/1 { "value": false }
UPDATE /his/fan/2 { "value": false }
UPDATE /the/switches/1?if=oic.if.b { "value": false }
```

Ответ будет таким же, как ответ для GET /a/room/1?if=oic.if.b.
Поскольку /a/room/1 не имеет свойства «значение», выставленного его интерфейсом по умолчанию, запрос UPDATE будет игнорироваться и не будет включен в ответ UPDATE.

Пакетное обновление (UPDATE имеет семантику POST)  

```json
UPDATE /a/room/1?if=oic.if.b
[
    { "href": "/the/light/1", "rep": { "value": false }},
    { "href": "/the/light/2", "rep": { "value": true }},
    { "href": "/a/room/1", "rep": { "x.org.example.colour": "red"}}
]
```

Это выключает / /the/light/1, включает  /the/light/2 и устанавливает цвет  /a/room/1 на "красный".
Ответ будет таким же, как ответ для GET /a/room/1?if=oic.if.b с обновленными значениями свойств, как показано ниже.

```json
[
    {
        "href": "/a/room/1",
        "rep":{"x.org.example.colour": "red", "x.org.example.dimension": "15bx15wx10h"}
    },
    {
        "href": "/the/light/1",
        "rep": {"value": false}
    },
    {
        "href": "/the/light/2",
        "rep": {"value": true}
    }
]
```

Пример использования дополнительных параметров запроса для выбора элементов путем сопоставления параметров связи.

Включить свет 1 на основе значения параметров «ins» Link «11111»

```json
UPDATE /a/room/1?if=oic.if.b&ins=11111
[{ "href": "", "rep": {"value": false}}]
```

Как и в предыдущем примере, «href»: «» применяет запрос UPDATE ко всем ресурсам в коллекции. Поскольку дополнительный параметр запроса ins = 11111 выбирает только ссылки, имеющие соответствующее значение «ins», выбирается только одна ссылка. Полезная нагрузка применяется к целевому ресурсу этой ссылки, /the/light/1. 

Извлечение элемента с использованием одного и того же параметра запроса:

```
RETRIEVE /a/room/1?if=oic.if.b&ins=11111
```

Ответ:

```
[{"href": "/the/light/1","rep": {"value": false}}]
```

#### 7.6.3.5 Actuator Interface

Интерфейс исполнительного механизма представляет собой интерфейс для просмотра ресурсов, которые могут быть задействованы, то есть изменяет какое-либо значение внутри или состояние объекта, абстрагированного Ресурсом:

- Имя интерфейса исполнительного устройства должно быть «oic.if.a»
- Интерфейс исполнительного механизма должен отображать в представлении ресурсов все обязательные свойства, как определено применимым JSON; 

интерфейс исполнительного механизма может также отображаться в дополнительных свойствах представления ресурсов, как определено применимой схемой JSON, которые реализуются целевым устройством.

 Ресурс нагревателя (только для иллюстрации):

```json
/a/act/heater
{
    "rt": ["acme.gas"],
    "if": ["oic.if.baseline", "oic.if.r", "oic.if.a", "oic.if.s"],
    "settemp": 10,
    "currenttemp" : 7
}
```

Интерфейс «Привод» в отношении ресурса «Обогреватель» (только для иллюстрации):

Получение состояния привода:

```json
Запрос: GET /a/act/heater?if="oic.if.a"
Ответ: { "settemp": 10, "currenttemp" : 7 }
```

Корректное использование привода:

```json
Request: POST /a/act/heater?if="oic.if.a"
{ "settemp": 20 }
Response: { Ok }
```

Некорректное использование привода:

```json
Request: POST /a/act/heater?if="oic.if.a"
{ "if": ["oic.if.s"] } это видно через базовый интерфейс
Response: { Error }
```

- Запрос RETRIEVE с использованием этого Интерфейса должен возвращать Представление для этого Ресурса с учетом любых параметров запроса и фильтра, которые могут также существовать
- Запрос UPDATE с использованием этого интерфейса должен предоставить полезную нагрузку или тело, которое содержит Свойства, которые будут обновлены в целевом ресурсе.

#### 7.6.3.6 Sensor Interface

Интерфейс датчика - это интерфейс для извлечения измеренной, чувствительной или специфичной для конкретной информации информации из Ресурса, которая определяет:

- Имя интерфейса датчика должно быть «oic.if.s»
- Интерфейс датчика должен отображать в представлении ресурсов все обязательные свойства, как определено применимым JSON; интерфейс датчика также может отображаться в дополнительных свойствах представления ресурсов, как определено применимой схемой JSON, которые реализуются целевым устройством.

Запрос RETRIEVE, использующий этот интерфейс, должен вернуть это представление для ресурса под любые параметры запроса и фильтра, которые также могут существовать

```
1. Retrieving values of sensor
Request: GET /a/act/heater?if="oic.if.s"
Response: { "currenttemp": 7 }
2. Incorrect use of sensor
Request: PUT /a/act/heater?if="oic.if.s" PUT is not allowed
{ "settemp": 20 }  this is possible through actuator Interface
Response: { Error }
3. Incorrect use of sensor
Request: POST /a/act/heater?if="oic.if.s"  POST is not allowed
{ "currenttemp": 15 } this is possible through actuator Interface
Response: { Error }
```

#### 7. 6.3.7 Read-only Interface

 Интерфейс только для чтения предоставляет только свойства, которые могут быть прочитаны. Это включает в себя свойства, которые могут быть «только для чтения», «чтение-запись», но не «Свойства», «только для записи» или «только для установки». Применяемые методы, которые могут быть применены к ресурсу, только RETRIEVE. Попытка Клиента применить метод, отличный от RETRIEVE, к ресурсу, должна быть отклонена с кодом ответа на ошибку.

#### 7.6.3.8 Read-write Interface

 Интерфейс чтения и записи предоставляет только свойства, которые могут быть «прочитаны» и «записаны». Свойства «только для чтения» не должны включаться в представление для интерфейса «чтение-запись». Это общий интерфейс для поддержки «чтения» и «настройки» свойств в ресурсе. Применяемые методы, которые могут быть применены к ресурсу, только RETRIEVE и UPDATE. Попытка Клиента применить метод, отличный от RETRIEVE или UPDATE, к ресурсу, должна быть отклонена с кодом ответа на ошибку.

#### 7.7 Представление ресурсов

 Представление ресурсов фиксирует состояние ресурса в определенное время. Представление ресурсов обменивается в взаимодействиях запроса и ответа с ресурсом. Представление ресурсов может использоваться для извлечения или обновления состояния ресурса.

Представление ресурсов не должно обрабатываться протоколами и технологиями подключения к данным (например, CoAP, UDP / IP или BLE).

## 7.8 Структуры

### 7.8.1 Вступление

Во многих сценариях и контекстах ресурсы могут иметь либо неявную, либо явную структуру между ними. Структурой может быть, например, дерево, сетка, вентилятор или вентилятор. Рамки обеспечивают средства для моделирования и сопоставления этих структур и взаимосвязей между ресурсами. Основной структурный блок для структур ресурсов в Framework - это сборник. Коллекция представляет собой контейнер, который является расширяемым для моделирования сложных структур.

### 7.8.2. Связи ресурсов

Связи ресурсов выражаются как Ссылки. Ссылка охватывает и расширяет типизированную концепцию веб-ссылок как средство выражения отношений между ресурсами. Ссылка состоит из набора параметров, которые определяют:

- контекстный URI,
- целевой URI,
- отношение от URI контекста к целевому URI
- элементы, которые предоставляют метаданные о целевом URI, взаимосвязь или контекст ссылки.

Целевой URI является обязательным, а другие элементы в ссылке являются необязательными. Дополнительные элементы в ссылке могут быть сделаны обязательными на основе использования ссылок в разных контекстах (например, в коллекциях, в обнаружении, на мостах и т.д.). Схема полезной нагрузки Link приведена в Приложении D.

Пример ссылки показан в:

```json
{"href": "/switch", "rt": ["oic.r.switch.binary"], "if": ["oic.if.a", "oic.if.baseline"], "p": {"bm":3}, "rel": "item"}   
```

Две ссылки отличаются друг от друга, когда по крайней мере один параметр отличается. Например, две ссылки, показанные ниже, различны и могут отображаться в том же списке ссылок.

```json
{"href": "/switch", "rt": ["oic.r.switch.binary"], "if": ["oic.if.a", "oic.if.baseline"], "p": {"bm":2}, "rel": "item"}   
{"href": "/switch", "rt": ["oic.r.switch.binary"], "if": ["oic.if.a", "oic.if.baseline"], "p": {"bm":2}}  
```

Спецификация может задавать параметры и параметры, необходимые для определенных возможностей. Для всех ссылок, возвращаемых в ответ на RETRIEVE на «/ oic / res», если ссылка не содержит явно параметр «rel», предполагается значение «rel» = «hosts». Значение отношения «хосты» определяется IETF RFC 6690, значением «item» по IETF RFC 6573 и значением «self» по IETF RFC 4287 и все они зарегистрированы в реестре IANA для отношений связей, определенных в IANA Связи.

Как показано в D.2.8, отношение между URI контекста и целевым URI в ссылке задается с использованием элемента «rel» JSON, а значение этого элемента указывает конкретное отношение. Контекст URI ссылки неявно является URI ресурса (или, в частности, коллекции), который содержит ссылку, если ссылка не указывает параметр привязки. Параметр привязки используется для изменения URI контекста Link - связь с целевым URI основана на URI привязки, когда указан якорь. Параметр Anchor использует URI протокола передачи для OIC 1.1 Link (например, «anchor»: «coaps: // [fe80 :: b1d6]: 44444») и URI OCF, определенные в разделе 6 для ссылок OCF 1.0 (например, «anchor»: «ocf : // dc70373c-1e8d-4fb3-962e-017eaa863989" ).

Пример использования якорей в контексте Коллекций - пол имеет комнаты и комнаты с огнями - огни могут быть определены в полу как Ссылки, но ссылки будут иметь привязку к URI комнат, которые содержат огни (отношение содержит). Это позволяет включать и выключать все огни в полу, все еще имея огни, определенные в отношении комнат, которые их содержат (подсветка также может быть включена, используя также URI комнаты). См. Пример использования привязки в Link:

```json
/a/floor   
/*Примечание: /a/room1 имеет отношение «item» с /x/light1; не /a/floor */
{ "links": [{   
            "href":   "/x/light1",   
            "anchor": "/a/room1", 
            "rel": "item"   
}]}

/a/room1 
/* Примечание: /a/room1 "содержит" /x/light, так как /a/room1 является неявным контекстом URI */
{"links": [ 
    {"href": "/x/light1",   "rel": "item"   }
]}    

```

   

#### 7.8.2.1 Parameters

##### 7.8.2.1.1 “ins” or Link Instance Parameter

Параметр «ins» идентифицирует конкретный экземпляр ссылки в списке ссылок. Параметр «ins» может использоваться для изменения или удаления конкретной ссылки в списке ссылок. Значение параметра «ins» устанавливается при создании ссылки на устройство OCF (Server), на котором размещается список ссылок. После того, как он был установлен, параметр «ins» не должен изменяться до тех пор, пока Ссылка является членом этого списка.

##### 7.8.2.1.2 “p” or Policy Parameter

Параметр Policy определяет различные правила для правильного доступа к ресурсу, на который ссылается целевой URI. Правила политики настраиваются набором пар ключ-значение, как определено ниже.

 Параметр политики «p» определяется:

- клавиша «bm»: клавиша «bm» соответствует целочисленному значению, которое интерпретируется как 8-битовая битмаска. Каждый бит в битовой маске соответствует определенному правилу политики. Указаны следующие правила для "bm"

| Bit Position    | Policy rule  | Comment                                                      |
| --------------- | ------------ | ------------------------------------------------------------ |
| Bit 0 (the LSB) | discoverable | Правило обнаружения определяет, должна ли ссылка быть   включена в сообщение обнаружения ресурсов через «/oic/res».   • Если ссылка должна быть включена в сообщение обнаружения   ресурсов, тогда «p»   должен включать в себя клавишу «bm» и установить бит для обнаружения в значение 1.   • Если ссылка не включена в сообщение обнаружения   ресурсов, тогда «p»   либо включает в себя клавишу «bm»,   либо устанавливает бит обнаружения для значения 0 или полностью исключает   ключ «bm». |
| Bit 1 (2nd LSB) | observable   | Наблюдаемое правило определяет, поддерживает ли ресурс,   заданный целевым URI,   операцию NOTIFY. С   самосвязкой, то есть ссылка с «rel» значением «self»,   «/oic/res» может иметь ссылку с   целевым URI «/oic/res» и указывать на себя   наблюдаемым. «Я» определяется IETF RFC 4287 и зарегистрирован   в реестре IANA для   значения «rel»,   определенного в IANA Link Relations.       • Если ресурс поддерживает операцию NOTIFY, тогда «p» должен включать в себя клавишу «bm» и установить   наблюдаемый бит в значение 1.   • Если ресурс НЕ поддерживает операцию NOTIFY, тогда «p» должен либо включать в себя клавишу   «bm», либо установить   наблюдаемый бит в значение 0 или полностью опустить «bm». |
| Bits 2-7        | --           | Зарезервировано для будущего использования. Все   зарезервированные биты в «bm»   должны быть установлены в значение 0. |

Обратите внимание, что если все биты в «bm» определены равными 0, тогда ключ «bm» может быть полностью исключен из «p» в качестве меры эффективности. Однако, если какой-либо бит установлен в значение 1, тогда «bm» должен быть включен в «p», и все биты должны быть определены соответствующим образом. 1

- «sec» и «port» в остальных пулях должны использоваться только в полезной нагрузке ответа, когда
- запрос не включает опцию OCF-Accept-Content-Format-Version, как определено в разделе 12.2.5. В полезной нагрузке, отправленной в ответ на запрос, включающий опцию OCF-Accept-Content-Format-Version, «sec» и «port» не должны использоваться, и вместо этого параметр «eps» должен предоставить информацию для зашифрованного соединения. См. E.2.8 для схемы для параметра «p», который включает «сек» и «порт».
- Параметр «sec»: Параметр «sec» соответствует логическому значению, которое указывает, доступен ли доступ к ресурсу, на который ссылается целевой URL-адрес, через зашифрованное соединение. Если «sec» истинно, доступ к ресурсу осуществляется через зашифрованное соединение, используя указанный «порт» (см. Ниже). Если «sec» является ложным, доступ к ресурсу осуществляется через незашифрованное соединение или через зашифрованное соединение (если такое соединение выполняется с использованием настроек «port» для другого ресурса, для которого «sec» является истинным).
- Параметр «port»: клавиша «port» соответствует целочисленному значению, которое используется для указания номера порта, к которому может обращаться доступ к ресурсу, на который указывает целевой URI, через зашифрованное соединение.
- Если ресурс доступен только через зашифрованное соединение (т. Е. DTLS через IP), то
  - «p» должен включать ключ «sec», и его значение должно быть истинным.
  - «p» должен включать ключ «порт», а его значение - номер порта, в котором может быть установлено зашифрованное соединение.
- Если ресурс доступен только через незашифрованное соединение, то
  - «p» должен включать ключ «sec», а его значение должно быть ложным или «p» должен опустить ключ «sec»; значение по умолчанию «sec» равно false.
  - «p» должен опустить ключ «порт».
- Если ресурс доступен через шифрованное и незашифрованное соединение,
  - «p» должен включать ключ «sec», а его значение должно быть ложным или «p» должен опустить ключ «sec»; значение по умолчанию «sec» равно false.
  - «p» может опустить ключ «port». Если ключ «port» опущен, ресурс должен быть доступен с использованием той же «портовой» информации, что и другой ресурс на устройстве, для которого «сек» истинно.
- Доступ к ресурсу на порту, указанном ключом «порт», должен выполняться зашифрованным соединением (например, coaps: //). (Обратите внимание, что незашифрованное соединение с Ресурсом может быть возможным на отдельном порту, обнаруженном через обнаружение многоадресной рассылки).
- Обратите внимание, что доступ к ресурсу контролируется ACL для ресурса. Успешное зашифрованное соединение не гарантирует успешного выполнения запрошенного действия. Дополнительную информацию см. В разделе «Управление безопасностью OCF».

Пример 1: ниже показан параметр политики для ресурса, который можно обнаружить, но не наблюдаемый, и для которого аутентифицированные обращения должны выполняться через порт CoAPS 33275:

   "p":   { "bm": 1}   

Пример 2: ниже показана самосвязь, то есть связь «/ oic / res» сама по себе, которая может быть обнаружена и наблюдаема

```json
 {"href": "/oic/res",   "rel": "self","rt": ["oic.wk.res"],   "if": ["oic.if.ll", "oic.if.baseline"],   "p": {"bm": 3}  
```

##### 7.8.2.1.3       “type” or Media Type Parameter

Параметр «Тип» может использоваться для указания различных типов носителей, которые поддерживаются определенным целевым ресурсом. Тип «application / cbor» по умолчанию должен использоваться, когда элемент «type» опущен. Как только Клиент обнаруживает эту информацию для каждого ресурса, он может использовать одно из доступных представлений в соответствующем поле заголовка запроса или ответа

##### 7.8.2.1.4       “di” or Device ID parameter

Параметр «di» указывает идентификатор устройства, на котором размещается целевой ресурс, определенный в параметре «href».

Идентификатор устройства может использоваться для определения относительной ссылки, используемой в «href» или для информации о конечной точке поиска для относительной ссылки.

##### 7.8.2.1.5 “eps” Parameter

Параметр «eps» указывает информацию о конечной точке целевого ресурса «eps» имеет в качестве своего значения массив элементов, и каждый элемент представляет информацию о конечной точке с «ep» и «pri», как указано в 10.2. «ep» является обязательным, но «pri» является необязательным.

Пример «eps» с несколькими конечными точками:

```json
"eps":   [
    {"ep":   "coap://[fe80::b1d6]:1111", "pri":  2},
    {"ep":   "coaps://[fe80::b1d6]:1122"},
    {"ep":   "coap+tcp://[2001:db8:a::123]:2222", "pri": 3} 
]   
```

   Когда «eps» присутствует в ссылке, информация о конечной точке в «eps» может использоваться для доступа к целевому ресурсу, указанному параметром «href».

Обратите внимание, что тип Endpoint - Secure или Unsecure - который предоставляет ресурс, просто определяет тип (ы) подключения, который гарантированно доступен для отправки запросов в Ресурс. Например, если ресурс предоставляет только один CoAP «ep», он не гарантирует, что к ресурсу также нельзя получить доступ через защищенную конечную точку (например, через CoAPS «ep» из информации «eps» другого ресурса). Также не подвергая определенный тип конечной точки, убедитесь, что доступ к ресурсу будет предоставлен с использованием информации «ep». Независимо от того, предоставлены или запрещены ли запросы к ресурсу уровнем контроля доступа, отдельно от информации «eps» и определяется конфигурацией ресурса / acl2 (подробности см. В разделе 13.4.2 спецификации безопасности OCF).

Если присутствует, информация максимального возраста (например, опция Max-Age для CoAP, определенная в IETF RFC 7252), определяет, что максимальные значения времени «eps» могут быть кэшированы до того, как они считаются устаревшими.

#### 7.8.2.2 Formatting

При форматировании в JSON список ссылок должен быть массивом.

#### 7.8.2.3 List of Links in a Collection

Ресурс, который предоставляет одно или несколько свойств, которые определены как массив ссылок, в которых каждая ссылка может быть дискретно доступна, представляет собой коллекцию. Имя свойства «links» рекомендуется для такого массива ссылок.

 Ресурс со списком ссылок:

```json
/Room1   
{  
	"rt" : [ " my.room "] ,
    "if" : [ " oic.if.ll "   ,  " oic.if.baseline " ],
    "color " :  " blue ",
    "links" : [   
    	{   
    		"href": "/oic/d",
        	"rt": ["oic.d.light",   "oic.wk.d"],   
        	"if": [ "oic.if.r",  " oic.if.baseline " ],   
        	"p": {"bm": 1}   
        },   
        {   
        	"href": "/oic/p",   
        	"rt": ["oic.wk.p"],   
        	"if": [ "oic.if.r " ,   "oic.if.baseline" ],   
        	"p": {"bm": 1}   
        },   
        {   
        	"href": "/switch",   
        	"rt":   ["oic.r.switch.binary"],   
        	"if": [ "oic.if.a",  " oic.if.baseline " ],   
        	"p": {"bm": 3},   
        	"mt": [ "application/cbor   " ,  "   application/exi+xml" ]   
        },   
        {   
            "href": "/brightness",   
            "rt":   ["oic.r.light.brightness"],   
            "if": [ "oic.if.a "   ,  " oic.if.baseline" ],   
            "p": {"bm": 3}   
        }   
    ]  
}   
```

#### 7.8.2.4 Properties describing an array of Links

Если ресурс, который предоставляет массив ссылок (например, Collections, Atomic Measurements), имеет ограничения на типы ресурсов, которые могут находиться внутри массива, он должен определить свойство «rts», как определено в таблице 9, которое должно включать все разрешенные типы ресурсов для всех ссылок в массиве. Если «rts» не определено или является пустым массивом, то в массиве разрешен любой тип ресурса.

Таблица 9. Типы ресурсов Определение свойств

| Property title | Property name | Value type | Value rule                                | Unit | Access mode | Mandatory | Description                                                  |
| -------------- | ------------- | ---------- | ----------------------------------------- | ---- | ----------- | --------- | ------------------------------------------------------------ |
| Resource types | rts           | array      | Array of strings, conveying resource Type IDs |      | R           | no        | Массив типов ресурсов, которые поддерживаются в массиве ссылок, открытых Ресурсом. |

Если ресурс, который предоставляет массив ссылок, содержит типы ресурсов, которые являются обязательными в массиве, он должен определить свойство «rts-m», как определено в таблице 10, в котором перечислены обязательные типы ресурсов, которые содержатся в массиве. Если определено «rts-m», а «rts» определено и не является пустым массивом, то типы ресурсов, присутствующие в «rts-m», должны быть частью значений, присутствующих в «rts». Более того, если определено свойство «rts-m», оно должно быть санкционировано (то есть включено в «обязательное» поле определения JSON) в определениях ресурсов и данных самонаблюдения (см. Раздел 11,8).

Таблица 10. Обязательные типы ресурсов Определение свойства

| Property title         | Property name | Value type | Value rule                                | Unit | Access mode | Mandatory | Description                                                  |
| ---------------------- | ------------- | ---------- | ----------------------------------------- | ---- | ----------- | --------- | ------------------------------------------------------------ |
| Mandatory Resource Types | rts-m         | array      | Array of strings, conveying resource Type IDs |      | R           | no        | Массив типов ресурсов, которые обязательно должны отображаться в массиве Ссылки, представленные ресурсом |

### 7.8.3  Коллекции

#### 7.8.3.1 Обзор

Ресурс, содержащий одну или несколько ссылок (указанных как Ссылки) для других ресурсов, представляет собой коллекцию. Эти ссылки могут быть связаны друг с другом или просто быть списком; коллекция предоставляет средство для ссылки на этот набор ссылок с одним дескриптором (т.е. URI). Простой ресурс хранится отдельно от коллекции. Любой ресурс может быть превращен в коллекцию, привязывая ссылки ресурсов как ссылки. Коллекции могут использоваться для создания, определения или определения иерархии, индексов, групп и т.д.

Коллекция должна иметь по крайней мере один тип ресурса и, по крайней мере, один интерфейс, связанный в течение всего времени его жизни. Во время создания коллекции указываются тип ресурса и интерфейсы. Первоначальные определенные типы ресурсов и интерфейсы могут обновляться в течение его срока службы. Эти начальные значения могут быть переопределены с использованием механизма, используемого для переопределения в случае ресурса. Дополнительные типы ресурсов и интерфейсы могут быть привязаны к коллекции при создании или позже в течение жизненного цикла коллекции.

Коллекция должна определить свойство, которое представляет собой массив с нулевыми или более ссылками. Целевые URI в ссылках могут ссылаться на другую коллекцию или другой ресурс. Связанная коллекция или ресурс может находиться на том же устройстве, что и коллекция, которая включает эту ссылку (называемую локальной ссылкой) или может находиться на другом устройстве (называемом удаленной ссылкой). URI контекста ссылок в массиве должен (неявно) представлять собой коллекцию, содержащую это свойство. URI (неявный) контекста может быть переопределен с явной спецификацией параметра «привязки» в ссылке, где значение «anchor» является новой базой ссылки.

Ресурс может ссылаться более чем на одну коллекцию, поэтому уникальные отношения родитель-ребенок не гарантируются. Между сборкой и ресурсом, указанным в сборнике, не существует заранее определенных отношений, то есть приложение может использовать коллекции для представления отношения, но ни один из них не подразумевается или не определяется автоматически. Жизненные циклы коллекции и ссылочного ресурса также не зависят друг от друга.

Если свойство «drel» определено для коллекции, то все ссылки, которые явно не указывают отношения, должны наследовать эту связь по умолчанию в контексте этой коллекции. Отношение по умолчанию определяет неявное отношение между сборкой и целевым URI в ссылке. В приведенном ниже примере свойство «links» представляет список ссылок в коллекции. Свойство «links» имеет в качестве своего значения массив элементов, а каждый элемент - это ссылка:

```json
/my/house  ** URI Resource  
{
	"rt": ["my.r.house"],  ** Properties resource   
 	"color": "blue",   
 	"n": "myhouse",   
 	"links": [    **   parameters link 
 		{
    		"href": "/door", "rt": ["oic.r.door"], 
    		"if": ["oic.if.b", "oic.if.ll", "oic.if.baseline"]   
		},
		{
            "href": "/door/lock", "rt": ["oic.r.lock"], 
            "if": ["oic.if.b", "oic.if.baseline"],
            "type":   ["application/cbor", "application/exi+xml"]   
        },
		{   
            "href": "/light",   "rt": ["oic.r.light"],   
            "if": ["oic.if.s",   "oic.if.baseline"]   
        },
		{
            "href": "/binarySwitch", "rt": ["oic.r.switch.binary"],
            "if": ["oic.if.a", "oic.if.baseline"], "type": ["application/cbor"] 
        }   
] }   
```

  Коллекция может быть:

- Предварительно определенная коллекция, в которой коллекция была определена априори, а коллекция статична в течение всего срока ее службы. Такие коллекции могут использоваться для моделирования, например, устройства, состоящего из других устройств или фиксированного набора ресурсов, представляющих фиксированные функции.
- Локальная коллекция устройств, в которой коллекция используется только на устройстве, на котором размещена коллекция. Такие коллекции могут использоваться как краткосрочные для клиента для обращения ко многим серверам как к одному.
- Централизованная коллекция, в которой коллекция размещена на устройстве, но другие Устройства могут получить доступ или обновить коллекцию
- Хозяинская коллекция, в которой коллекция централизована, но управляется уполномоченным агентом или стороной.

#### 7.8.3.2 Свойства коллекции 

Коллекция должна определить свойство, которое является массивом ссылок (рекомендуется использовать «links») Кроме того, другие свойства могут быть определены для коллекции по типу ресурсов. Обязательные и рекомендуемые общие свойства для коллекции показаны в таблице 11. Этот список общих свойств в дополнение к тем, которые определены для ресурсов в разделе 7.3.2.

Таблица 11. Общие свойства для коллекций (в дополнение к общим свойствам, определенным в разделе 7.3.2)

| **Property**                 | **Description**                                              | **Property Name**              | **Value Type**                | **Mandatory** |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------ | ----------------------------- | ------------- |
| **Links**                    | Массив ссылок в коллекции                                    | Per Resource Type   definition | Json Array of Links           | Да            |
| **Resource Types**           | Список   разрешенных типов ресурсов для ссылок в коллекции.Если это свойство не   определено или является пустой строкой, то разрешен любой тип ресурса | Как определено в таблице 9     | Как определено в таблице 9    | Нет           |
| **Mandatory Resource Types** | Список типов ресурсов для ссылок, которые являются обязательными в коллекции | Как определено в таблице 10    | Как   определено в таблице 10 | Нет           |

#### 7.8.3.3 Тип ресурса по умолчанию

Тип ресурсов по умолчанию «oic.wk.col» доступен для коллекций. Этот тип ресурса должен использоваться только тогда, когда другой тип не был определен в коллекции или когда для создания коллекции не указан тип ресурса.

Тип ресурса по умолчанию обеспечивает поддержку общих свойств, включая массив ссылок с именами свойств «ссылки».

#### 7.8.3.4 Интерфейс по умолчанию

Все экземпляры коллекции должны поддерживать интерфейс ссылок («oic.if.ll») в дополнение к интерфейсу базовой линии («oic.if.baseline»). Экземпляр коллекции может опционально поддерживать дополнительные интерфейсы, определенные в этой спецификации. Интерфейс по умолчанию для коллекции должен быть списком ссылок («oic.if.ll»), если в определении типа ресурса не указано иное.

### 7.8.4 Atomic Measurement

#### 7.8.4.1 Обзор

В некоторых случаях использования требуется, чтобы свойства нескольких ресурсов были доступны только как группа, и индивидуальный доступ к этим свойствам каждого ресурса клиентом запрещен. Тип ресурса Atomic Measurement определен для удовлетворения этого требования. Это достигается за счет использования пакетного интерфейса.

#### 7.8.4.2 Свойства атомных измерений

Атомное измерение должно определять свойство, которое является массивом ссылок (рекомендуется использовать ссылки «Имя» свойства »). Кроме того, другие свойства могут быть определены для Atomic Measurement по типу ресурсов. Обязательные и рекомендуемые общие свойства для атомного измерения показаны в таблице 12. Этот список общих свойств в дополнение к тем, которые определены для ресурсов в разделе 7.3.2.

```json
/my/house  /* URI Resource */
{
  "rt": ["my.r.house"],   /*Properties resource*/
  "color": "blue",
  "n": "myhouse",
  "links": [       /*parameters link*/
    {
      "href": "/door",
      "rt": ["oic.r.door"],
      "if": ["oic.if.b",   "oic.if.ll", "oic.if.baseline"]
    },
    {
      "href": "/door/lock",
      "rt": ["oic.r.lock"],
      "if": ["oic.if.b", "oic.if.baseline"],
      "type":   ["application/cbor", "application/exi+xml"]
    },
    {
      "href": "/light",
      "rt": ["oic.r.light"],
      "if": ["oic.if.s",   "oic.if.baseline"]
    },
    {
      "href": "/binarySwitch",
      "rt":   ["oic.r.switch.binary"],
      "if": ["oic.if.a",   "oic.if.baseline"],
      "type":   ["application/cbor"]
    }
  ]
}
```

Таблица 12. Общие свойства для атомного измерения (в дополнение к общим свойствам, определенным в разделе [7.3.] (# Стр. 41) 2)

| **Property**                 | **Description**                                              | **Property Name**              | **Value Type**           | **Mandatory** |
| ---------------------------- | ------------------------------------------------------------ | ------------------------------ | ------------------------ | ------------- |
| **Links**                    | The array of Links in the Atomic Measurement                 | Per Resource Type   definition | Json Array of Links      | Yes           |
| **Resource Types**           | Список   разрешенных типов ресурсов для ссылок в атомном измерении. Если это свойство   не определено или является пустой строкой, то разрешен любой тип ресурса | As defined in Table 9          | As defined in Table 9    | No            |
| **Mandatory Resource Types** | Список   типов ресурсов для ссылок, которые являются обязательными в Atomic Measurement. | As   defined in Table 10       | As   defined in Table 10 | No            |

####    7.8.4.3 Нормативное поведение

 Нормативное поведение атомного измерения выглядит следующим образом:

1. Поведение интерфейса партии («oic.if.b») на атомном измерении определяется следующим образом:
   + Поддерживаются только операции RETRIEVE и NOTIFY, для пакетного интерфейса, по атомному измерению; поведение операций RETRIEVE и NOTIFY должно быть таким же, как указано в 7.6.3.4, с исключениями, как указано в 7.8.4.3.
   + Операция UPDATE не разрешена для пакетного интерфейса по атомному измерению; если операция UPDATE получена, это должно привести к тому, что метод не допускает код ошибки.
   + Ответ на ошибку не должен включать какое-либо представление связанного ресурса (т. е. пустой ответ для всех связанных ресурсов).
2. Любой связанный ресурс в рамках атомного измерения (т. Е. Целевой ресурс связи в атомном измерении) подчиняется следующим условиям:
   + Связанные ресурсы в рамках атомного измерения и само атомное измерение существуют на одном сервере.
   + Операции CRUDN не допускаются к связанным ресурсам и приводят к запрещенному коду ошибки.
   + Связанные ресурсы не должны раскрывать интерфейс «oic.if.ll». Поскольку операции CRUDN не разрешены в связанных ресурсах, интерфейс «oic.if.ll» никогда не будет доступен.
3.  Ссылки на связанные ресурсы в атомном измерении должны быть доступны только через «oic .if.ll» или «oic.if.baseline» Интерфейсы атомного измерения.
    + Связанные ресурсы не перечислены в «/ oic / res».
5.  Связанный ресурс в атомном измерении должен определять один из «oic.if.a», «oic.if.s», «oic .if.r» или «oic.if.rw» в качестве его интерфейса по умолчанию ,
6.  Не все связанные ресурсы в атомном измерении должны быть наблюдаемыми. Если измерение Atomic измеряется с использованием интерфейса «oic.if.b», уведомления об ответах не генерируются, если связанные ресурсы, которые не отмечены Observable, обновляются или изменяются.
7.  Все связанные ресурсы в атомном измерении должны быть включены в каждый ответ RETRIEVE и Observe при использовании интерфейса «oic.if.b».
8.  Атомное измерение должно поддерживать интерфейсы «oic.if.b» и «oic.if.ll».
9.  Фильтрация связанных ресурсов в атомном измерении не допускается. Параметры запроса, которые выбирают один или несколько отдельных связанных ресурсов в запросе на атомное измерение, должны приводить к «запрещенному» коду ошибки.
10.  Если параметр «rel» Link включен в ссылку, содержащуюся в Atomic Measurement, он должен иметь либо «хосты», либо «элемент».
11.  Интерфейс по умолчанию для атомного измерения - «oic.if.b».

#### 7. 8.4. 4 соображения безопасности

 Права доступа к атомному измерению гарантируют права доступа к связанным ресурсам (см. Раздел 12.2.6.2 «Безопасность OCF»).

#### 7.8.4.5 Тип ресурса по умолчанию

 Тип ресурса определяется как «oic.wk.atomicmeasurement». 

Таблица 13. Тип ресурса атомного измерения

| Pre-defined URI | Resource Type Title | Resource Type ID (“rt” value) | interfaces                            | Description                                                  | Related Functional Interaction | M/CR/O |
| --------------- | ------------------- | ----------------------------- | ------------------------------------- | ------------------------------------------------------------ | ------------------------------ | ------ |
| none            | Atomic Measurement  | oic.wk.atomicmea surement      | “oic.if.ll“ “oic.if.baseline" “oic.if.b“ | Специализация шаблона Collection для обеспечения атомарного RETRIEVAL его выделенных ресурсов | RETRIEVE, NOTIFY                | O      |

Таблица 14. Свойства для атомного измерения (в дополнение к общим свойствам, определенным в разделе 7.3.2)

| Property title | Description                                          | Property name            | Value Type         | Mandatory |
| -------------- | ---------------------------------------------------- | ------------------------ | ------------------ | --------- |
| Links          | Набор ссылок, которые указывают на связанные ресурсы | Определение типа ресурса | json Array of Links | yes       |

## 7.9. Расширения третьих сторон

В этом разделе описывается, как сторонняя сторона может добавлять типы устройств, типы ресурсов, определяемые третьей стороной свойства к существующему или определенному стороннему типу ресурса, третьими указанными значениями перечисления для существующих параметров перечисления и третьих сторон для существующего определенного свойства.

Третья сторона может указать дополнительные (не OCF) ресурсы в OCF-устройстве. Третья сторона может также указать дополнительные свойства в пределах существующего типа ресурса OCF. Кроме того, третье лицо может распространять определенное перечисление OCF с третьими определенными значениями.

Определенный сторонним типом устройства может выставлять как определенные сторонними, так и OCF типы ресурсов. Определенный третьей стороной Тип устройства должен предоставить обязательные ресурсы для всех OCF-устройств, определенных в этой спецификации.

Определенный сторонним типом ресурса должен включать любые обязательные свойства, определенные в этой спецификации, а также любые вертикальные заданные обязательные свойства. Все свойства, определенные в стороннем определенном типе ресурсов, которые являются частью пространства имен OCF, которые не являются общими

Свойства, определенные в этой спецификации, должны соответствовать правилам, указанным третьими лицами в Таблице 15.

В следующей таблице определяются правила синтаксиса для сторонних элементов типа ресурса. Внутри таблицы термин «имя_домена» относится к доменному имени, которое принадлежит третьей стороне, которая определяет новый элемент.

Таблица 15. Определенные сторонними элементами ресурсов

|                                                              |                                  | Resource Element                              | Vendor Definition Rules |
| ------------------------------------------------------------ | -------------------------------- | --------------------------------------------- | ----------------------- |
| New 3rd party defined Device Type                            | “rt” Property Value of   “/oic/d | x. <Domain_Name>   .<resource identification> |                         |
| New 3rd party defined Resource Type                          | “rt” Property Value              | x. <Domain_Name>   .<resource identification> |                         |
| New 3rd party defined Property within the OCF   namespace    | Property Name                    | x. <Domain_Name>   .<property>                |                         |
| Additional 3r d party defined values   i n an OCF speci fied enumeration | Enumeration Property Value       | x. <Domain_Name>   .<enum value>              |                         |
| Additional 3rd party defined parameter in an OCF specified Property | Parameter key word               | x. <Do main_Name>   .<parameter keyword>      |                         |

Что касается использования Domain_Name в этой схеме, метки меняются на противоположные от того, как они появляются в DNS или других механизмах разрешения. Сторона 3r d определяет тип устройства и тип ресурса, иначе следуйте правилам, определенным в разделе 7.4.2 «Свойство типа ресурса». Определенные третьи стороны типы ресурсов должны быть зарегистрированы в реестре параметров параметров IANA Constained RESTful Environments (CoRE).

Для примера:

x.com.samsung.galaxyphone.accelerator

x.com.cisco.ciscorouterport

x.com.hp.printerhead

x.org.allseen.newinterface.newproperty

## 7.10 Параметры запроса

### 7.10.1 Вступление

Свойства и параметры (включая те, которые являются частью ссылки) могут использоваться в части запроса URI (см. Раздел 6.2.1) как один критерий для выбора конкретного Ресурса. Это делается путем объявления свойства (т. Е. <Имя свойства> = <требуемое значение свойства>) в качестве одного из сегментов запроса. В фильтрах запросов разрешены только строки ASCII, а символы NULL запрещены в фильтрах запросов. Это означает, что только значения свойств с символами ASCII могут быть сопоставлены в фильтрах запросов.

Ресурс выбирается, когда все объявленные свойства или параметры связи в запросе соответствуют соответствующим свойствам или параметрам связи в целевом объекте.

### 7.10.2 Использование нескольких параметров в запросе

Когда запрос содержит несколько отдельных параметров запроса, они разделяются символом «&», как описано в разделе 6.2.1.

 Клиент может применить несколько отдельных параметров запроса, например "?ins=11111&rt=oic.r.switch.binary". Если такие запросы поддерживаются сервером, это должно быть выполнено путем сопоставления «всех» различных типов параметров запроса («rt», «ins», «if» и т. Д.) С целью запроса. В примере это разрешает экземпляр oic.r.switch.binary, который также имеет «ins», заполненный как «11111». Порядок следования параметров значения не имеет.

Клиент может выбрать более одного типа ресурсов с использованием повторяющихся параметров запроса, например «? rt=oic.r.switch.binary & rt = oic.r.ramptime». Если такие запросы поддерживаются Сервером, это должно быть выполнено путем сопоставления «любого из» параметров повторного запроса с целевым объектом запроса. В этом примере можно выбрать любые экземпляры «oic.r.switch.binary» и / или «oic.r.ramptime», которые могут существовать.

Клиент меня объединяет как несколько повторяющихся параметров, так и несколько отдельных параметров в одном запросе, например «if = oic.if.b & ins = 11111 & rt = oic.r.switch.binary & rt = oic.r.ramptime». Если такие запросы поддерживаются Сервером, это должно быть выполнено путем сопоставления «любых» параметров повторного запроса и последующего сопоставления «всех» различных типов параметров запроса. В этом примере любые экземпляры «oic.r.switch.binary» и / или «oic.r.ramptime», которые также имеют «ins» из «11111», которые могут существовать, выбираются в пакетном ответе.

Обратите внимание, что параметры в строке запроса представлены в реальном протоколе обмена сообщениями, как определено в разделе 12.

### 7.10.3 Применение к многозначным ресурсам «rt»

Запрос «rt» для многозначного ресурса «rt» с интерфейсом по умолчанию «oic.if.a», «oic.if.s», «oic.if.r», «oic.if.rw» или «oic.if.baseline» является расширением общего запроса «rt». Когда сервер получает запрос RETRIEVE для многозначного ресурса «rt» с запросом «rt» (например, GET /ResExample?rt=oic.r.foo), сервер должен отвечать только тогда, когда значением запроса является элемент значения свойства «rt» целевого ресурса и должны отправлять обратно только связанные с Свойства

с запросом (-ами). Например, после получения GET /ResExample?rt=oic.r.switch.binary таргетинга на ресурс с помощью «rt»: ["oic.r.switch.binary", "oic.r.light.brightness"], сервер отвечает только Свойствами oic.r.switch.binary.

### 7.10.4. Конкретные аспекты интерфейса для запросов

#### 7.10.4.1 Выбор интерфейса

Когда для запроса должен быть выбран интерфейс, он должен быть указан как параметр запроса в URI ресурса в сообщении запроса. Если параметр запроса не указан, следует использовать интерфейс по умолчанию. Если выбранный интерфейс не является одним из разрешенных интерфейсов в ресурсе, тогда выберите, что Интерфейс является ошибкой, и Сервер должен ответить кодом ошибки.

Например, базовый интерфейс можно выбрать, добавив «if = oic.if.baseline» в список параметров запроса в URI целевого ресурса. Например: «GET /oic/res?if=oic.if.baseline».

#### 7.10.4.2 Пакетный интерфейс

Подробные сведения о самом интерфейсе пакета см. В разделе 7.6.3.4. Параметры запроса могут использоваться с пакетным интерфейсом для выбора определенных ресурсов в коллекции для извлечения или обновления; эти параметры используются для выбора элементов в коллекции путем сопоставления значений параметров ссылки. Когда параметры запроса выбора ссылок используются с операциями RETRIEVE, применяемыми с использованием пакетного интерфейса, должны возвращаться только ресурсы в коллекции с соответствующими параметрами связи.

Когда параметры запроса выбора канала используются с операциями UPDATE, применяемыми с использованием пакетного интерфейса, необходимо обновлять только ресурсы, имеющие соответствующие параметры связи. См. 7.6.3.4.2 для примеров операций RETRIEVE и UPDATE, которые используют параметры запроса выбора канала.