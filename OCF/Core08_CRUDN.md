[Copyright Open Connectivity Foundation, Inc. © 2016-2018. All rights Reserved](https://openconnectivity.org/)

# 8 CRUDN

## 8.1 Overview

CREATE, RETRIEVE, UPDATE, DELETE и NOTIFY (CRUDN) - это операции, определенные для манипулирования ресурсами. Эти операции выполняются Клиентом на ресурсах, содержащихся в N серверах.

При получении действительной операции CRUDN Сервер, на котором размещен Ресурс, являющийся целью запроса, должен сгенерировать ответ в зависимости от интерфейса, включенного в запрос; или на основе интерфейса по умолчанию для типа ресурса, если интерфейс не включен.

Операции CRUDN используют набор параметров, которые передаются в сообщениях и определены в таблице 16. Устройство должно использовать CBOR в качестве схемы кодирования полезной нагрузки (контента) по умолчанию для представлений ресурсов, включенных в операции CRUDN и ответы операций; Устройство может согласовывать другую схему кодирования полезной нагрузки (например, см. в разделе 12.2.4 обмен сообщениями CoAP). В следующих подразделах описываются операции CRUDN и использование параметров. Определения типов для этих терминов будут отображаться в разделе сообщений для каждого протокола.

| Применимость | Название | Обозначение        | Определение                                                  |
| ------------ | -------- | ------------------ | ------------------------------------------------------------ |
| All messages | fr       | from               | URI отправителя сообщения.                                   |
|              | to       | to                 | URI получателя сообщения.                                    |
|              | ri       | Request Identifier | Идентификатор, который однозначно идентифицирует сообщение в инициаторе и получателе |
|              | cn       | Content            | Информация, относящаяся к операции                           |
| Requests     | op       | Operation          | Конкретная операция, запрашиваемая Сервером.                 |
|              | obs      | Observe            | Индикатор для запроса наблюдения.                            |
| Responses    | rs       | Response Code      | Индикатор результата запроса; было ли это принято и каково было заключение операции. Значения кода ответа для операций CRUDN должны соответствовать значениям, определенным в разделах 5.9 и 12.1.2 в IETF RFC 7252 |
|              | obs      | Observe            | Индикатор для ответа наблюдения.                             |

## 8.2     CREATE

Операция CREATE используется для запроса создания новых ресурсов на сервере. Операция CREATE инициируется клиентом и состоит из трех этапов, как показано на рисунке 9 и описано ниже.

![Figure 9. CREATE operation](figure\09.png)

## 8.2.1 CREATE Request

Сообщение запроса CREATE передается Клиентом на Сервер для создания сервером нового ресурса. Сообщение запроса CREATE будет содержать следующие параметры:

- fr: уникальный идентификатор клиента
- to: URI целевого ресурса, отвечающего за создание нового ресурса.
- ri: Идентификатор запроса CREATE
- cn: информация о ресурсе, который будет создан сервером
   i) cn будет включать URI и свойство Resource Type создаваемого ресурса.
   ii) cn может включать в себя дополнительные свойства ресурса, который будет создан.
- op: CREATE

### 8.2.2 Обработка сервером

После получения запроса CREATE Сервер может проверить, имеет ли Клиент соответствующие права для создания запрошенного ресурса. Если проверка прошла успешно, Сервер создает запрошенный ресурс. Сервер кэширует значение параметра ri в запросе CREATE для включения в ответное сообщение CREATE.

### 8.2.3 CREATE ответ

Сервер должен передать ответное сообщение CREATE в ответ на сообщение запроса CREATE от Клиента. Ответное сообщение CREATE будет содержать следующие параметры.

- fr: Уникальный идентификатор Сервера

- to: Уникальный идентификатор Клиента

- ri: идентификатор, включенный в запрос CREATE

- cn: информация о ресурсе, созданном сервером.

  i) cn будет включать URI созданного ресурса.

  ii) cn будет включать в себя представление ресурса созданного ресурса.

- • rs: результат операции CREATE


## 8.3 RETRIEVE

Операция RETRIEVE используется для запроса текущего состояния или представления ресурса.

Операция RETRIEVE инициируется клиентом и состоит из трех этапов, как показано на рисунке 10 и описано ниже.

![Figure 10. RETRIEVE operation](figure\10.png)

### 8.3.1 RETRIEVE request

ПОЛУЧИТЬ сообщение с запросом передается Клиентом на Сервер для запроса представления Ресурса с Сервера. Сообщение запроса RETRIEVE будет содержать следующие параметры.

- fr: уникальный идентификатор клиента
- to: URI ресурса, на который ориентирован Клиент
- ri: идентификатор запроса RETRIEVE
- op: ПОЛУЧИТЬ

### 8.3.2 Обработка сервером

После получения запроса RETRIEVE Сервер может проверить, имеет ли Клиент соответствующие права на получение запрошенных данных и свойства доступны для чтения. Сервер кэширует значение параметра ri в запросе RETRIEVE для использования в ответе.

### 8.3.3 RETRIEVE response

Сервер должен передать ответное сообщение RETRIEVE в ответ на сообщение запроса RETRIEVE от Клиента. Ответное сообщение RETRIEVE будет содержать следующие параметры.

- fr: Уникальный идентификатор Сервера

- to: Уникальный идентификатор Клиента

- ri: Идентификатор включен в запрос RETRIEVE.

- cn: информация о ресурсе по запросу клиента

  i) cn должен включать URI ресурса, намеченного в запросе RETRIEVE

- rs: результат операции RETRIEVE

## 8. 4 UPDATE

Операция UPDATE  является либо частичным обновлением, либо полной заменой информации в ресурсе в сочетании с интерфейсом, который также применяется к операции. Операция  UPDATE  инициируется клиентом и состоит из трех этапов, как показано на рисунке 11 и описано ниже.

![Figure 11. UPDATE operation](figure\11.png)

### 8.4.1 UPDATE request

Сообщение запроса UPDATE передается Клиентом на Сервер для запроса обновления информации о Ресурсе на Сервере. Сообщение запроса UPDATE будет содержать следующие параметры.

• fr: уникальный идентификатор клиента

• to: URI ресурса, предназначенного для обновления информации

• ri: Идентификатор запроса UPDATE

• op: UPDATE

• cn: информация, включая свойства, ресурса, который будет обновлен на целевом ресурсе

### 8.4.2 Обработка сервером

После получения запроса UPDATE Сервер может проверить, имеет ли Клиент соответствующие права на обновление запрошенных данных. Если проверка прошла успешно, Сервер обновляет информацию о целевом ресурсе в соответствии с информацией, содержащейся в параметре cn сообщения запроса UPDATE. Сервер кэширует значение параметра ri в запросе UPDATE для использования в ответе.

Запрос UPDATE, который включает в себя Свойства, доступные только для чтения, должен быть отклонен Сервером с rs, указывающей на неверный запрос.

Запрос UPDATE должен применяться только к свойствам в целевом ресурсе, видимым через прикладной интерфейс, который поддерживает операцию. UPDATE несуществующих свойств игнорируется.

Запрос UPDATE должен быть применен к свойствам в целевом ресурсе, даже если эти значения свойств совпадают со значениями, которые в настоящее время предоставляются целевым ресурсом.

#### 8.4.2.1 Мониторинг ресурсов сервером

Сервер должен контролировать состояние Ресурса, указанного в запросе наблюдения от Клиента. Каждый раз, когда происходит изменение в состоянии наблюдаемого ресурса или операции UPDATE, примененной к Ресурсу, Сервер отправляет другой ответ RETRIEVE с указанием наблюдения. Механизм не позволяет Клиенту указывать какие-либо ограничения или ограничения, которые инициируют уведомление, решение остается полностью за Сервером.

#### 8.4.2.2 Дополнительные ответы RETRIVE с указанием наблюдения

Сервер должен передавать обновленные ответные сообщения RETRIEVE после наблюдаемых изменений в состоянии Ресурсов, запрошенных Клиентом. Ответное сообщение RETRIEVE должно содержать параметры, перечисленные в разделе 11.4.2.3.

### 8.4.3 UPDATE response

Ответное сообщение UPDATE будет включать следующие параметры:

• fr: Уникальный идентификатор Сервера

• to: Уникальный идентификатор Клиента

• ri: идентификатор включен в запрос UPDATE

• rs: результат запроса UPDATE

Ответное сообщение UPDATE может также включать следующие параметры:

• cn: представление ресурса после обработки запроса UPDATE

## 8.5 DELETE

Операция DELETE используется для запроса на удаление ресурса. Операция DELETE инициируется клиентом и состоит из трех этапов, как показано на рисунке 12 и описано ниже.

![Figure 12. DELETE operation](figure\12.png)

### 8.5.1 DELETE Request

Сообщение запроса DELETE передается Клиентом на Сервер для удаления Ресурса на Сервере. Сообщение запроса DELETE будет содержать следующие параметры:

- fr: уникальный идентификатор клиента

- to: URI целевого ресурса, который является целью удаления

- ri: идентификатор запроса DELETE

- op: DELETE

### 8.5.2 Обработка сервером

После получения запроса DELETE Сервер может проверить, имеет ли Клиент соответствующие права на удаление идентифицированного ресурса и существует ли указанный ресурс.
Если проверка прошла успешно, Сервер удаляет запрошенный ресурс и удаляет всю связанную информацию. Сервер кэширует значение параметра ri в запросе DELETE для использования в ответе.

### 8.5.3 DELETE response

Сервер должен передать ответное сообщение DELETE в ответ на сообщение запроса DELETE от Клиента. Ответное сообщение DELETE будет содержать следующие параметры.

- fr: Уникальный идентификатор Сервера

- to: уникальный идентификатор клиента

- rs: результат операции DELETE

## 8.6 NOTIFY

### 8.6.1 Обзор

Операция NOTIFY используется для запроса асинхронного уведомления об изменениях состояния. Полное описание операции NOTIFY приведено в 11.4. Операция NOTIFY использует ответное сообщение NOTIFICATION, которое определено здесь.

### 8.6.2 Ответ УВЕДОМЛЕНИЯ

Ответное сообщение NOTIFICATION отправляется сервером для уведомления URL-адресов, указанных клиентом, об изменении состояния. Ответное сообщение NOTIFICATION содержит следующие параметры.

- fr: Уникальный идентификатор Сервера.
- to: URI цели Resource сообщения NOTIFICATION.
- ri: Идентификатор включен в запрос CREATE.
- op: УВЕДОМЛЕНИЕ.
- cn: обновленное состояние ресурса.

