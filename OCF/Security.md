# 1 Область применения

Эта спецификация определяет цели безопасности, философию, ресурсы и механизм, которые влияют на базовые уровни OCF основной спецификации OCF. Основная спецификация OCF содержит информативное содержание безопасности. Спецификация безопасности OCF содержит нормативный контент безопасности и может содержать информативный контент, связанный с базой OCF или другими спецификациями OCF.

# 3 Термины, определения и сокращенные термины

## 3.1 Термины и определения

Для целей этого документа применяются термины и определения, данные в ISO / IEC 30118-1: 2018, а также следующие.
ИСО и МЭК содержат терминологические базы данных для использования в стандартизации по следующим адресам:

- Интернет-платформа ISO: доступна по адресу https://www.iso.org/obp
- IEC Electropedia: доступно на http://www.electropedia.org/

### 3.1.40 Owned

 (или "в собственности государства") имеющее свойство "own" ресурса «/oic/sec/doxm», равное «TRUE»

### 3.1.41 Unowned

Неизвестный (или «в неизвестном состоянии»)
имеющий свойство "own" ресурса "/oic/sec/doxm", равное "FALSE"

## 3.2 Сокращенные термины

AC - Контроль доступа
ACE- Вход контроля доступа
ACL - список контроля доступа
AES - расширенный стандарт шифрования
Примечание 1 к записи: См. NIST FIPS 1 97, «Расширенный стандарт шифрования (AES)»
AMS - Служба управления доступом
CMS - Служба управления учетными данными
CRUDN - СОЗДАТЬ, ПОЛУЧИТЬ, ОБНОВИТЬ, УДАЛИТЬ, УВЕДОМЛЕНИЕ
CSR - запрос на подпись сертификата
CVC - Сертификат проверки кода
ECC - криптография с эллиптическими кривыми
ECDSA - алгоритм цифровой подписи с эллиптической кривой
EKU - Внешнее завершение использования ключей
EPC - учетные данные встроенной платформы
EPK - встроенный открытый ключ
DOTS - Служба передачи прав собственности на устройства
DPKP - динамическая пара открытых ключей
ID - личность / идентификатор
JSON - Нотация объектов JavaScript.
Примечание 1 к записи: См. ISO / IEC 30118-1: 2018.
JWS - веб-подпись JSON.
Примечание 1 к записи: S ee IETF RFC 7515, «Веб-подпись JSON (JWS)»
KDF - функция деривации ключа
MAC - код аутентификации сообщения А
MITM - Человек посередине
NVRAM - энергонезависимая память с произвольным доступом
OC - учетные данные владельца
OCSP - протокол статуса онлайн-сертификата
OBT - Инструмент адаптации
OID - идентификатор объекта
OTM - Метод передачи собственника
OOB - вне диапазона
OWASP - Открытый проект безопасности веб-приложений.
Примечание 1 к записи: См. Https://www.owasp.org/
PE - Механизм политик
PIN - персональный идентификационный номер
PPSK - общий ключ с аутентификацией PIN-кодом
PRF - псевдослучайная функция
PSI - интерфейс постоянного хранилища
PSK - Общий ключ
RBAC - Контроль доступа на основе ролей
RM - менеджер ресурсов
RNG - Генератор случайных чисел
SACL - подписанный список управления доступом
SBAC - предметный контроль доступа
SEE - Безопасная среда выполнения
SRM - Менеджер секретных ресурсов
SVR - виртуальный ресурс безопасности
SW - Программное обеспечение
UAID - уникальный аутентифицируемый идентификатор
URI - унифицированный идентификатор ресурса
Примечание 1 к записи: См. ISO / IEC 30118-1: 2018.
VOD - виртуальное устройство OCF
Примечание 1 к записи: См. ИСО / МЭК 30118-3: 2018.

# 4 Условные обозначения и организация документов

## 4.1 Условные обозначения

Этот документ определяет ресурсы, протоколы и соглашения, используемые для реализации безопасности для базовой инфраструктуры и приложений OCF.
В этом документе применяются термины и определения, приведенные в ISO / IEC 30118-1: 2018.
На рисунке 1 показано взаимодействие между устройствами OCF.



###### Рисунок 1 - Взаимодействие OCF

Устройства могут реализовывать роль клиента, которая выполняет действия на серверах. Действия получают доступ к ресурсам, управляемым серверами. Стек OCF обеспечивает применение политик доступа к ресурсам. Сквозное взаимодействие с устройством может быть защищено с использованием протокола защиты сеанса (например, DTLS) или методами шифрования данных.

# 5 Обзор безопасности

Это информативный раздел. Целью архитектуры безопасности OCF является защита ресурсов и всех аспектов HW и SW, которые используются для поддержки защиты ресурсов. С точки зрения OCF, устройство является логическим объектом, который соответствует спецификациям OCF. Во взаимодействии между Устройствами Устройство, действующее в качестве Сервера, удерживает и контролирует Ресурсы и предоставляет Устройству, действующему в качестве Клиента, доступ к этим Ресурсам с учетом набора механизмов безопасности. Платформа, на которой размещено Устройство, может обеспечить усиление безопасности, которое потребуется для обеспечения устойчивости множества операций, описанных в этой спецификации.

Теория безопасности работы описана в следующих шагах.

![Рисунок 2 - Слои OCF](.\figure\sec002.gif)

Рисунок 2 - Слои OCF

1. Клиент устанавливает сетевое соединение с Сервером (Устройство, на котором хранятся Ресурсы). Уровень абстрагирования подключения обеспечивает возможность подключения устройств, несмотря на различия в параметрах подключения.

1. Устройства (например, Сервер и Клиент) обмениваются сообщениями либо с, либо без взаимно аутентифицируемого безопасного канала между двумя Устройствами.

    - Res Ресурс oic.sec.cred на каждом Устройстве содержит учетные данные, используемые для взаимной аутентификации и (если применимо) проверки сертификата.

    - Сообщения, полученные по защищенному каналу, связаны с deviceUUID. В случае удостоверения сертификата, deviceUUID находится в сертификате, полученном от другого Устройства. В случае учетных данных симметричного ключа deviceUUID настраивается с учетными данными в ресурсе oic.sec.cred.

    - Сервер может связать Клиента с любым количеством ролей. В случае взаимной аутентификации с использованием сертификата roleid (если есть) предоставляется в сертификатах ролей; они настраиваются Клиентом на Сервер. В случае симметричного ключа разрешенный roleid (если есть) настраивается с учетными данными в oic.sec.cred.
    - Запросы, полученные Сервером по незащищенному каналу, считаются анонимными и не связаны с каким-либо deviceUUID или roleid.

3. Клиент отправляет запрос на Сервер.
4. Сервер получает запрос.
    a) Если запрос получен по незащищенному каналу, Сервер обрабатывает запрос как анонимный, и никакие deviceUUID или roleid не связаны с запросом.
    b) Если запрос получен по безопасному каналу, то Сервер связывает deviceUUID с запросом, а Сервер связывает все действительные roleid Клиента с запросом.
    c) Затем сервер обращается к списку контроля доступа (ACL) и ищет запись ACL, соответствующую следующим критериям:
      - Запрошенный ресурс соответствует ссылке на ресурс в ACE.

      - Запрошенная операция разрешена "разрешениями" ACE, и

      - «subjectUUID» содержит либо одно из специального набора подстановочных значений, либо, если устройство не является анонимным, субъект соответствует идентификатору клиента, связанному с запросом, или действительному ролевому идентификатору, связанному с запросом. Значения подстановочных знаков соответствуют либо всем устройствам, осуществляющим связь через сеанс с проверкой подлинности и шифрованием, либо всем устройствам, осуществляющим связь через сеанс без проверки подлинности и незашифрованные.

Если есть соответствующий ACE, то доступ к Ресурсу разрешен; в противном случае доступ запрещен. Доступ осуществляется с помощью диспетчера защищенных ресурсов сервера (SRM).

5. Сервер отправляет ответ обратно Клиенту.

Защита ресурсов включает защиту данных как во время отдыха, так и во время транспортировки. Следует отметить, что, помимо механизмов контроля доступа, спецификация безопасности OCF не включает в себя спецификацию безопасного хранения Ресурсов, пока они хранятся на Серверах. Однако в состоянии покоя защита ресурсов безопасности, как ожидается, будет обеспечена за счет сочетания безопасного хранения и контроля доступа. Безопасное хранение может быть достигнуто за счет использования аппаратной безопасности или шифрования данных в состоянии покоя. Точное внедрение безопасного хранения зависит от ряда требований по усилению безопасности, указанных в разделе 14, и может быть предметом руководящих принципов сертификации.
Защита данных при передаче, с другой стороны, будет полностью указана в качестве нормативной части данной спецификации. При транзите защита может быть предоставлена на уровне ресурсов или на транспортном уровне. Эта спецификация поддерживает только защиту при транспортировке на транспортном уровне посредством использования таких механизмов, как DTLS. Следует отметить, что DTLS будет обеспечивать защиту пакетов по пакетам, а не защиту полезной нагрузки в целом. Например, если требуется целостность всей полезной нагрузки в целом, должны быть уже созданы отдельные механизмы подписи перед передачей пакета на транспортный уровень.

![Рисунок 3](.\figure\sec003.png)

Рисунок 3 - Точки обеспечения безопасности OCF

- Устройство имеет право на связь с облаком OCF, если доверенный посредник предоставил устройство.
- Устройство и посредник соединяются через DTLS, используя /oic/sec/cred
- Устройство предоставляется Посредником со следующей информацией:
  - URI Облака OCF
  - Токен, который может быть проверен OCF Cloud
  - UUID облака OCF

## 5.2 Контроль доступа

Инфраструктура OCF предполагает, что Ресурсы размещаются на Сервере и предоставляются Клиентам с учетом механизмов контроля доступа и авторизации. Ресурсы в конечной точке защищены посредством реализации контроля доступа, аутентификации и защиты конфиденциальности. В этом разделе представлен обзор контроля доступа (AC) с использованием ACL. Однако ожидается, что AC в стеке OCF не зависит от уровня абстракции транспорта и связности.

Реализация контроля доступа опирается на априорное определение набора политик доступа для Ресурса. Политики могут храниться локальным ACL или службой управления доступом (AMS) в форме записей управления доступом (ACE). Можно применять два типа механизмов контроля доступа:

Control Управление доступом на основе субъекта (SBAC), где каждый ACE будет сопоставлять субъект (например, идентификатор запрашивающего лица) запрашивающего объекта с субъектом, включенным в политику, определенную для ресурса. Утверждение личности запрашивающего требует процесса аутентификации.
Control Контроль доступа на основе ролей (RBAC), где каждый ACE будет сопоставлять идентификатор роли, включенный в политику для ресурса, с идентификатором роли, связанным с запросчиком.
Если сервер OCF получает пакетный запрос к ресурсу атомарных измерений, содержащему только локальные ссылки, и существует ACE, соответствующий ресурсу атомарных измерений, который разрешает запрос, то сервер OCF разрешает соответствующие запросы к связанным ресурсам. Настоящий параграф должен применяться к любому типу ресурса, основанному на типе ресурса атомных измерений.

 

Примечание. Определение ресурса атомных измерений запрещает прямой доступ к связанным ресурсам. Характер Атомного Измерения также запрещает обновлять «ссылки» для добавления или удаления Ресурсов. Следовательно, нет риска повышения привилегий при использовании ACE Ресурса измерения Atomics для управления доступом к связанным ресурсам.

Если сервер OCF получает пакетный запрос к ресурсу сбора, содержащему только локальные ссылки, и существует ACE, соответствующий ресурсу сбора, который разрешает запрос, то сервер OCF разрешает соответствующие запросы к связанным ресурсам. Настоящий параграф должен применяться к любому типу ресурса на основе типа ресурса коллекции.

Примечание. Это означает, что ACE Ресурса Коллекции разрешают доступ ко всем связанным Ресурсам Коллекции через пакетный интерфейс, даже если отсутствуют ACE, разрешающие прямой доступ к некоторым или всем связанным Ресурсам. Если не будет жестко регулироваться, это может привести к повышению привилегий. В основной спецификации OCF предусмотрены ограничения на использование ресурсов сбора, чтобы снизить риск повышения привилегий. Например, Базовая спецификация OCF запрещает обновлять «ссылки» Ресурса Коллекции с целью получения доступа к добавленному Ресурсу в соответствии с
ТУЗ Коллекции, когда в противном случае доступ к Ресурсу был бы запрещен.

В модели управления доступом OCF доступ к экземпляру Resource требует соответствующей политики управления доступом. Это означает, что каждое Устройство, действующее как Сервер, должно иметь ACE, разрешающий доступ к каждому Ресурсу, который он защищает. Этот критерий может быть удовлетворен для
Ресурс A, если существует ACE, разрешающий пакетные запросы для доступа к Ресурсу B, содержащему Ссылку на Ресурс A, даже если нет ACE, разрешающих запросы, которые обращаются к Ресурсу A напрямую. Примерами типа ресурса для ресурса B являются тип ресурса атомарного измерения и тип ресурса коллекции. Отсутствие ACE, разрешающего доступ к Ресурсу, напрямую или через Ссылку, приводит к недоступности Ресурса.

ACE применяется только в том случае, если ACE соответствует как субъекту (т.е. клиенту OCF), так и запрашиваемому ресурсу. Существует несколько способов сопоставления субъекта: (1) DeviceID, (2) Role Identifier или (3) подстановочный знак. Способ подключения клиента к серверу может быть релевантным контекстом для принятия решений по управлению доступом. Сопоставление с подстановочными знаками в соединениях с проверкой подлинности и без проверки подлинности, а также с шифрованием и незашифрованием позволяет широко применять политику доступа к предметным классам.

Пример политики сопоставления с подстановочными знаками:

```json
"aclist2": [
  {
    "subject": {
      "conntype": "anon-clear"
    },
    " resources": [
      {
        "wc": "*"
      }
    ],
    " permission": 31
  },
  {
    " subject": {
      " conntype": "auth-crypt"
    },
    " resources": [
      {
        "wc": "*"
      }
    ],
    " permission": 31
  }
]
```

Подробности формата ACL определены в разделе 12. ACL состоит из одного или нескольких ACE. ACL определяет политику управления доступом для Устройств.
Ресурс ACL требует такой защиты, как и его чувствительные Ресурсы, когда речь идет как о хранении, так и об обработке с помощью SRM и PSI. Таким образом, для защиты ACL необходимо рассмотреть усиление защиты базовой платформы (HW и SW), и, как поясняется в пункте 5.2.2, ACL могут иметь разные уровни области видимости, и поэтому усиление защиты необходимо специально рассматривать для каждого уровня охвата. Например, физическое устройство может содержать несколько реализаций Устройства и, следовательно, защищенное хранилище, необходимо учитывать использование и настройку списков ACL для разных серверов на одном и том же устройстве.

### 5.2.1 Архитектура ACL

#### 5.2.1.1 Общие сведения об архитектуре ACL

 

 

## 5.3. Обзор адаптации

### 5.3.1 Общие вопросы по адаптации

 Перед тем, как Устройство начнет работать в среде OCF и сможет взаимодействовать с другими Устройствами, его необходимо соответствующим образом подключить. Первым шагом при подключении устройства является настройка владельца, когда законный пользователь, который владеет / приобретает устройство, использует инструмент адаптации (OBT), а использование OBT использует один из методов передачи владельца (OTM) для установления права собственности. Как только право собственности установлено, OBT становится механизмом, с помощью которого затем может быть подготовлено Устройство, в конце которого Устройство начинает работать и может взаимодействовать с другими Устройствами в среде OCF.

![Рисунок 2 - Слои OCF](.\figure\sec010.png)

Рисунок 10 - Обзор адаптации

В этом разделе описывается процесс подготовки и обеспечения безопасности, но при этом аспекты обеспечения безопасности не рассматриваются в других спецификациях OCF. В контексте безопасности все Устройства должны быть обеспечены минимальной конфигурацией безопасности, которая позволяет Устройству безопасно взаимодействовать с другими Устройствами в среде OCF / связываться с ними. Эта минимальная конфигурация безопасности определена как «Встроенное устройство», «Готовое к нормальной работе», и указана в разделе 7.5.

Внедрения и инициализация могут использовать сервисы, определенные вне этой спецификации, ожидается, что при использовании других сервисов доверие между подключаемым устройством и различными инструментами не является переходным. Это означает, что загружаемое устройство будет индивидуально аутентифицировать учетные данные каждого инструмента, используемого в процессе адаптации; что инструменты не разделяют учетные данные или подразумевают доверительные отношения, если они не были установлены.

### 5.3.2 Действия на борту

Блок-схема ниже показывает типичные шаги, которые выполняются во время регистрации. Хотя регистрация может включать в себя различные этапы, не связанные с безопасностью, основное внимание на диаграмме уделяется конфигурации, связанной с безопасностью, чтобы новое устройство могло функционировать в среде OCF. Подключение обычно начинается с того, что Устройство становится «владельцем» законного пользователя / системы, после чего следует настройка Устройства для среды, в которой оно будет работать. Это может включать настройку информации, например, кто может получить доступ к Устройству и какие действия также могут быть выполнены. как и какие разрешения Устройство имеет для взаимодействия с другими устройствами.

![Рисунок 2 - Слои OCF](.\figure\sec011.png)

Рисунок 11 - Процесс подключения OCF

### 5.3.3 Установление владельца устройства

Цель установления права собственности на устройство состоит в том, чтобы позволить законному пользователю, который владеет / приобрел устройство, заявить о себе как о владельце и управляющем устройством. Это делается посредством использования OBT, который включает в себя создание контекста владения между новым устройством и инструментом OBT и обеспечивает оперативный контроль и управление устройством. OBT может рассматриваться как логическая сущность, размещаемая инструментами / серверами, такими как консоль управления сетью, инструмент управления устройством, инструмент авторизации сети, инструмент обеспечения сети, устройство домашнего шлюза или контроллер домашней автоматизации. На физическое устройство, на котором размещается OBT, будут распространяться некоторые требования повышения безопасности, что позволит сохранить целостность и конфиденциальность любых сохраняемых учетных данных. Инструмент / Сервер, который устанавливает владение Устройством, называется OBT.

OBT использует один из OTM, указанных в разделе 7.3, для безопасного установления владельца устройства. Термин «передача владельца» используется, поскольку предполагается, что даже для нового Устройства право собственности передается от производителя / поставщика Устройства к покупатель / законный пользователь нового устройства.

ОТМ устанавливает нового владельца (оператора OBT), который уполномочен управлять Устройство. Владелец передачи устанавливает следующее

* DOTS предоставляет учетные данные владельца (OC) для свойства creds в ресурсе /oic/sec/cred устройства. Этот OC позволяет устройству и DOTS выполнять взаимную аутентификацию во время последующих взаимодействий. OC связывает DOTS DeviceID со свойством rowneruuid ресурса /oic/sec/doxm, устанавливая его в качестве владельца ресурса. DOTS записывает идентификатор устройства как часть передачи права собственности.
* Owner Владелец устройства устанавливает доверие к устройству через OTM.
* The Подготовка устройства к инициализации путем предоставления учетных данных, которые могут потребоваться.

### 5.3.4 Подготовка к нормальной работе

Как только устройство получит необходимую информацию для инициации инициализации, следующим шагом будет предоставление дополнительной конфигурации безопасности, которая позволит устройству начать работу. Это может включать в себя настройку различных параметров и может также включать несколько шагов. Кроме того, в настоящее время выполняется подготовка списков ACL для различных ресурсов, размещаемых сервером на устройстве. Обратите внимание, что этап подготовки не ограничивается только этим этапом. Подготовка устройства может происходить на нескольких этапах жизненного цикла устройства.

Однако конкретная связанная с безопасностью подготовка состояния ресурса и свойства, скорее всего, произойдет на этом этапе, в конце которого каждое устройство достигает состояния «Готов к нормальной работе» на встроенном устройстве. Ожидается, что состояние «Готовность к нормальной работе» будет согласованным и четко определенным, независимо от того, какой конкретный OTM используется, или независимо от того, что меняется. Однако отдельные механизмы OTM и этапы подготовки могут указывать дополнительную конфигурацию состояний ресурсов и свойств. Минимальная обязательная конфигурация, необходимая для того, чтобы устройство находилось в состоянии «Готов к нормальной работе», указана в разделе 8.

###  5.3.5 Подготовка устройств для облака OCF и обзор регистрации устройств

Как упоминалось в начале раздела 5, связь между устройством и облаком OCF подчиняется различным критериям по сравнению с устройствами, которые находятся в одной локальной сети. Устройство настроено для подключения к облаку OCF с помощью посредника, как указано в разделах ресурса CoAPCloudConf в облаке расширений базовой спецификации OCF. Предоставление включает в себя данные об удаленном подключении и локальные данные, такие как URL-адрес, по которому можно найти среду размещения OCF Cloud, и проверяемый токен доступа OCF Cloud.

### 5.3.6 Система управления соответствием OCF

Система управления соответствием OCF (OCMS) - это служба, поддерживаемая OCF, которая
предоставляет статус сертификации и информацию для устройств OCF.
OCMS должна предоставлять список сертифицированных продуктов (CPL) в формате JSON, размещенный по адресу URI:
https://www.openconnectivity.org/certification/ocms-cpl.json
OBT должен иметь корневой сертификат, необходимый для включения https-соединения с URI https://www.openconnectivity.org/certification/ocms-cpl.json.

OBT должен периодически обновлять свою копию CPL через URI.

https://www.openconnectivity.org/certification/ocms-cpl.json, в соответствии с требованиями политики владельца домена безопасности OCF.

## 5.4. Подготовка

### 5.4.1. Общие положения

Обратите внимание, что в общем случае подготовка может включать процессы во время производства и распространения Устройства, а также процессы после того, как Устройство было перенесено в его предполагаемую среду (части процесса адаптации). В этой спецификации обеспечение безопасности включает в себя процессы после передачи права собственности (даже если некоторые действия во время передачи права собственности и включения могут привести к предоставлению некоторых данных на устройстве), конфигурация учетных данных для взаимодействия со службами обеспечения, настройка любых связанных с безопасностью ресурсов и учетных данных для работы с любыми сервисами, с которыми Устройство должно связаться позже.

 После завершения передачи права собственности Устройство должно взаимодействовать с CMS и AMS, чтобы обеспечить надлежащие учетные данные и параметры безопасности для нормальной работы. Эти параметры могут включать

- Учетные данные безопасности через CMS, в настоящее время предполагаемые для развертывания в том же OBT.
- Policies Политики контроля доступа и ACL через AMS, которые в настоящее время предполагается использовать в той же OBT, но могут в будущем стать частью AMS.

Как уже упоминалось, для обеспечения масштабируемой и модульной конструкции эти функции рассматриваются как сервисы, которые в будущем могут быть развернуты как отдельные серверы. В настоящее время при развертывании предполагается, что все эти службы развернуты как часть OBT. Независимо от сценария физического развертывания одно и то же требование повышения безопасности) применяется к любому физическому серверу, на котором размещены инструменты и службы обеспечения безопасности, обсуждаемые здесь.

 Устройства знают о своем состоянии обеспечения безопасности. Самосознание позволяет им быть активными в отношении предоставления или повторного предоставления ресурсов безопасности, необходимых для достижения эксплуатационных целей устройств.

###  5.4.2 Предоставление других услуг

 Чтобы иметь возможность поддерживать использование потенциально разных хостов службы управления устройствами, у каждого безопасного виртуального ресурса устройства (SVR) есть связанный владелец ресурса, указанный в свойстве rowneruuid ресурса.

 DOTS должен обновить свойство rowneruuid ресурсов /oic/sec/doxm и /oic/sec/pstat с помощью идентификатора владельца ресурса DOTS.

 DOTS должен обновить свойство rowneruuid ресурса /oic/sec/cred с помощью идентификатора владельца ресурса CMS.

 DOTS должен обновить свойство rowneruuid /

Когда эти службы OCF настроены, Устройство может упреждающе запрашивать предоставление и проверять авторизацию запросов на предоставление. DOTS должна предоставлять учетные данные, которые обеспечивают безопасные соединения между службами OCF и новым устройством. DOTS может инициировать управляемую клиентом подготовку, сигнализируя службе OCF. DOTS может инициировать управляемое сервером предоставление, задав свойство tm ресурса "/oic/sec/pstat".

### 5.4.3 Предоставление учетных данных для нормальной работы

Ресурс "/oic/sec/cred" поддерживает несколько типов учетных данных, включая:
- Парные симметричные ключи
- Групповые симметричные ключи
- Сертификаты
- Сырые асимметричные ключи

CMS должен безопасно предоставлять учетные данные для взаимодействий между устройствами, используя учетные данные CMS, предоставленные DOTS.

В следующем примере описывается, как Устройство обновляет учетные данные с симметричным ключом с участием однорангового устройства. Устройство обнаруживает учетную запись для обновления; например, повторная попытка подключения не удалась. Устройство запрашивает у своего CMS обновленный учетный номер. CMS возвращает обновленные учетные данные с симметричным ключом. CMS обновляет соответствующие учетные данные с симметричным ключом на одноранговом Устройстве.

### 5.4.4 Назначение ролей и обеспечение для нормальной работы

Серверы, получающие запросы на ресурсы, которые они размещают, должны проверить идентификаторы ролей, заявленные Клиентом, запрашивающим Ресурс, и сравнить эти идентификаторы ролей с ограничениями, описанными в списках ACL Сервера. Таким образом, Клиентское Устройство может необходимо предоставить учетные данные для одной или нескольких ролей.

Каждое Устройство хранит информацию о роли как Свойство в Ресурсе учетных данных.
После инициализации клиент может подтвердить свою роль, как описано в 10.4. 2, если у него есть учетные данные роли сертификата.

Все подготовленные роли используются при применении ACL. Когда на сервере есть несколько ролей, предоставленных клиенту, доступ к Ресурсу предоставляется, если он будет предоставлен под любой из ролей.

### 5.4.5 Подготовка ACL

Подготовка ACL должна выполняться через безопасное соединение между AMS и ее устройствами.

AMS управляет политикой ACL для каждого управляемого устройства. AMS должен предоставить политику ACL путем обновления ресурсов ACL устройства.

AMS должен поставить цифровую подпись для ACL в рамках выдачи Ресурса «/oic/sec/sacl», если Устройство поддерживает Ресурс «/oic/sec/sacl». Открытый ключ, используемый 

Устройством для проверки подписи, должен быть предоставлен CMS по мере необходимости. Используется ресурс «/oic/sec/cred» с типом асимметричного ключа или типом асимметричного ключа со знаком. Свойство PublicData содержит открытый ключ AMS.

## 5.5 Менеджер защищенных ресурсов (SRM)

SRM играет ключевую роль в общей операции по обеспечению безопасности. Короче говоря, SRM выполняет как управление SVR, так и управление доступом для запросов на доступ и управление ресурсами. SRM состоит из 3 основных функциональных элементов:

- Менеджер ресурсов (RM): отвечает за 1) загрузку SVR из постоянного хранилища (с использованием PSI) по мере необходимости. 2) Обеспечение механизма политик (PE) ресурсами по запросу. 3) Отвечая на запросы SVR. В то время как SVR находятся в памяти SRM, SVR находятся в формате, который соответствует формату хранилища данных, зависящему от устройства. Однако RM будет использовать формат JSON для маршалинга структур данных SVR перед их передачей в PSI для хранения или перемещением.
вне устройства.
 - Механизм политик (PE), который принимает запросы на доступ к SVR и на основе политик управления доступом отвечает на запросы с помощью «ACCESS_GRANTED» или «ACCESS_DENIED».
Чтобы принять решения о доступе, PE использует соответствующий ACL и ищет лучшую запись контроля доступа (ACE), чтобы обслуживать запрос, заданный субъектом (устройством или роликом), который был аутентифицирован DTLS.
- Интерфейс постоянного хранилища (PSI): PSI предоставляет набор API-интерфейсов для RM для управления файлами в его собственной памяти и хранилище. Типовой дизайн SRM - это то, что он может быть имплементирован в безопасную среду исполнения Платформы; если доступно.
На рисунке 12 изображена архитектура SRM OCF.

![Рисунок 2 - Слои OCF](.\figure\sec012.png)

Рисунок 12 - Архитектура SRM OCF

## 5.6 Обзор учетных данных

 Устройства могут использовать учетные данные для подтверждения личности и роли сторон в двунаправленной связи. Полномочия могут быть симметричными или асимметричными. Каждое устройство хранит секретные и открытые части своих собственных учетных данных, где это применимо, а также учетные данные для других устройств, которые были предоставлены DOXS или CMS. Эти учетные данные затем используются при установлении сеансов безопасной связи (например, с использованием DTLS) для проверки подлинности участвующих сторон. Учетные данные роли используются после установления аутентифицированного сеанса для утверждения одной или нескольких ролей для устройства.

 Токены доступа предоставляются в Облако OCF после установления аутентифицированного сеанса с Облаком OCF для проверки идентификатора пользователя, с которым должно быть связано Устройство

# 6 Безопасность процесса обнаружения

## 6.1 Преамбула

Основная функция механизма обнаружения заключается в предоставлении универсальных идентификаторов ресурсов (URI, называемых ссылками) для ресурсов, размещенных на сервере, дополненных атрибутами этих ресурсов и возможными дальнейшими связями. (в соответствии с разделом 10 ISO / IEC 30118-1: 2018)

## 6.2 Рекомендации по безопасности для обнаружения

При определении процесса обнаружения необходимо позаботиться о том, чтобы открывающему объекту был предоставлен только минимальный набор ресурсов без нарушения безопасности конфиденциальной информации или требований конфиденциальности данного приложения. Сюда входят как данные, включенные в Ресурсы, так и соответствующие метаданные.

Для достижения расширяемости и масштабируемости в этом документе не содержится требования о возможности обнаружения каждого отдельного ресурса. Вместо этого Сервер, содержащий Ресурс, будет полагаться на ACL для каждого Ресурса, чтобы определить, имеет ли запрашивающая сторона (Клиент) разрешение на просмотр / обработку любого из Ресурсов.

Ресурс "/oic/sec/acl2" содержит записи ACL для управления доступом к ресурсам, размещенным на сервере. (См. 13.5)

Помимо конфиденциальности и возможности обнаружения Ресурсов с точки зрения ACL, сам процесс обнаружения должен быть защищен. Этот документ устанавливает следующие требования к процессу обнаружения:
1) Обеспечение защиты целостности обнаруженных ресурсов.
2) Обеспечение защиты конфиденциальности для обнаруженных ресурсов, которые считаются конфиденциальными.

Обнаружение ресурсов осуществляется путем выполнения операции RETRIEVE (например, ее unic ast или m ulticast) на известном ресурсе "/oic/res".
Запрос на обнаружение отправляется по незащищенному каналу (многоадресный или одноадресный без DTLS), Сервер не может определить личность запрашивающего. В таких случаях Сервер, который хочет аутентифицировать Клиента перед ответом, может перечислить безопасный URI обнаружения (например, coaps: //IP:PORT/oic/res) в ответе незащищенного ресурса «/oic/res». Это означает, что URI безопасного обнаружения по умолчанию доступен для обнаружения любым Клиентом. Затем от клиента потребуется отправить отдельный одноадресный запрос с использованием DTLS на URI безопасного обнаружения.
Для безопасного обнаружения любой ресурс, имеющий связанный ACL2, будет указан в ответе на ресурс «/oic/res» тогда и только тогда, когда у клиента есть разрешения на выполнение хотя бы одной из операций CRUDN (т. Е. Побитовое ИЛИ операции CRUDN-флаги должны быть повреждены).
Например, клиент с идентификатором устройства «d1» делает запрос RETRIEVE для ресурса «/door», размещенного на сервере с идентификатором устройства «d3», где d3 имеет ACL2:

```json
{
  "aclist2": [
    {
      "subject": {"uuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"},
      "resources": [{"href": "/door"}],
      "permission": 2, // RETRIEVE
      "aceid": 1
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
},
{
  "aclist2": [
    {
      "subject": {
        "authority": "owner",
        "role": "owner"
      }

      "resources": [{"href": "/door"}],
      "permission": 2, // RETRIEVE
      "aceid": 2
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
},
{
  "aclist2": [
    {
      "subject": {"uuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"},
      "resources": [{"href": "/door/lock"}],
      "permission": 4, // UPDATE
      "aceid": 3
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
}
{
  "aclist2": [
    {
      "subject": {"conntype": "anon-clear"},
      "resources": [{"href": "/light"}],
      "permission": 2,  // RETRIEVE
      "aceid": 4
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
}
```

ACL указывает, что клиент "d1" имеет разрешения RETRIEVE для ресурса. Следовательно, когда устройство «d1» выполняет обнаружение на ресурсе «/oic/res» сервера «d3», ответ будет включать URI метаданных ресурса «/door». Клиент "d2" будет иметь доступ к обоим ресурсам. ACE2 предотвратит обновление «d4».
Результаты обнаружения доставлены в d1 относительно ресурса "/oic/res" d3 из защищенного интерфейса:

```json
[{
    "href": "/door",
    "rt ": ["oic.r.door"],
    "if": ["oic.if.b", "oic.if.ll"],
    "di": " 0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
}]
```

Результаты обнаружения, доставленные в d2 относительно ресурса d3 "/oic/res" из защищенного интерфейса

```json
[
  {
    "href": "/door",
    "rt": ["oic.r.door"],
    "if": ["oic.if.b", "oic.if.ll"],
    "di": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
  },
  {
    "href": "/door/lock",
    "rt": ["oic.r.lock"],
    "if": ["oic.if.b"],
    "type": ["application/json", "application/exi+xml"]
  }
]
```

Результаты обнаружения, доставленные на любое устройство с учетом ресурса d3 "/oic/res" из незащищенного интерфейса:

```json
[
  {
    "di": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1",
    "href": "/light",
    "rt": ["oic.r.light"],
    "if": ["oic.if.s"]
  }
]
```

# 7 Обеспечение безопасности

# 7.1 Идентификация устройства

### 7.1.1 Общая идентификация устройства

Каждое устройство, которое является логическим устройством, идентифицируется идентификатором устройства.
Зал устройств идентифицируется значением идентификатора устройства, которое устанавливается как часть подключения устройства.
Ресурс «/ oic / sec / doxm» определяет формат идентификатора устройства (например, «urn: uuid»). Идентификаторы устройств должны быть уникальными в пределах области действия соответствующего домена безопасности OCF и должны быть универсально уникальными. DOTS должен гарантировать, что ID нового Устройства уникален в рамках OCF Security Dom ain владельца. DOTS должна проверять, не конфликтует ли новый идентификатор устройства с идентификаторами устройства, ранее введенными в домен безопасности OCF.
Устройства поддерживают ассоциацию идентификатора устройства и криптографических учетных данных с использованием ресурса «/ oic / sec / cred». Устройства рассматривают Ресурс «/ oic / sec / cred» как авторитетный при проверке учетных данных для аутентификации однорангового устройства.

Устройство хранит свой идентификатор устройства в ресурсе «/ oic / sec / doxm». Он содержит список учетных данных, как собственных, так и других учетных данных устройства, в ресурсе «/ oic / sec / cred». Идентификатор устройства можно использовать, чтобы различать собственные учетные данные устройства и учетные данные для других устройств. Кроме того, Ресурс «/ oic / sec / cred» может содержать несколько учетных данных для устройства.
Идентификатор устройства должен быть:
-	Уникальный
-	Неизменный
- Поддается проверке

При использовании сертификатов производителя сертификат должен сопоставлять идентификатор с сохраненной секцией в устройстве, как описано ниже в этой статье.

Физическое Устройство, называемое в документации OCF Платформой, может содержать несколько Устройств. Платформа идентифицируется идентификатором Платформы. Идентификатор платформы должен быть глобально уникальным и вставляться в устройство с защитой целостности (например, внутри защищенного хранилища или подписанный и проверенный).

Форма OCF Plat может иметь безопасную среду исполнения, которая будет использоваться для защиты уникальных идентификаторов и секретов. Если на платформе размещено несколько устройств, необходим некоторый механизм, чтобы обеспечить каждому устройству соответствующую и отдельную безопасность.

## 7.2 Владение устройством

Это информативный пункт. Устройства - это логические объекты, которые являются конечными точками безопасности, имеющими идентификацию, которая может быть аутентифицирована с использованием криптографических учетных данных. При первой инициализации устройство не является владельцем. Установление права собственности на устройство - это процесс, посредством которого устройство заявляет свою идентичность в DOTS, а DOTS предоставляет идентичность владельца. Этот обмен приводит к тому, что устройство меняет свое состояние владения, тем самым не позволяя другой DOTS утверждать административный контроль над устройством.
Процесс передачи прав собственности начинается с того, что OBT обнаруживает новое устройство, которое находится в состоянии Unowned, путем проверки свойства «Owned» ресурса «/oic/sec/doxm» нового устройства. По окончании передачи права собственности выполняется следующее:

1) DOTS должна установить безопасный сеанс с новым устройством.
2) Необязательно утверждает любое из следующего:
а) Близость (с использованием ПИН-кода) OBT к Платформе.
б) Сертификат производителя, подтверждающий поставщика платформы, модель и другие атрибуты платформы.
3) Определяет идентификатор устройства.
4) Определяет владельца устройства.
5) Указывает владельца устройства (например, идентификатор устройства OBT).
6) Подтвердите на устройстве учетные данные владельца.
7) Устанавливает состояние «Owned» нового устройства в TRUE.
ПРИМЕЧАНИЕ. Устройство, которое подключается к облаку OCF, по-прежнему сохраняет за собой право управления, установленное при подключении к DOTS.

## 7.3 Методы передачи права собственности на устройство

### 7.3.1 Требования к реализации OTM

В этом документе представлены спецификации для нескольких методов передачи права собственности.
Внедрение каждого отдельного метода передачи прав собственности считается необязательным. Однако каждое устройство должно реализовывать по крайней мере один из способов передачи права собственности, не включая методы, специфичные для поставщика.

Все OTM, включенные в этот документ, считаются необязательными. Каждый поставщик должен выбрать и внедрить хотя бы один из OTM, указанных в этом документе. Тем не менее, OCF ожидает, что будет существовать подход, ориентированный на конкретного поставщика. Если поставщик желает иметь совместимость между OTM конкретного поставщика и OBT от других поставщиков, он должен работать напрямую с поставщиками OBT, чтобы гарантировать совместимость. Тем не менее, стандартизация ОТМ - это предпочтительный подход. В таких случаях в 7.3.7 предоставляется набор руководящих принципов, помогающих поставщикам в разработке OTM для конкретных поставщиков.

Ресурс "/oic/sec/doxm" расширяется для размещения определенных поставщиком методов передачи владельца (OTM). DOTS определяет, какой OC больше всего подходит для установки нового устройства.

Все OTM должны отражать возможности подключения Устройства с использованием свойства oxms ресурса «/oic/sec/doxm». DOTS будет запрашивать поддерживаемые устройством типы учетных данных, используя свойство credty pes ресурса «/oic/sec/cred». DOTS и CMS должны предоставлять учетные данные в соответствии с поддерживаемыми типами учетных данных.

На рисунке 13 изображена новая последовательность обнаружения устройств.

![Рисунок 13 - Последовательность обнаружения нового устройства](.\figure\sec013.png)

Рисунок 13 - Последовательность обнаружения нового устройства

Таблица 1 - Сведения о новом устройстве

| Шаг  | Описание                                                     |
| ---- | ------------------------------------------------------------ |
| 1    | OBT запрашивает, не принадлежит ли еще новое устройство.     |
| 2    | Новое устройство возвращает ресурс «/oic/sec/doxm»,  содержащий статус владения и поддерживаемые OTM. Он также содержит временный  идентификатор устройства, который может измениться после успешной передачи  владельца. Устройство должно предоставить временный идентификатор, чтобы  облегчить обнаружение в качестве гостевого устройства.  В разделе 7.3.9 представлены соображения безопасности при выборе  OTM. |

OTM устройств конкретного производителя должны соответствовать Спецификации ресурсов "/oic/sec/doxm" для OC, которая является результатом OTM устройства конкретного поставщика. OTM, зависящий от поставщика, должен включать положения для установления доверия к новому Устройству со стороны OBT, а также факультативное установление доверия к OBT с помощью нового Устройства.

Новому устройству, возможно, придется выполнить некоторые шаги инициализации в начале OTM. Например, если инициируется OTM на основе случайного PIN-кода, новое устройство может сгенерировать случайное значение PIN. OBT должен выполнить POST в свойстве oxmsel "/oic/sec/doxm", значение, соответствующее используемому OTM, перед выполнением других шагов OTM. Этот POST уведомляет новое устройство о начале передачи владения.

Конечное состояние зала OTM, зависящего от поставщика, позволяет новому устройству аутентифицироваться в OBT, а OBT - в новом устройстве.

DOTS может выполнять дополнительную подготовку к работе после успешной передачи владельцем, используя установленный сеанс OTM.

После успешного OTM, но перед помещением вновь загруженного устройства в RFNOP, OBT должен удалить все ACE, где Subject является «anon-clear» или «auth-crypt», а массив ресурсов включает SVR.

### 7.3.2 Расчет учетных данных SharedKey


Учетные данные SharedKey выводятся с использованием PRF, который принимает значение key_block, полученное в результате рукопожатия DTLS, используемого для подключения. Новое Устройство и DOTS должны использовать следующие расчеты для обеспечения взаимодействия между продуктами поставщика:

### 7.3.3 Создание учетных данных сертификата

Учетные данные Cert ificate будут использоваться Устройствами для безопасной двунаправленной связи. Сертификаты будут выдаваться CMS или внешним центром сертификации (CA). Этот CA будет использоваться для взаимной проверки подлинности Devic e. Подробные сведения о подключении для создания сертификата будут указаны в более поздней версии этого документа.

### 7.3.4 Just-Works OTM

#### 7.3.4.1 Just-Works OTM Общие

Just-works OTM создает учетные данные с симметричным ключом, который представляет собой предварительный общий ключ, используемый для установления безопасного соединения, через которое устройство должно быть подготовлено для использования в домене безопасности OCF владельца. Предоставление дополнительных учетных данных и ресурсов - типичный шаг после установления права собственности. Общий ключ называется SharedKey.

DOTS должна выбрать Just-works OTM и установить сеанс DTLS, используя набор шифров, определенный для Just-works OTM.
Следующие наборы шифров, определенные OCF, используются для Just-works OTM.
TLS _ECDH_ANON_W ITH_AES_128_CBC_SHA256,
TLS_ECDH_ANON_WITH_AES_256_CBC_SHA256

Они не зарегистрированы в IANA, значения набора шифров назначаются из зарезервированной области для частного использования (0xFF00 ~ 0xFFFF). Присвоенные значения - 0x FF00 и 0xFF01 соответственно.

Управление Just Works OTM показано на Рисунке 14, а шаги описаны в Таблице 2.

![Рисунок 14 - Just Works OTM](.\figure\sec014.png)

Рисунок 14 - Just Works OTM

Таблица 2 - Подробная информация об A Just Works OTM

| Шаг  | Описание                                                     |
| ---- | ------------------------------------------------------------ |
| 1,2  | OBT уведомляет Устройство о том, что он выбрал метод «Just Works». |
| 3-8  | Сессия DTLS устанавливается с использованием анонимного Diffie-Hel lman. Этот метод предполагает, что оператор осведомлен о возможности атаки типа «злоумышленник в середине» и принял меры предосторожности для выполнения этого метода в сети для чистых помещений. |

#### 3.4.2 Рекомендации по безопасности


Соглашение об анонимном ключе Диффи-Хеллмана подвержено атаке типа "злоумышленник посередине". Использование этого метода предполагает, что и OBT, и новое устройство выполняют метод «просто работает», предполагая, что подключение происходит в относительно безопасной среде при отсутствии атакующего устройства.

У этого метода нет надежного способа подтвердить, что заявленный идентификатор устройства надежно привязан к устройству.

Новое устройство должно использовать временный идентификатор устройства до передачи на принадлежащее ему устройство, в то время как оно считается гостевым устройством для предотвращения отслеживания с учетом конфиденциальности. Устройство утверждает невременной идентификатор устройства, который может отличаться от временного значения во время сеанса защиты, в котором происходит обмен владельцами. OBT проверит, что заявленный идентификатор устройства не конфликтует с уже используемым идентификатором устройства. Если он уже используется, существующие учетные данные используются для установления безопасного сеанса.
Не принадлежащее ему Устройство, на котором также установлены учетные данные устройства, может указывать на поврежденное или взломанное устройство.

### 7.3.5 OTM на основе случайного PIN-кода

#### 7.3.5.1 Случайный PIN-код OTM Общие

Случайный PIN-код устанавливает физическую близость между новым устройством и OBT, что может предотвратить атаку «злоумышленник посередине». Устройство генерирует случайное число, которое передается OBT по внеполосному каналу. Определение внеполосного канала связи выходит за рамки определения OTM устройств. OBT и новое Устройство используют PIN-код при обмене ключами в качестве доказательства того, что кто-то санкционировал передачу права собственности, имея физический доступ к новому Устройству через внеполосный канал.

#### 7.3.5.2 Последовательность передачи случайного владельца PIN-кода

Методика OTM на основе случайного PIN-кода показана на рисунке 15, а шаги описаны в таблице 3.

### 7.3.8 Установка учетных данных владельца

После аутентификации OBT и нового устройства и установления зашифрованного соединения с использованием одного из определенных методов OTM.

Учетные данные владельца могут включать сертификаты, подписанные OBT или другим органом, информацию о доступе к домену безопасности OCF, функции обеспечения, общие ключи или билеты Kerberos.

OBT может затем предоставить новому устройству дополнительные учетные данные для управления устройством и обмена данными между устройствами. Эти учетные данные могут состоять из сертификатов с игнорированием, UAID на основе открытого ключа устройства, PSK и т. Д.

Шаги для установки учетных данных владельца устройства (OC):
1) OBT должен установить идентификатор устройства и uuid владельца устройства - рисунок 18 и таблица 6.
2) OBT затем устанавливает OC устройства - рисунок 19 и таблица 7. Это может быть либо:
а) Симметричные учетные данные - рисунок 20 и таблица 8.
б) Асимметричные учетные данные - рисунок 21 и таблица 9.
3) Настройте службы устройства - Рисунок 22 и Таблица 10.
4) Настройте устройство для однорангового взаимодействия - Рисунок 23 и Таблица 11.

![Рисунок 18](.\figure\sec018.png)

###### Рисунок 18 - Процесс установления идентичности устройства

###### Таблица 6 - Установление идентификационных данных устройства

| **Step** | **Description**                                              |
| -------- | ------------------------------------------------------------ |
| 1,2      | OBT получает преимущества от doxm-свойств, используя  меры безопасности. Он проверяет, что эти свойства должны быть получены до  аутентифицированного соединения. Несоответствие параметров рассматривается  как ошибка аутентификации.. |
| 3,4      | OBT  запрашивает, готово ли Устройство к передаче владения устройством. |
| 5 , 6    | OBT  утверждает, что он будет следовать соглашению об инициализации клиента. |
| 7 , 8    | OBT  объявляет себя владельцем нового устройства, устанавливая идентификатор  устройства равным его идентификатору.. |
| 9,10     | OBT  получает прирост свойств doxm, на этот раз устройство возвращает новый  постоянный UUID устройства.. |

![](.\figure\sec019.png)

###### Рисунок 19 - Последовательность инициализации выбора собственных учетных записей

###### Таблица 7 - Детали выбора учетных данных владельца

| **Step** | **Description**                                              |
| -------- | ------------------------------------------------------------ |
| 1 , 2    | OBT  получает свойства док-станции для проверки собственного транспортного  механизма передачи, поддерживаемого новым устройством. |
| 3 , 4    | OBT  использует выбранный тип учетных данных для предоставления права владения. |

![](.\figure\sec020.png)

###### Рисунок 20 - Симметричная последовательность инициализации собственных учетных записей

###### Таблица 8 - Сведения о присвоении симметричных учетных данных владельца

| **Step** | **Description**                                              |
| -------- | ------------------------------------------------------------ |
| 1,2      | OBT использует  псевдослучайную функцию (PRF), главный секретный результат, полученный из  ключа DTLS, и другую информацию для создания симметричного ключа для учетных  данных, свойства - SharedKey. |
| 3        | OBT  создает свойство ресурса учетных данных, установленное на SharedKey, а затем  отправляет набор параметров ресурса новому устройству с пустым значением  параметра «Privatedata». |
| 4,5      | Новое  Устройство локально генерирует SharedKey и добавляет его к свойству «частные  данные» в наборе свойств учетных данных. |
| 6        | Новое устройство отправляет  сохраненный файл.               |
| 7        | Сервисная  служба создает ресурс субъектов для нового устройства (например, /  A71C3xxx-…) |
| 8        | Предоставление  услуг по адаптации к ресурсам "/ o ic / svc / dots / themes / A71C3xxx-  / cred" с другими учетными данными. Тип учетных данных - SYMMETRIC KEY. |
| 9        | (Необязательно) Служба подключения к сети предоставляет  свой собственный ресурс «/ o ic /sec/cred» с учетными данными владельца  для нового устройства. Тип учетных данных - SYMMETRIC KEY. |

В частности, если OBT выберет симметричные учетные данные владельца:
- OBT должен сгенерировать общий ключ с использованием метода расчета учетных данных SharedKey, описанного в п. 7. 3.2.

- OBT должен отправить пустой ключ на ресурс «/oic/sec/cred» нового Устройства, идентифицируемый как симметричный попарный ключ.

- После получения симметричных учетных данных владельца OBT новое Устройство должно независимо сгенерировать Секретный ключ, используя метод расчета учетных данных S haredKey, описанный в п. 7. 3.2, и сохранить его с учетными данными владельца.

- Новое Устройство должно использовать учетные данные владельца общего ключа, хранящиеся в "/oic/sec/cred".
  Ресурс для аутентификации владельца при последующих подключениях.

![](.\figure\sec021.png)

###### Рисунок 21 - Асимметричная последовательность инициализации собственника

###### Таблица 9 - Сведения о присвоении асимметричных учетных данных владельца

...

Если OBT выбирает асимметричные учетные данные владельца:

- OBT должен добавить свой открытый ключ к новому Ресурсу Devic e "/oic/sec/c red", идентифицированному как асимметричный ключ шифрования.
- OBT должен запросить Ресурс «/oic/sec/cred» у нового устройства, предоставив UUID нового устройства через параметр запроса идентификатора S ubj ect. В ответ, зал нового Устройства возвращает открытый ключ асимметричного шифрования, который зал OBT сохраняет для аутентификации будущего владельца нового Устройства.

Если OBT выбирает учетные данные владельца сертификата:

- OBT должен создать сертификат или цепочку сертификатов с конечным сертификатом, содержащим открытый ключ, возвращенный новым устройством, подписанный взаимно доверяемым центром сертификации и соответствующий требованиям генерации учетных данных сертификата, определенным в п. 7. 3.3 .
- OBT должен добавить вновь созданную цепочку сертификатов к ресурсу «/oic/sec/cred», идентифицированному как асимметричный ключ подписи с сертификатом.



![](.\figure\sec022.png)

###### Рисунок 22 - Настройка служб устройства

###### Таблица 10 - Детальная настройка служб устройства

...

###### Рисунок 23 - Предоставление нового устройства для одноранговой связи

###### Таблица 11 - Предоставление нового устройства для одноранговой сети Подробные сведения

....

### 7.3.9 Соображения безопасности при выборе метода передачи права собственности

OBT и / или оператор OBT может иметь строгие требования к списку OTM, которые допустимы при передаче права собственности на новое Устройство. Некоторые из факторов, которые следует учитывать при определении этих требований:
- Соображения безопасности, описанные для каждого из OTM
- Вероятность того, что злоумышленник-посредник может присутствовать в среде, используемой для передачи владения. Например, оператор OBT может потребовать, чтобы все подключенные устройства поддерживали либо случайную PIN-код или сертификат производителя OTM.

Когда существует такая локальная политика OTM, OBT должен попытаться использовать только те OTM, которые приемлемы в соответствии с этой политикой, с учетом содержимого doxm, полученного на шаге 1 из диаграммы последовательности выше (GET "/oic/sec/doxm "). Если шаг 1 выполняется по неаутентифицированному и / или незашифрованному соединению между OBT и устройством, содержимое ответа на запрос GET могло быть изменено неконтролируемым посредником. Например, список OTM, поддерживаемых новым Устройством, мог быть изменен злоумышленником.
Кроме того, аттакер «человек посередине» может принудительно завершить сеанс DTLS между OBT и новым устройством. В таких случаях OBT не имеет возможности определить, произошел ли сбой сеанса из-за того, что новое Устройство не поддерживает OTM, выбранный OBT, или из-за того, что такой сбой был введен человеком в середине. в обмен данными между OBT и новым устройством.
В текущей версии этого документа дизайн и пользовательский опыт относятся к политике OTM как к деталям реализации OBT.

### 7.3.10 Назначение профиля безопасности

Устройства OCF могли быть оценены в соответствии с профилем безопасности OCF. Результаты электронной оценки могут быть доступны из сертификата производителя, веб-сервера OCF или другого общедоступного хранилища. DOTS рассматривает результаты оценки, чтобы определить, какие профили безопасности OCF разрешено владеть Устройству OCF, и настраивает Устройство с подмножеством оцененных профилей безопасности, наиболее подходящих для предполагаемой стратегии сегментации владельца домена безопасности OCF.

Поставщик устройства OCF должен установить значение производителя по умолчанию для свойства «поддерживаемые профили» ресурса «/oic/sec/sp», чтобы сопоставить те, которые утверждены процессом тестирования и сертификации OCF. Свойству "c urrentprofile" ресурса "/oic/sec/sp" должно быть присвоено одно из значений, содержащихся в "support edprofiles". Значение по умолчанию изготовителя должно быть повторно подтверждено, когда Устройство переходит в состояние СБРОС.

Устройство OCF должно разрешать обновление ресурса «/oic/sec/sp» только тогда, когда Устройство находится в одном из следующих состояний устройства: RFOTM, RFPRO, SRESET, и может не разрешать любое обновление в соответствии с указаниями Профиль безопасности.

DOTS может обновить свойство «supportedprofiles» ресурса «/oic/sec/sp» с помощью подмножества профилей безопасности OCF, которые оценивают Устройство, полученное в рамках тестирования на соответствие OCF. DOTS может найти результаты соответствия, проверив сертификаты производителя, поставляемые с устройством OCF, выбрав свойство «credusage» ресурса «/oic/sec/cred», имеющего значение «oic.sec.cred». m fgcert ". DOTS может способствовать достижению результатов поиска соответствия, посещая известный URI веб-сайта OCF, соответствующий полям расширения oc fCPLAttributes (пункт 9. 4.2. 2.7). DOTS может выбрать подмножество профилей безопасности (из тех, которые оцениваются тестированием на соответствие OCF) на основе локальной политики.

В рамках подключения (пока сеанс OTM активен) DOTS должна настраивать записи ACE.
чтобы разрешить доступ к DOTS после адаптации.

Служба DOTS должна обновить свойство «текущий профиль» ресурса «/oic/sec/sp» со значением, которое наиболее правильно отображает стратегию развертывания устройства с окончанием int-end, принадлежащую владельцу OCF Security Dom.
CMS может выдавать учетные данные роли, используя значение профиля безопасности (например, «sp-blue-v0 OID»), чтобы указать намерение владельца домена безопасности OCF настроить домен безопасности OCF в соответствии с безопасностью. Профиль. CMS извлекает свойство supportedprofiles ресурса «/oic/sec/sp» для выбора имен ролей, подтвержденных профилями безопасности, поддерживаемыми Devic e, при выдаче учетных данных роли.

Если CMS выдает учетные данные роли на основе профиля безопасности, AMS предоставляет записи управления доступом, которые включают обозначения ролей.

## 7.4 Подготовка

### 7.4.1 Потоки подготовки

#### 7.4.1. 1 Общие сведения о потоках подготовки

В рамках подключения нового Устройства между новым Устройством и OBT создается защищенный канал. После того, как статус бедра владельца устройства будет изменен на «принадлежащий», есть возможность начать предоставление. OBT решает, как новое Устройство будет управляться в будущем, и предоставляет услуги поддержки, которые должны быть использованы в качестве подсистемы для выполнения инициализации Устройства и текущего управления Устройством.
Устройство использует стратегию инициализации, ориентированную на сервер или клиента. Ресурс «/oic/sec/pstat» определяет стратегию предоставления и текущий статус предоставления. Служба обеспечения должна определять, какая стратегия обеспечения является наиболее подходящей для домена безопасности OCF. См. Ее 13.8 для получения дополнительной информации.

#### 7.4.1.2 Настройка, управляемая клиентом

Обеспечение, ориентированное на клиента, основывается на предоставляемой службе, которая определяет серверы, нуждающиеся в предоставлении, а затем выполняет все необходимые обязанности по обеспечению.
Пример настройки, управляемой клиентом, показан на рисунке 24, а шаги описаны в таблице 12.

![](.\figure\sec024.png)

###### Рисунок 24 - Пример инициализации клиентом напрямую

###### Таблица 12 - Шаги, описывающие настройку, управляемую клиентом


# 8 Определения состояний подключения устройства

## 8.1 Общие сведения о подключении устройства

Как объяснено в 5. 3, процесс подключения завершается после того, как право собственности на Устройство было передано, и Устройство было снабжено соответствующими конфигурациями / услугами, как описано в 5.4. На рисунке 27 показаны различные состояния, в которых устройство может находиться в течение жизненного цикла устройства.
Свойство /pstat.dos.s является RW владельцем ресурса /oic/sec/pstat (например, сервисом "doxs"), так что
владелец ресурса может удаленно обновлять состояние устройства. Когда Устройство находится в RFNOP или RFPRO, ACL могут использоваться для разрешения удаленного контроля состояния устройства другими устройствами. Когда состояние устройства - SRESET, OC устройства может быть единственным показателем авторизации для доступа к устройству. Владелец устройства может выполнять низкоуровневые проверки согласованности и повторную инициализацию, чтобы устройство подходило для передачи в RFPRO.

###### Рисунок 27 - Модель состояния устройства

![](.\figure\sec027.png)

Как показано на диаграмме, по завершении подготовки к работе Устройство переходит в состояние «Готово к нормальной работе», где у него есть все необходимое для взаимодействия с другими устройствами. 8.2 определяет минимальную обязательную конфигурацию, которую должно удерживать Устройство, чтобы считаться «готовым к нормальной работе».

В случае потери питания или отказа Устройства Устройство должно оставаться в том же состоянии, в котором оно находилось до потери / отказа питания.

Если владелец Устройства или ресурса НАБЛЮДАЕТ / pstat.dos.s, то переходы к SRESET будут давать раннее предупреждающее уведомление об Устройствах, которые могут потребовать проверки согласованности SVR.

Для того, чтобы подключение функционировало, на Устройстве должны быть установлены следующие Ресурсы:

1) Ресурс "/oic/sec/doxm"
2) Ресурс "/oic/sec/pstat"
3) Ресурс "/oic/sec/cred"
Значения, указанные в этих Ресурсах, указаны в определениях состояний в 8.2, 8.3, 8.4, 8. 5 и 8. 6.

## 8.2 Определение состояния включения-сброса устройства

/ Pstat. dos.s = Состояние СБРОСА определяется как «жесткий» сброс к заводским настройкам по умолчанию. Аппаратный сброс также определяет состояние, в котором актив устройства готов к передаче другой стороне.
Изготовитель платформы должен предоставить физический механизм (например, кнопку), который заставляет платформу восстанавливаться. Все Устройства, размещенные на одной и той же Платформе, переводят свои состояния Устройства в состояние СБРОС, когда выполняется сброс Платформы.
Следующие ресурсы и их особые свойства должны иметь указанные значения:
1) Собственность собственности ресурса "/oic/sec/doxm" переводится на ЛОЖЬ.
2) Свойство devowneruuid ресурса "/oic/sec/doxm" должно быть нулевым UUID.
3) Свойство разработчика ресурса "/oic/sec/doxm" должно быть нулевым UUID, если это Свойство реализовано.
4) Свойство deviceuuid ресурса "/oic/sec/doxm" должно быть установлено на значение по умолчанию, заданное производителем.
5) Свойство deviceid ресурса «/oic/sec/doxm» должно быть восстановлено до значения по умолчанию производителя, если это Свойство реализовано.
6) Свойство sct ресурса «/oic/sec/doxm» должно быть сброшено до значения по умолчанию производителя.
7) Свойство oxmsel ресурса "/oic/sec/doxm" должно быть сброшено до значения по умолчанию, установленного производителем.
8) Свойство isop ресурса "/oic/sec/pstat" должно иметь значение FALSE.
9) Свойство dos ресурса "/oic/sec/pstat" должно быть обновлено: dos.s должно быть равно состоянию "RESET", а dos.p должно быть равно "FALSE".
10)
11) Свойство om (режимы работы) ресурса «/oic/sec/pstat» должно быть установлено на значение по умолчанию производителя.
12) Свойство sm (поддерживаемые рабочие режимы) ресурса "/oic/sec/pstat" должно быть установлено на значение по умолчанию производителя.
13) Свойство rowneruuid «/oic/sec/pst at», «/oic/sec/doxm», «/oic/sec/acl», «/oic/sec/am acl», «/oic/sec/Sacl "и" /oic/sec/cred "Ресурсы должны иметь нулевой UUID.
14) Свойство supportedprofiles ресурса «/oic/sec/sp» должно быть установлено на значение по умолчанию производителя.
15) Свойство currentprofile ресурса «/oic/sec/sp» должно быть установлено на значение по умолчанию производителя.

## 8.3 Определение состояния готовности устройства к OTM

Следующие Ресурсы и их особые свойства должны иметь значение, указанное при вводе устройства, готового к передаче права собственности:
1) Собственность Ресурса "/oic/sec/doxm" должна быть ЛОЖНОЙ и переходит в ИСТИНУ.

2) Свойство разработчика ресурса "/oic/sec/doxm" должно быть нулевым UUID, если это Свойство реализовано.
3) Свойство devowneruuid ресурса "/oic/sec/doxm" должно быть нулевым UUID.
4) Свойство deviceid ресурса "/oic/sec/doxm" может быть нулевым UUID, если это Свойство реализовано. Значение свойства di в "/oic/d" не определено.
5) Свойство deviceuuid ресурса "/oic/sec/doxm" должно быть установлено на значение по умолчанию, установленное производителем.
6) Свойство isop ресурса "/oic/sec/pstat" должно иметь значение FALSE.
7) Обновить dos "/oic/sec/pst в" зале ресурсов: dos.s должно быть равно состоянию "RFOTM", а dos.p должно быть равно "FALSE".
8) Ресурс "/oic/sec/cred" должен содержать учетные данные, если этого требует выбранный OTM.

## 8.4 Определение состояния готовности устройства к обеспечению.

Следующие Ресурсы и их особые свойства должны иметь значение, указанное, когда Устройство входит в готовность к предоставлению:
1) Собственность в зале Ресурса "/oic/sec/doxm" должна быть ИСТИННОЙ.
2) Свойство devowneruuid ресурса "/oic/sec/doxm" не должно быть нулевым UUID.
3) Свойство deviceuuid ресурса "/oic/sec/doxm" не должно быть нулевым UUID и должно быть установлено на значение, которое было определено во время обработки RFOTM. Также значение свойства di в ресурсе "/oic/d" должно быть таким же как свойство deviceid в ресурсе "/oic/sec/doxm".
4) Свойство oxmsel ресурса «/oic/sec/doxm» должно иметь значение фактического OTM, использованного во время передачи права собственности.
5) Свойство isop ресурса "/oic/sec/pstat" должно иметь значение FALSE.
6) DOS ресурса «/oic/sec/pstat» должен быть обновлен: dos.s должно быть равно состоянию «RFPRO», а dos.p должно быть равно «FALSE».
7) Свойство rowneruuid каждого установленного Ресурса должно быть установлено на действительного владельца Ресурса (т. Е. Объекта, авторизованного для создания или обновления данного Ресурса). Невозможность установить rowneruuid может привести к потере ресурсов.
8) Ресурс «/oic/sec/cred» должен содержать учетные данные для каждого пользователя, на который ссылаются rowneruid, amsuuid, devowneruuid.

## 8.5 Определение состояния готовности устройства к нормальной работе

Следующие Ресурсы и их особые свойства должны иметь значение, указанное, когда Устройство входит в готовность к нормальной работе:
1) Собственность в зале Ресурса "/oic/sec/doxm" должна быть ИСТИННОЙ.
2) Свойство devowneruuid ресурса "/oic/sec/doxm" не должно быть нулевым UUID.
3) Свойство deviceuuid ресурса "/oic/sec/doxm" не должно быть нулевым UUID и должно быть установлено на ID, который был настроен во время OTM. Также значение свойства "di" в "/oic/d" должно быть таким же, как и у deviceuuid.
4) Свойство oxmsel ресурса «/oic/sec/doxm» должно иметь значение фактического OTM, использованного во время передачи права собственности.
5) Свойство isop ресурса "/oic/sec/pstat" должно быть установлено на ИСТИНА сервером после завершения перехода на RFNOP.
6) Dos ресурса «/oic/sec/pstat» должен быть обновлен: dos.s должно быть равно состоянию «RFNOP», а dos.p должно быть равно «FALSE».


7) Свойство rowneruuid каждого установленного ресурса должно быть передано действительному владельцу ресурса (т. Е. Объекту, который авторизован для создания или обновления данного ресурса). Неспособность установить rowneruuid приводит к потерянному ресурсу.
8) Ресурс "/oic/sec/c red" должен содержать идентификационные данные для каждой услуги, на которую ссылаются rowneruid, amsuuid, devowneruuid.
## 8.6 Определение состояния программной перезагрузки устройства

Определяется статус мягкого сброса (например, / pstat.dos.s = SRESET), где вход в его статус означает, что Устройство не работает, но остается принадлежащим текущему владельцу. Устройство может выйти из SRESET путем аутентификации в DOTS (например, «rt» = «oic.r.doxs») с использованием OC, предоставленного во время первоначального подключения (но не должно требовать использования OTM /doxm.oxms).
DOTS должны выполнить проверку согласованности SVR и, при необходимости, повторно подготовить их в достаточной степени, чтобы позволить устройству передать RFPRO.
На рисунке 28 изображена процедура проверки работоспособности OBT в SRESET.

###### Рисунок 28 - Последовательность проверки безопасности OBT в SRESET

DOTS должна выполнить проверку работоспособности SVR перед окончательным переходом к статусу устройства RFPRO. Если учетные данные DOTS не могут быть найдены или они отключены для повреждения, состояние устройства переходит в состояние СБРОС. Устройство должно оставаться в режиме SRESET, если учетные данные DOTS не могут подтвердить DOTS. Это смягчает атаки отказа в обслуживании, которые могут быть предприняты устройствами, не использующими DOTS.

В SRESET следующие Ресурсы и их особые Свойства должны иметь указанные значения.
1) Собственность в зале Ресурса "/oic/sec/doxm" должна быть ИСТИННОЙ.
2) Свойство devowneruuid ресурса "/oic/sec/doxm" должно оставаться ненулевым.
3) Свойство разработчика ресурса "/oic/sec/doxm" не должно быть нулевым, если это Свойство реализовано.
4) Свойство deviceuuid ресурса "/oic/sec/doxm" должно оставаться ненулевым.
5) Свойство id устройства ресурса «/oic/sec/doxm» не должно быть равным нулю.
6) Свойство sct ресурса «/oic/sec/doxm» должно сохранять свое значение.
7) Свойство oxmsel холла ресурса "/oic/sec/doxm" сохраняет свое значение.
8) Свойство isop ресурса "/oic/sec/pstat" должно иметь значение FALSE.
9) Свойство «/oic/sec/pstat.dos.s» должно иметь значение SRESET.
10) OM (режимы работы) Свойство ресурса "/oic/sec/pstat" должно быть "режимом, направленным клиентом".
11) Свойство sm (поддерживаемые рабочие режимы) ресурса "/oic/sec/pstat" может быть обновлено владельцем устройства (также известным как DOTS).
12) Свойство rowneruuid «/oic/sec/pstat», «/oic/sec/doxm», «/oic/sec/acl», «/oic/sec/acl2», «/oic/sec/amacl» Ресурсы «/oic/sec/sacl» и «/oic/sec/cred» могут быть сброшены владельцем устройства (также известным как DOTS) и повторно предоставлены

# 9 Управление учетными данными безопасности

## 9.1 Преамбула

В этом разделе представлен обзор типов учетных данных в OCF с подробным описанием использования учетных данных, подготовки и текущего управления.

## 9.2 Жизненный цикл Credential

### 9.2.1 Общие сведения о жизненном цикле полномочий

Жизненный цикл учетных записей OCF состоит из следующих этапов: (1) создание, (2) удаление, (3) обновление, (4)
выдача и (5) отзыв.

### 9,2.2 Создание

CMS предоставляет устройству Ресурсы учетных данных. Устройство должно проверить, авторизована ли CMS, сопоставив свойство rowneruuid ресурса «/oic/sec/cred» с DeviceID учетных данных, которые CMS использовала для установления безопасного соединения.

Ресурсы учетных данных, созданные с помощью CMS, могут включать в себя специализированные протоколы и сообщения выдачи учетных данных. Они могут включать использование инфраструктуры открытого ключа (PKI), такой как центр сертификации (CA), симметричное управление ключами, такое как центр распределения ключей (KDC), или как часть действия по обеспечению со стороны DOTS, CMS. или AMS.
### 9.2.3 Удаление

CMS должна удалять известные скомпрометированные ресурсы учетных данных. Устройство (например, Устройство, на котором размещен Ресурс учетных данных) должно удалить Ресурсы учетных данных, срок действия которых истек.
Ресурс учетных данных с истекшим сроком действия может быть удален для управления памятью и пространством для хранения.
Удаление в управлении ключами OCF эквивалентно расширению учетных данных.

### 9.2.4 Обновить

Обновление учетных данных может быть выполнено до истечения срока его действия. CMS должен выполнить обновление учетных данных.

Ресурс "/oic/sec/cred" поддерживает работу с использованием свойства Period. Обновление учетных данных может быть применено, когда учетные данные вот-вот истечут или вот-вот превысят максимальный порог для зашифрованных байтов.

Метод обновления удостоверения определяет параметры, доступные при выполнении обновления ключа. Свойство Period информирует, когда истекает срок действия учетных данных. Устройство может упреждающе получить новые учетные данные, используя метод обновления учетных данных, используя текущие учетные данные, срок действия которых еще не истек, для обновления существующего идентификатора. Если Устройство не имеет внутреннего источника времени, текущее время следует получать от CMS через равные промежутки времени.

Если срок действия учетных данных CMS истек, служба DOTS может использоваться для повторной подготовки учетных данных CMS к Устройству. Если разрешено истечение срока действия установленных учетных записей на борту, то DOTS должна повторно подключиться к Устройству, чтобы повторно применить шаги передачи владельца устройства.
Все устройства поддерживают как минимум один метод обновления учетных данных.
### 9.2.5 Профессия

Учетные данные, выданные CMS, могут иметь возможность отзыва. В ситуациях, когда встреча с отзывом включает в себя предоставление объекта отзыва, который идентифицирует учетные данные, которые должны быть отозваны до его обычного срока истечения, создается ресурс учетных данных, содержащий информацию об отзыве. заменяет первоначально выданный верил. Срок действия объекта отзыва должен совпадать со сроком действия отозванных учетных данных, чтобы объект отзыва был очищен по истечении срока действия.

Концептуально разумно рассматривать отзыв, применяемый к учетным данным или Устройству. При отзыве устройства утверждается, что все учетные данные, связанные с отозванным устройством, следует рассматривать для отзыва. Отзыв устройства необходим, если Устройство потеряно, остановлено или взломано. Удаление учетных данных на отозванном Устройстве может быть невозможным или ненадежным.
## 9.3 типа личности.

### 9.3.1 Преамбула

Ресурс «/oic/sec/cred» содержит свойство типа учетных данных, которое поддерживает несколько криптографических ключей и другую информацию, используемую для аутентификации и защиты данных. Поддерживаемые типы учетных данных включают парные симметричные ключи, групповые симметричные ключи, асимметричные ключи аутентификации, сертификаты (то есть подписанные асимметричные ключи) и общие секреты (то есть PIN / пароль).

### 9.3.2 Параллельно-зависимые учетные данные ключа для симметрии

CMS должна предоставить ровно один из своих попарно симметричных учетных данных для однорангового Устройства. CMS не должна хранить попарные симметричные ключи, которые она предоставляет управляемым устройствам.

Парные ключи могут быть установлены через специальные протоколы согласования ключей.

Свойство PrivateData в ресурсе «/oic/sec/cred» содержит симметричный ключ.

Общедоступные данные и свойство могут содержать токен, зашифрованный на одноранговое устройство, передаваемое парным ключом.

Свойство OptionalData может содержать статус отзыва.

Инспектор устройства должен применять усиленные методы хранения ключей, которые гарантируют, что PrivateData останется конфиденциальной.

Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.
### 9.3.3 Групповые симметричные ключевые учетные данные

Ключи группы - это симметричные ключи, общие для группы Устройств (3 или более). Групповые ключи используются для эффективного обмена данными между участниками группы.

Групповые ключи не обеспечивают аутентификацию устройств, а только устанавливают членство в группе.

CMS должна предоставить членам группы учетные записи с симметричным ключом группы. CMS поддерживает членов группы.

Свойство PrivateData в ресурсе «/oic/sec/cred» содержит симметричный ключ.

Свойство PublicData может содержать имя группы.
Свойство OptionalData может содержать статус отзыва.

Инспектор устройства должен применять усиленные методы хранения ключей, которые гарантируют, что PrivateData останется конфиденциальной.

Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.
### 9.3.4 Учетные данные ключа асимметричной аутентификации

#### 9.3.4.1 Общие сведения о ключах асимметричной аутентификации

Учетные данные асимметричного ключа аутентификации содержат либо пару открытого и закрытого ключей, либо только открытый ключ. Закрытый ключ используется для подписи запросов на аутентификацию устройства. Открытый ключ используется для проверки ответа на запрос аутентификации устройства.

Свойство PrivateData в ресурсе «/oic/sec/cred» содержит закрытый ключ.

Свойство PublicData содержит открытый ключ.

Свойство OptionalData может содержать статус отзыва.

Инспектор устройства должен применять усиленные методы хранения ключей, которые гарантируют, что PrivateData останется конфиденциальной.

Устройства должны генерировать асимметричные пары ключей аутентификации внутри, чтобы гарантировать, что закрытый ключ известен только Устройству. См. 9.3. 4.2 для случаев, когда необходимо передавать личные ключевые материалы между Устройствами.
Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.
#### 9.3.4.2 Внешнее создание учетных данных ключа асимметричной аутентификации

Устройства должны использовать соответствующие отраслевые стандарты высоконадежные технологии при создании и настройке пары ключей вне устройства. Использование таких пар ключей должно быть минимизировано, особенно если пара ключей неизменна и не может быть изменена или заменена после подготовки.

При использовании в качестве части подключения эти пары ключей могут использоваться для подтверждения того, что Устройство обладает свойствами, заявленными производителем в сертификате, чтобы убедить DOTS или пользователя согласиться на подключение Устройства. См. Раздел 7. 3.3 для OTM, который использует такой сертификат для аутентификации устройства, а затем предоставляет новые учетные данные домена безопасности OCF для использования.
### 9.3.5 Учетные данные ключа шифрования асимметричного ключа

Кредентиалы асимметричного ключа шифрования (KEK) используются для обертывания симметричных ключей при распределении или хранении ключей.
Свойство PrivateData в ресурсе «/oic/sec/cred» содержит закрытый ключ.
Свойство PublicData содержит открытый ключ.
Свойство OptionalData может содержать статус отзыва.
При установке устройства следует применять надежные методы хранения ключей, обеспечивающие
PrivateData остается закрытой.
Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.

### 9.3.6 Учетные данные сертификата


Учетные данные сертификата - это асимметричные ключи, которые сопровождаются сертификатом, выданным CMS или внешним центром сертификации (CA).
Протокол регистрации сертификатов используется для получения сертификата и подтверждения владения.
Выданный сертификат хранится в Ресурсе учетных данных с асимметричным ключом.
Другие объекты, полезные для управления жизненным циклом сертификатов, такие как статус отзыва сертификата, связаны с Ресурсом учетных данных.
Для завершения проверки пути используется ресурс учетных данных с асимметричным ключом или самозаверяющий сертификат.
Свойство PrivateData в ресурсе «/oic/sec/cred» содержит закрытый ключ.
Свойство PublicData содержит выданный сертификат.
Свойство OptionalData может содержать статус отзыва.
Инспектор устройства должен применять усиленные методы хранения ключей, которые гарантируют, что PrivateData останется конфиденциальной.
Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.
### 9.3.7 Учетные данные для пароля

Общие секретные учетные данные используются для поддержания ПИН-кода или пароля, который разрешает доступ Устройства к внешней системе или Устройству, которое не поддерживает какие-либо другие типы учетных данных OCF.
Свойство Privat eData в Ресурсе «/oic/sec/cred» содержит ПИН-код, пароль и другие значения, полезные для изменения и проверки пароля.
Свойство PublicData может содержать имя пользователя или учетной записи, если применимо.
Свойство OptionalData может содержать статус отзыва.
Инспектор устройства должен применять усиленные методы хранения ключей, которые гарантируют, что PrivateData останется конфиденциальной.
Исполнитель устройства должен применять надлежащую целостность, конфиденциальность и защиту доступа «/oic/sec/cred», «/oic/sec/crl», «/oic/sec/roles», «/oic/sec/csr "Ресурсы для предотвращения несанкционированных изменений.

## 9.4 Управление ключами на основе сертификатов

### 9.4.1 Обзор

Для достижения безопасности аутентификации и транспорта во время связи в домене безопасности OCF могут использоваться сертификаты, содержащие открытые ключи взаимодействующих сторон и частные ключи.
Сертификат и закрытый ключ могут быть выпущены локальным или удаленным центром сертификации (CA). Для местного CA список отозванных сертификатов (CRL), основанный на X. 509, используется для проверки подтверждения личности. В случае удаленного ЦС, протокол статуса онлайн-сертификата (OCSP) может использоваться для проверки подтверждения личности и действительности.

Сертификат OCF и формат OCF CRL (список отозванных сертификатов) являются подмножеством формата X.509, разрешены только алгоритм эллиптической кривой и форма кодирования DER, большинство дополнительных полей в X.509 не поддерживаются, поэтому формат предназначен для удовлетворения требований ограниченного устройства.

Что касается управления сертификатами и списками отзыва сертификатов на сервере, то процесс хранения, извлечения и анализа ресурсов сертификатов и списков отзыва сертификатов будет выполняться на уровне диспетчера ресурсов безопасности; соответствующие интерфейсы могут быть открыты для верхнего уровня.
SRM - это точка обеспечения безопасности на сервере, как описано в пункте 5. 5, поэтому данные сертификатов и CRL будут храниться и управляться в базе данных SVR.

CMS управляет жизненным циклом сертификатов для выдаваемых сертификатов. Зал DOTS назначает CMS Устройству, когда оно только что подключено. Выпускающая CMS должна обрабатывать отозванные сертификаты для сертификатов, которые она выпускает. Если закрытый ключ сертификата скомпрометирован, CMS должен отозвать сертификат. Если CRL используются устройством, CMS должна регулярно (например, каждые 3 месяца) обновлять ресурс «/oic/sec/crl» для устройств, которыми он управляет.3

# 10 Аутентификация устройства

## 10.1 Общие сведения об аутентификации устройства

Когда Клиент обращается к ограниченному Ресурсу на Сервере, Сервер должен аутентифицировать Клиента. Клиенты должны аутентифицировать Серверы при запросе доступа. Клиенты могут также утверждать один или несколько ролей, которые сервер может использовать при принятии решений по управлению доступом. Роли могут быть утверждены, когда аутентификация устройства выполняется с помощью сертификатов.

## 10.2 Аутентификация устройств с использованием учетных данных симметричного ключа

При использовании симметричных ключей для аутентификации серверное устройство должно включать сообщение ServerKeyExchange и устанавливать psk_identity_hint равным идентификатору устройства сервера. Клиент должен подтвердить, что у него есть учетные данные с идентификатором субъекта, равным идентификатору устройства сервера, и типом учетных данных PSK. Если это не так, Клиент должен ответить ошибкой unknown_psk_identity или другой допустимой ошибкой.

Если Клиент находит подходящие учетные данные PSK, он должен ответить сообщением ClientKeyExchange, которое включает psk_identity_hint, установленный для идентификатора устройства Клиента. Сервер должен проверить, что у него есть учетные данные с соответствующими ID Субъекта и типом. В противном случае Сервер должен ответить с помощью unknown_psk_identity или другого подходящего кода ошибки.
Если это так, то он должен продолжить работу по протоколу DTLS, и и Клиент, и Сервер должны вычислить результирующий главный секретный ключ.

## 10.3 Аутентификация устройства с использованием необработанных учетных данных с асимметричным ключом

При использовании необработанных асимметричных ключей для аутентификации Клиент и Сервер должны включать подходящий открытый ключ из учетных данных, привязанных к их Устройству. Каждое Устройство должно проверять, соответствует ли предоставленный открытый ключ общедоступным данным и полю учетных данных, которые они имеют, и использовать соответствующий идентификатор субъекта учетных данных для идентификации однорангового Устройства.

## 10.4 Аутентификация устройств с помощью сертификатов

### 10.4. 1 Аутентификация устройств с помощью сертификатов Общие

При использовании сертификатов для аутентификации и Клиент, и Сервер должны включать свою цепочку сертификатов, хранящуюся в соответствующих учетных данных, как часть выбранного набора шифров аутентификации. Каждое Устройство должно подтверждать цепочку сертификатов, представленную равноправным устройством. Каждая подпись сертификата должна проверяться до тех пор, пока не будет найден открытый ключ на Ресурсе «/oic/sec/cred» с кредитным использованием «oic.sec.cred.trustca». Ресурс учетных данных, находящийся в "/oic/sec/cred", используется для завершения проверки пути сертификата. Кроме того, необходимо проверить срок действия и статус отзыва для всех вышеупомянутых сертификатов, но в это время невозможность получить статус отзыва сертификата (ответ CRL или OCSP) МОЖЕТ продолжать использовать сертификат. Если все проверки прошли успешно.

При наличии информации об отзыве следует использовать информацию об отзыве для проверки статуса отзыва сертификата. URL-адрес, указывающий на информацию об аннулировании, должен быть получен из сертификата (через расширения AuthorInformat ionAccess или crlDistributionPoints). Другие механизмы могут использоваться для сбора соответствующей информации об отзыве, такой как списки отзыва сертификатов или ответы OCSP.

Каждое Устройство должно использовать соответствующий идентификатор субъекта учетных данных для идентификации однорангового устройства.

Устройства должны соответствовать алгоритму проверки паттернов сертификата, указанному в пункте 6 IETF RFC 5280. В частности:

- Для всех сертификатов, не относящихся к конечным объектам, устройства должны проверять, присутствует ли расширение базовых ограничений и что логическое значение cA в расширении имеет значение ИСТИНА. Если одно из них - ложь e, цепочка сертификатов ДОЛЖНА быть отклонена. Если присутствует поле pat hLenConst raint, устройства подтвердят количество сертификатов между этим сертификатом, а сертификат конечного объекта меньше или равен rai nt pathLenConst. Частично, если значение pathLenConst rai nt равно нулю, этим сертификатом может быть выдан только сертификат конечного объекта. Если поле pathLenConst rai nt отсутствует, нет ограничений на длину строки.

## 10.5 Аутентификация устройств с помощью OCF Cloud

### 10.5. 1 Аутентификация устройств с помощью OCF Cloud General

Механизмы аутентификации устройства в пунктах 10. 2, 10. 3 и 10. 4 подразумевают, что Устройство авторизовано для связи с любым другим Устройством, отвечающим критериям, указанным в «/oic/sec/cred»; Ресурс «/oic/sec/acl2» (или ресурс «/oic/sec/acl1» серверов OIC1. 1) дополнительно используется для ограничения доступа к определенным ресурсам. В настоящем пункте описывается аутентификация устройства для облака OCF, в котором используются несколько иные критерии, как описано в пункте 5. Устройство, получающее доступ к облаку OCF, должно установить сеанс TLS. Сеанс TLS с взаимной аутентификацией устанавливается с использованием сертификата сервера и сертификата клиента.

Каждое устройство идентифицируется на основе маркера доступа, присвоенного ему во время регистрации устройства. Облако OCF содержит таблицу ассоциации с облаком OCF, которая сопоставляет токен доступа, идентификатор пользователя и идентификатор устройства.

Регистрация Устройства должна происходить, пока Устройство находится в состоянии RFNOP. После регистрации устройства обновленные токен доступа, идентификатор устройства и идентификатор пользователя используются устройством для последующего подключения к облаку OCF.

### 10.5.2 Подключение устройства к облаку OCF

Устройство должно установить TLS-соединение с использованием сертифицированного удостоверения личности. Соединение должно быть установлено после того, как Устройство будет инициализировано посредником.
Сеанс TLS устанавливается между Устройством и Облаком OCF, как указано в IETF RFC 8323. Ожидается, что Облако OCF предоставит сертификат, подписанный якорем доверия, который присутствует в кредитных записях Устройства. Ожидается, что эти записи кредита будут настроены Посредником.

Зал Устройства проверяет личность OCF Cloud на основе учетных данных, содержащихся в записях ресурсов «/oic/sec/cred» устройства.

Ожидается, что OCF Cloud проверит сертификат производителя, предоставленный Устройством.

Предполагается, что пользователь облака OCF доверяет облаку OCF, к которому подключается Устройство. Подключение к OCF Cloud не могло произойти без участия пользователя OCF Cloud. Предполагается, что пользователь облака OCF заключил соглашение об оказании услуг с поставщиком облака OCF или использует облако OCF Cloud, предоставленное производителем.

Если аутентификация не удалась, свойство «clec» ресурса «oic.r.coapcloudconf» на Устройстве должно быть обновлено о статусе сбоя, если оно поддерживается устройством. Если аутентификация прошла успешно, Устройство и OCF Cloud должны установить зашифрованное соединение в соответствии с согласованным набором шифров.
На рисунке 33 показана последовательность подключения устройства к OCF Cloud и шаги, описанные в таблице 22.





### 10.5. 3 соображения безопасности

Когда сервер OCF получает запрос, отправленный через облако OCF, тогда сервер OCF разрешает, чтобы запрос на использование идентификатора облака OCF передавал его, а не идентификатор клиента OCF. Если нет механизма, через который облако OCF разрешает только те операции, которые пользователь завершает между клиентами OCF и сервером OCF через облако OCF, и запрещает все взаимодействия, тогда клиенты OCF могут получить повышенные привилегии. отправив запрос через OCF Cloud. Это крайне нежелательно с точки зрения безопасности. Следовательно, ожидается, что реализация OCF Cloud обеспечит некоторый механизм, с помощью которого OCF Cloud предотвращает получение клиентами OCF повышенных привилегий при отправке запроса через OCF Cloud. В настоящем выпуске документа детали механизма оставлены на усмотрение реализации.
Соображения безопасности в отношении сертификата производителя, как описано в п. 7. 3.6. 5 также применимы при аутентификации устройства с помощью OCF Cloud.

Устройство должно подтвердить сертификат TLS OCF Cloud, как определено IETF RFC 6125 и в соответствии с его требованиями к аутентификации идентичности сервера.

«Uid» и «di» значение свойства ресурса «/oic/d» могут рассматриваться как личная информация в некоторых регулирующих регионах, и ожидается, что OCF Cloud обеспечит защиту, соответствующую его регулирующим регулирующим органам.

# 11 Целостность и конфиденциальность сообщений

## 11.1 Преамбула

Защищенная связь между клиентами и серверами защищена от опрокидывания, взлома или ответа на сообщения с помощью механизмов безопасности, обеспечивающих конфиденциальность и целостность сообщений.

## 11.2 Защита с помощью DTLS

### 11.2. 1 Защита DTLS Общие

Устройства должны поддерживать DTLS для защищенной связи, как определено в IETF RFC 6347. Устройства, использующие TCP, должны поддерживать TLS v1. 2 для защищенной связи, как определено в IETF RFC 5246. См. 11. 3 для списка обязательных и дополнительных комплектов шифров для обмена сообщениями.
Устройства OCF ДОЛЖНЫ поддерживать (D) TLS версии 1.2 или выше и НЕ ДОЛЖНЫ поддерживать версию 1.1 или ниже.
Семантика многоадресного сеанса еще не определена в этой версии документа по безопасности.

### 11.2. 2 Семантика одноадресной сессии

Для уникальных сообщений между Клиентом и Сервером оба Устройства должны аутентифицировать каждое из них. См. Раздел 10 для получения подробной информации об аутентификации устройства.
Защищенные одноадресные сообщения между Клиентом и Сервером должны использовать набор шифров из 11. 3. Отправляющее Устройство должно шифровать и аутентифицировать сообщения, как определено выбранным набором шифров, а принимающее Устройство должно проверять и дешифровать сообщения перед обработкой. их.

### 11.2. 3 Семантика облачных сессий

Обмен сообщениями между Облаком OCF и Устройством осуществляется только в том случае, если Устройство и Облако OCF аутентифицируют каждое из них, как описано в 10.4. 3. Наборы асимметричных шифров, как описано в 11.3.5, должны использоваться для установления защищенного сеанса и для шифрования / дешифрования между OCF Cloud и Devic e. Конечная точка OCF, отправляющая сообщение, должна зашифровать и аутентифицировать сообщение с использованием шифра, как описано в п. 11. 3.5, а конечная точка OCF должна проверить и расшифровать сообщение перед его обработкой.

## 11.3 Наборы шифров

### 11.3. 1 Общие наборы шифров

Наборы шифров, разрешенные для использования, могут различаться в зависимости от дополнения. В этом разделе перечислены шифровальные костюмы, разрешенные при передаче прав собственности и нормальной работе. Следующие RFC предоставляют дополнительную информацию о наборах шифров, используемых в OCF.
IETF RFC 4279: определяет использование предварительно общих ключей (PSK) в (D) TLS
IETF RFC 4492: определяет использование эллиптической криптографии в (D) TLS
IETF RFC 5489: S определяет использование шифров, которые используют эллиптическую кривую Диффи-Хеллмана (E CDHE) и PSK.
IETF RFC 6655 и IETF RFC 7251: Определяет средства шифрования в режиме AES-CCM с ECDHE.

### 11.3.2 Наборы шифров для передачи владения устройством

#### 11.3.2.1 Наборы шифров для методов Just Works
Just Works OTM может использовать следующие (D) серверы TLS-шифров.
TLS_ECDH_ANON_WITH_AES_256_CBC_SHA256

Все устройства, поддерживающие Just Works OTM, должны включать:
TLS_ECDH_ANON_WITH_AES_128_CBC_SHA256 (со значением 0x FF00)

На всех устройствах, поддерживающих Just Works OTM, должны быть реализованы:
TLS_ECDH_ANON_WITH_AES_256_CBC_SHA256 (со значением 0x FF01)

#### 11.3.2.2 Наборы шифров для метода случайного ПИН-кода

OTM на основе случайного ПИН-кода может использовать следующие (D) наборы шифров TLS.
TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256,
TLS_ECDHE_PSK_WITH_AES_256_CBC_SHA256,

Все устройства, поддерживающие OTM со случайным выводом контактов, должны включать:
TLS_ECDHE_PSK_WITH_AES_128_CBC_SHA256

# 12 Контроль доступа

## 12.1 Создание и управление ACL

Эта причина будет расширена в будущей версии документа.

## 12.2 Оценка и применение ACL

### 12.2.1 Оценка и обеспечение соблюдения ACL Общие

Сервер обеспечивает контроль доступа к Ресурсам приложения перед тем, как предоставить их запрашивающей стороне. Уровень безопасности на сервере аутентифицирует инициатора запроса, когда доступ получен через защищенный порт. Аутентифицированные запрашивающие стороны, известные как "субъекты", могут использоваться для сопоставления записей ACL, которые определяют личность, роль запрашивающей стороны или могут соответствовать аутентифицированным запрашивающим с использованием подстановочного знака субъекта.

Если запрос поступает через незащищенный порт, разрешены только политики ACL, в которых используется соответствие подстановочного знака субъекта анонимным запросчикам.
В доступе отказано, если запрошенный ресурс не соответствует записи ACL.
ПРИМЕЧАНИЕ. Переработанное исключение, относящееся к устройству, где находятся виртуальные ресурсы безопасности.
Могут быть предоставлены права на подачу исковых требований.
ACL второго поколения (т.е. «/oic/sec/acl2») содержит массив записей контроля доступа (ACE2), в которых используется алгоритм сопоставления ресурсов, который использует массив ссылок на ресурсы для сопоставления ресурсов, к которым Применяется политика доступа ACE2. Слежение за состоянием состоит из сравнения значений свойства "ресурсы" ACE2 (см. Раздел 13) с запрошенным ресурсом. Ресурсы подбираются двумя способами:
1) ссылка на хост (href)
2) подстановочный знак ресурса (wc).

### 12.2.2 Сопоставление ссылок на хост

При наличии в элементе сопоставления ACE2 свойство ссылки на хост (href) должно использоваться для сопоставления ресурсов.

- Свойство href должно использоваться для поиска точного соответствия имени ресурса, если оно присутствует.

### 12.2.3 Сопоставление подстановочных знаков ресурса

Если присутствует, выражение подстановочного знака (wc) должно использоваться для сопоставления нескольких Ресурсов с использованием Свойства подстановочного знака, содержащегося в структуре «oic.sec.ace2.resource-ref».
Выражение с подстановочным знаком может использоваться для управления множеством ресурсов с использованием свойства подстановочного знака, содержащегося в структуре «oic.sec.ac e2. Resourc e-ref». Строки сопоставления с подстановочными знаками определены в таблице 23.