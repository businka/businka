# 1 Область применения

Эта спецификация определяет цели безопасности, философию, ресурсы и механизм, которые влияют на базовые уровни OCF основной спецификации OCF. Основная спецификация OCF содержит информативное содержание безопасности. Спецификация безопасности OCF содержит нормативный контент безопасности и может содержать информативный контент, связанный с базой OCF или другими спецификациями OCF.

### 3.1.40 Owned

 (или "в собственности государства") имеющее свойство "own" ресурса «/oic/sec/doxm», равное «TRUE»

### 3.1.41 Unowned

Неизвестный (или «в неизвестном состоянии»)
имеющий свойство "own" ресурса "/oic/sec/doxm", равное "FALSE"

## 3.3 Условные обозначения



Рисунок 1 - Взаимодействие OCF

Устройства могут реализовывать роль клиента, которая выполняет действия на серверах. Действия получают доступ к ресурсам, управляемым серверами. Стек OCF обеспечивает применение политик доступа к ресурсам. Сквозное взаимодействие с устройством может быть защищено с использованием протокола защиты сеанса (например, DTLS) или методами шифрования данных.



# 5 Обзор безопасности

Это информативный раздел. Целью архитектуры безопасности OCF является защита ресурсов и всех аспектов HW и SW, которые используются для поддержки защиты ресурсов. С точки зрения OCF, устройство является логическим объектом, который соответствует спецификациям OCF. Во взаимодействии между Устройствами Устройство, действующее в качестве Сервера, удерживает и контролирует Ресурсы и предоставляет Устройству, действующему в качестве Клиента, доступ к этим Ресурсам с учетом набора механизмов безопасности. Платформа, на которой размещено Устройство, может обеспечить усиление безопасности, которое потребуется для обеспечения устойчивости множества операций, описанных в этой спецификации.

Теория безопасности работы описана в следующих шагах.



Рисунок 2 - Слои OCF

1. Клиент устанавливает сетевое соединение с Сервером (Устройство, на котором хранятся Ресурсы). Уровень абстрагирования подключения обеспечивает возможность подключения устройств, несмотря на различия в параметрах подключения.

1. Устройства (например, Сервер и Клиент) обмениваются сообщениями либо с, либо без взаимно аутентифицируемого безопасного канала между двумя Устройствами.

    - Res Ресурс oic.sec.cred на каждом Устройстве содержит учетные данные, используемые для взаимной аутентификации и (если применимо) проверки сертификата.

    - Сообщения, полученные по защищенному каналу, связаны с deviceUUID. В случае удостоверения сертификата, deviceUUID находится в сертификате, полученном от другого Устройства. В случае учетных данных симметричного ключа deviceUUID настраивается с учетными данными в ресурсе oic.sec.cred.

    - Сервер может связать Клиента с любым количеством ролей. В случае взаимной аутентификации с использованием сертификата roleid (если есть) предоставляется в сертификатах ролей; они настраиваются Клиентом на Сервер. В случае симметричного ключа разрешенный ролид (если есть) настраивается с учетными данными в oic.sec.cred.
    - Запросы, полученные Сервером по незащищенному каналу, считаются анонимными и не связаны с каким-либо deviceUUID или roleid.

3. Клиент отправляет запрос на Сервер.
4. Сервер получает запрос.
    a) Если запрос получен по незащищенному каналу, Сервер обрабатывает запрос как анонимный, и никакие deviceUUID или roleid не связаны с запросом.
    b) Если запрос получен по безопасному каналу, то Сервер связывает deviceUUID с запросом, а Сервер связывает все действительные roleid Клиента с запросом.
    c) Затем сервер обращается к списку контроля доступа (ACL) и ищет запись ACL, соответствующую следующим критериям:
      - Запрошенный ресурс соответствует ссылке на ресурс в ACE.

      - Запрошенная операция разрешена "разрешениями" ACE, и

      - «subjectUUID» содержит либо одно из специального набора подстановочных значений, либо, если устройство не является анонимным, субъект соответствует идентификатору клиента, связанному с запросом, или действительному ролевому идентификатору, связанному с запросом. Значения подстановочных знаков соответствуют либо всем устройствам, осуществляющим связь через сеанс с проверкой подлинности и шифрованием, либо всем устройствам, осуществляющим связь через сеанс без проверки подлинности и незашифрованные.

Если есть соответствующий ACE, то доступ к Ресурсу разрешен; в противном случае доступ запрещен. Доступ осуществляется с помощью диспетчера защищенных ресурсов сервера (SRM).

5. Сервер отправляет ответ обратно Клиенту.

Защита ресурсов включает защиту данных как во время отдыха, так и во время транспортировки. Следует отметить, что, помимо механизмов контроля доступа, спецификация безопасности OCF не включает в себя спецификацию безопасного хранения Ресурсов, пока они хранятся на Серверах. Однако в состоянии покоя защита ресурсов безопасности, как ожидается, будет обеспечена за счет сочетания безопасного хранения и контроля доступа. Безопасное хранение может быть достигнуто за счет использования аппаратной безопасности или шифрования данных в состоянии покоя. Точное внедрение безопасного хранения зависит от ряда требований по усилению безопасности, указанных в разделе 14, и может быть предметом руководящих принципов сертификации.
Защита данных при передаче, с другой стороны, будет полностью указана в качестве нормативной части данной спецификации. При транзите защита может быть предоставлена на уровне ресурсов или на транспортном уровне. Эта спецификация поддерживает только защиту при транспортировке на транспортном уровне посредством использования таких механизмов, как DTLS. Следует отметить, что DTLS будет обеспечивать защиту пакетов по пакетам, а не защиту полезной нагрузки в целом. Например, если требуется целостность всей полезной нагрузки в целом, должны быть уже созданы отдельные механизмы подписи перед передачей пакета на транспортный уровень.

Рисунок 3 - Точки обеспечения безопасности OCF



- Устройство имеет право на связь с облаком OCF, если доверенный посредник предоставил устройство.
- Устройство и посредник соединяются через DTLS, используя / oic / sec / cred
- Устройство предоставляется Посредником со следующей информацией:
  - URI Облака OCF
  - Токен, который может быть проверен OCF Cloud
  - UUID облака OCF

## 5.1 Контроль доступа

Инфраструктура OCF предполагает, что Ресурсы размещаются на Сервере и предоставляются Клиентам с учетом механизмов контроля доступа и авторизации. Ресурсы в конечной точке защищены посредством реализации контроля доступа, аутентификации и защиты конфиденциальности. В этом разделе представлен обзор контроля доступа (AC) с использованием ACL. Однако ожидается, что AC в стеке OCF не зависит от уровня абстракции транспорта и связности.

Реализация контроля доступа опирается на априорное определение набора политик доступа для Ресурса. Политики могут храниться локальным ACL или службой управления доступом (AMS) в форме записей управления доступом (ACE). Можно применять два типа механизмов контроля доступа:

Control Управление доступом на основе субъекта (SBAC), где каждый ACE будет сопоставлять субъект (например, идентификатор запрашивающего лица) запрашивающего объекта с субъектом, включенным в политику, определенную для ресурса. Утверждение личности запрашивающего требует процесса аутентификации.
Control Контроль доступа на основе ролей (RBAC), где каждый ACE будет сопоставлять идентификатор роли, включенный в политику для ресурса, с идентификатором роли, связанным с запросчиком.
Если сервер OCF получает пакетный запрос к ресурсу атомарных измерений, содержащему только локальные ссылки, и существует ACE, соответствующий ресурсу атомарных измерений, который разрешает запрос, то сервер OCF разрешает соответствующие запросы к связанным ресурсам. Настоящий параграф должен применяться к любому типу ресурса, основанному на типе ресурса атомных измерений.

 

Примечание. Определение ресурса атомных измерений запрещает прямой доступ к связанным ресурсам. Характер Атомного Измерения также запрещает обновлять «ссылки» для добавления или удаления Ресурсов. Следовательно, нет риска повышения привилегий при использовании ACE Ресурса измерения Atomics для управления доступом к связанным ресурсам.

Если сервер OCF получает пакетный запрос к ресурсу сбора, содержащему только локальные ссылки, и существует ACE, соответствующий ресурсу сбора, который разрешает запрос, то сервер OCF разрешает соответствующие запросы к связанным ресурсам. Настоящий параграф должен применяться к любому типу ресурса на основе типа ресурса коллекции.

Примечание. Это означает, что ACE Ресурса Коллекции разрешают доступ ко всем связанным Ресурсам Коллекции через пакетный интерфейс, даже если отсутствуют ACE, разрешающие прямой доступ к некоторым или всем связанным Ресурсам. Если не будет жестко регулироваться, это может привести к повышению привилегий. В основной спецификации OCF предусмотрены ограничения на использование ресурсов сбора, чтобы снизить риск повышения привилегий. Например, Базовая спецификация OCF запрещает обновлять «ссылки» Ресурса Коллекции с целью получения доступа к добавленному Ресурсу в соответствии с
ТУЗ Коллекции, когда в противном случае доступ к Ресурсу был бы запрещен.

В модели управления доступом OCF доступ к экземпляру Resource требует соответствующей политики управления доступом. Это означает, что каждое Устройство, действующее как Сервер, должно иметь ACE, разрешающий доступ к каждому Ресурсу, который он защищает. Этот критерий может быть удовлетворен для
Ресурс A, если существует ACE, разрешающий пакетные запросы для доступа к Ресурсу B, содержащему Ссылку на Ресурс A, даже если нет ACE, разрешающих запросы, которые обращаются к Ресурсу A напрямую. Примерами типа ресурса для ресурса B являются тип ресурса атомарного измерения и тип ресурса коллекции. Отсутствие ACE, разрешающего доступ к Ресурсу, напрямую или через Ссылку, приводит к недоступности Ресурса.

ACE применяется только в том случае, если ACE соответствует как субъекту (т.е. клиенту OCF), так и запрашиваемому ресурсу. Существует несколько способов сопоставления субъекта: (1) DeviceID, (2) Role Identifier или (3) подстановочный знак. Способ подключения клиента к серверу может быть релевантным контекстом для принятия решений по управлению доступом. Сопоставление с подстановочными знаками в соединениях с проверкой подлинности и без проверки подлинности, а также с шифрованием и незашифрованием позволяет широко применять политику доступа к предметным классам.

Пример политики подстановочных знаков:





Рисунок 8 - Пример определения ресурса с непрозрачными свойствами

 

В настоящее время структура OCF правильно обрабатывает информацию уровня как непрозрачную; следовательно, разные разрешения не могут быть назначены как часть политики ACL (например, разрешение только на чтение для свойства-1 и разрешение только на запись для свойства-2). Таким образом, «oic.thing» разделен на два новых ресурса «oic.RsrcProp-1» и «oic.RsrcProp-2». Таким образом, ACL уровня свойств может быть достигнут посредством использования ACL уровня ресурса.

 

 

Рисунок 9 - Управление доступом на уровне свойств

 

 

## 5.2 Обзор адаптации

 Перед тем, как Устройство начнет работать в среде OCF и сможет взаимодействовать с другими Устройствами, его необходимо соответствующим образом подключить. Первым шагом при подключении устройства является настройка владельца, когда законный пользователь, который владеет / приобретает устройство, использует инструмент адаптации (OBT), а использование OBT использует один из методов передачи владельца (OTM) для установления права собственности. Как только право собственности установлено, OBT становится механизмом, с помощью которого затем может быть подготовлено Устройство, в конце которого Устройство начинает работать и может взаимодействовать с другими Устройствами в среде OCF.



Рисунок 10 - Обзор адаптации

В этом разделе описывается процесс подготовки и обеспечения безопасности, но при этом аспекты обеспечения безопасности не рассматриваются в других спецификациях OCF. В контексте безопасности все Устройства должны быть обеспечены минимальной конфигурацией безопасности, которая позволяет Устройству безопасно взаимодействовать с другими Устройствами в среде OCF / связываться с ними. Эта минимальная конфигурация безопасности определена как «Встроенное устройство», «Готовое к нормальной работе», и указана в разделе 7.5.

Внедрения и инициализация могут использовать сервисы, определенные вне этой спецификации, ожидается, что при использовании других сервисов доверие между подключаемым устройством и различными инструментами не является переходным. Это означает, что загружаемое устройство будет индивидуально аутентифицировать учетные данные каждого инструмента, используемого в процессе адаптации; что инструменты не разделяют учетные данные или подразумевают доверительные отношения, если они не были установлены.

### 5.2.1 Действия на борту

Блок-схема ниже показывает типичные шаги, которые выполняются во время регистрации. Хотя регистрация может включать в себя различные этапы, не связанные с безопасностью, основное внимание на диаграмме уделяется конфигурации, связанной с безопасностью, чтобы новое устройство могло функционировать в среде OCF. Подключение обычно начинается с того, что Устройство становится «владельцем» законного пользователя / системы, после чего следует настройка Устройства для среды, в которой оно будет работать. Это может включать настройку информации, например, кто может получить доступ к Устройству и какие действия также могут быть выполнены. как и какие разрешения Устройство имеет для взаимодействия с другими устройствами.

Рисунок 11 - Процесс подключения OCF

### 5.2.2 Установление владельца устройства

Цель установления права собственности на устройство состоит в том, чтобы позволить законному пользователю, который владеет / приобрел устройство, заявить о себе как о владельце и управляющем устройством. Это делается посредством использования OBT, который включает в себя создание контекста владения между новым устройством и инструментом OBT и обеспечивает оперативный контроль и управление устройством. OBT может рассматриваться как логическая сущность, размещаемая инструментами / серверами, такими как консоль управления сетью, инструмент управления устройством, инструмент авторизации сети, инструмент обеспечения сети, устройство домашнего шлюза или контроллер домашней автоматизации. На физическое устройство, на котором размещается OBT, будут распространяться некоторые требования повышения безопасности, что позволит сохранить целостность и конфиденциальность любых сохраняемых учетных данных. Инструмент / Сервер, который устанавливает владение Устройством, называется OBT.

OBT использует один из OTM, указанных в разделе 7.3, для безопасного установления владельца устройства. Термин «передача владельца» используется, поскольку предполагается, что даже для нового Устройства право собственности передается от производителя / поставщика Устройства к
покупатель / законный пользователь нового устройства.

ОТМ устанавливает нового владельца (оператора OBT), который уполномочен управлять
Устройство. Владелец передачи устанавливает следующее

 DOTS предоставляет учетные данные владельца (OC) для свойства creds в ресурсе / oic / sec / cred устройства. Этот OC позволяет устройству и DOTS выполнять взаимную аутентификацию во время последующих взаимодействий. OC связывает DOTS DeviceID со свойством rowneruuid ресурса / oic / sec / doxm, устанавливая его в качестве владельца ресурса. DOTS записывает идентификатор устройства как часть передачи права собственности.

 

Owner Владелец устройства устанавливает доверие к устройству через OTM.

The Подготовка устройства к инициализации путем предоставления учетных данных, которые могут потребоваться.

 

### 5.2.3 Подготовка к нормальной работе

Как только устройство получит необходимую информацию для инициации инициализации, следующим шагом будет предоставление дополнительной конфигурации безопасности, которая позволит устройству начать работу. Это может включать в себя настройку различных параметров и может также включать несколько шагов. Кроме того, в настоящее время выполняется подготовка списков ACL для различных ресурсов, размещаемых сервером на устройстве. Обратите внимание, что этап подготовки не ограничивается только этим этапом. Подготовка устройства может происходить на нескольких этапах жизненного цикла устройства.

 

Однако конкретная связанная с безопасностью подготовка состояния ресурса и свойства, скорее всего, произойдет на этом этапе, в конце которого каждое устройство достигает состояния «Готов к нормальной работе» на встроенном устройстве. Ожидается, что состояние «Готовность к нормальной работе» будет согласованным и четко определенным, независимо от того, какой конкретный OTM используется, или независимо от того, что меняется. Однако отдельные механизмы OTM и этапы подготовки могут указывать дополнительную конфигурацию состояний ресурсов и свойств. Минимальная обязательная конфигурация, необходимая для того, чтобы устройство находилось в состоянии «Готов к нормальной работе», указана в разделе 87.5.

 

5.2.4 DeviceProvisioningfor OCF Cloud и обзор регистрации устройства

Как упоминалось в начале раздела 5, связь между устройством и облаком OCF подчиняется различным критериям по сравнению с устройствами, которые находятся в одной локальной сети. Устройство настроено для подключения к облаку OCF с помощью посредника, как указано в разделах ресурса CoAPCloudConf в облаке расширений базовой спецификации OCF. Предоставление включает в себя данные об удаленном подключении и локальные данные, такие как URL-адрес, по которому можно найти среду размещения OCF Cloud, и проверяемый токен доступа OCF Cloud.

 

## 5,3 Provisioning

Обратите внимание, что в общем случае подготовка может включать процессы во время производства и распространения Устройства, а также процессы после того, как Устройство было перенесено в его предполагаемую среду (части процесса адаптации). В этой спецификации обеспечение безопасности включает в себя процессы после передачи права собственности (даже если некоторые действия во время передачи права собственности и включения могут привести к предоставлению некоторых данных на устройстве), конфигурация учетных данных для взаимодействия со службами обеспечения, настройка любых связанных с безопасностью ресурсов и учетных данных для работы с любыми сервисами, с которыми Устройство должно связаться позже.

 После завершения передачи права собственности Устройство должно взаимодействовать с CMS и AMS, чтобы обеспечить надлежащие учетные данные и параметры безопасности для нормальной работы. Эти параметры могут включать

- Учетные данные безопасности через CMS, в настоящее время предполагаемые для развертывания в том же OBT.
- Policies Политики контроля доступа и ACL через AMS, которые в настоящее время предполагается использовать в той же OBT, но могут в будущем стать частью AMS.

Как уже упоминалось, для обеспечения масштабируемой и модульной конструкции эти функции рассматриваются как сервисы, которые в будущем могут быть развернуты как отдельные серверы. В настоящее время при развертывании предполагается, что все эти службы развернуты как часть OBT. Независимо от сценария физического развертывания одно и то же требование повышения безопасности) применяется к любому физическому серверу, на котором размещены инструменты и службы обеспечения безопасности, обсуждаемые здесь.

 Устройства знают о своем состоянии обеспечения безопасности. Самосознание позволяет им быть активными в отношении предоставления или повторного предоставления ресурсов безопасности, необходимых для достижения эксплуатационных целей устройств.

###  5.3.1 Предоставление других услуг

 Чтобы иметь возможность поддерживать использование потенциально разных хостов службы управления устройствами, у каждого безопасного виртуального ресурса устройства (SVR) есть связанный владелец ресурса, указанный в свойстве rowneruuid ресурса.

 DOTS должен обновить свойство rowneruuid ресурсов /oic/sec/doxm и /oic/sec/pstat с помощью идентификатора владельца ресурса DOTS.

 DOTS должен обновить свойство rowneruuid ресурса /oic/sec/cred с помощью идентификатора владельца ресурса CMS.

 DOTS должен обновить свойство rowneruuid /







## 5.5 Обзор учетных данных

 Устройства могут использовать учетные данные для подтверждения личности и роли сторон в двунаправленной связи. Полномочия могут быть симметричными или асимметричными. Каждое устройство хранит секретные и открытые части своих собственных учетных данных, где это применимо, а также учетные данные для других устройств, которые были предоставлены DOXS или CMS. Эти учетные данные затем используются при установлении сеансов безопасной связи (например, с использованием DTLS) для проверки подлинности участвующих сторон. Учетные данные роли используются после установления аутентифицированного сеанса для утверждения одной или нескольких ролей для устройства.

 Токены доступа предоставляются в Облако OCF после установления аутентифицированного сеанса с Облаком OCF для проверки идентификатора пользователя, с которым должно быть связано Устройство

 

# 6 Безопасность для процесса обнаружения

 Основная функция механизма обнаружения заключается в предоставлении универсальных идентификаторов ресурсов (URI, называемых ссылками) для ресурсов, размещенных на сервере, которые дополняются атрибутами этих ресурсов и возможными дальнейшими отношениями ссылок. (в соответствии с разделом 10 основной спецификации OCF)

## 6.1 Соображения безопасности для обнаружения

 

При определении процесса обнаружения следует позаботиться о том, чтобы обнаруживающему объекту подвергался только минимальный набор Ресурсов, не нарушая при этом безопасность конфиденциальной информации или требования конфиденциальности приложения. Это включает как данные, включенные в Ресурсы, так и соответствующие метаданные.

 Для достижения расширяемости и масштабируемости данная спецификация не предоставляет мандат на обнаружение каждого отдельного ресурса. Вместо этого Сервер, содержащий Ресурс, будет полагаться на ACL для каждого Ресурса, чтобы определить, уполномочен ли запрашивающий (Клиент) просматривать / обрабатывать какие-либо из Ресурсов.

 Ресурс /oic/sec/acl2 содержит записи ACL, управляющие доступом к размещенным на сервере ресурсам. (См. Раздел 13.4)

 Помимо конфиденциальности и возможности обнаружения Ресурсов с точки зрения ACL, сам процесс обнаружения должен быть защищен. Эта спецификация устанавливает следующие требования для процесса обнаружения:

1. Обеспечение защиты целостности для обнаруженных ресурсов.

2. Обеспечение защиты конфиденциальности для обнаруженных ресурсов, которые считаются конфиденциальными.

 Обнаружение ресурсов выполняется с помощью операции RETRIEVE (одноадресной или многоадресной) на известном ресурсе /oic/res.

 Запрос на обнаружение отправляется по незащищенному каналу (многоадресная или одноадресная без DTLS), Сервер не может определить личность запрашивающей стороны. В таких случаях Сервер, который хочет аутентифицировать Клиента перед ответом, может перечислить URI безопасного обнаружения (например, coaps: // IP: PORT /oic/res) в ответе незащищенного ресурса /oic/res. Это означает, что URI безопасного обнаружения по умолчанию может быть обнаружен любым клиентом. Затем клиенту потребуется отправить отдельный одноадресный запрос с использованием DTLS на URI безопасного обнаружения.

Для безопасного обнаружения любой Ресурс, имеющий связанный ACL2, будет указан в ответе на ресурс /oic/res, если и только если у Клиента есть разрешения на выполнение хотя бы одной из операций CRUDN (т.е. Побитовое ИЛИ флагов CRUDN должно быть правдой).

 Например, клиент с идентификатором устройства «d1» делает запрос RETRIEVE на ресурс «/door», размещенный на сервере с идентификатором устройства «d3», где d3 имеет ACL2 ниже:

```json
{
  "aclist2": [
    {
      "subject": {
        "uuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
      },
      "resources": [
        {
          "href": "/door"
        }
      ],
      "permission": 2, // RETRIEVE
      "aceid": 1
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
},
{
  "aclist2": [
    {
      "subject": {
        "authority": "owner",
        "role": "owner"
      }

      "resources": [
        {
          "href": "/door"
        }
      ],
      "permission": 2, // RETRIEVE
      "aceid": 2
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
},
{
  "aclist2": [
    {
      "subject": {
        "uuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
      },
      "resources": [
        {
          "href": "/door/lock"
        }
      ],
      "permission": 4, // UPDATE
      "aceid": 3
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
}
{
  "aclist2": [
    {
      "subject": {
        "conntype": "anon-clear"
      },
      "resources": [
        {
          "href": "/light"
        }
      ],
      "permission": 2,  // RETRIEVE
      "aceid": 4
    }
  ],
  "rowneruuid": "0685B960-736F-46F7-BEC0-9E6CBD61ADC1"
}
```

ACL указывает, что клиент "d1" имеет разрешения RETRIEVE для ресурса. Следовательно, когда устройство «d1» выполняет обнаружение на ресурсе «/ oic / res» сервера «d3», ответ будет включать URI метаданных ресурса «/ door». Клиент "d2" будет иметь доступ к обоим ресурсам. ACE2 предотвратит обновление «d4».
Результаты обнаружения доставлены в d1 относительно ресурса "/ oic / res" d3 из защищенного интерфейса: